import{c as Ke,a as q,h as Oe,b as I,l as Qe,s as me,f as z,d as ve}from"../chunks/CxOx-TIJ.js";import{i as Xe}from"../chunks/3NxSoY2_.js";import{p as Ye,o as Ze,x as et,l as tt,b as at,f as H,d as i,t as O,a as nt,s as u,g as e,m as d,u as p,h as ge,F as k,c as v,j as r,$ as rt,r as g,e as h,n as T,k as st,i as l}from"../chunks/DzFKsO_V.js";import{s as ot,a as it,i as _,v as lt}from"../chunks/B_jyf0qs.js";import{c as N,d as ct,g as E}from"../chunks/BguOOs3x.js";import{p as ye}from"../chunks/DgabA6iF.js";import{g as he}from"../chunks/BzzAh3Be.js";import{U as dt}from"../chunks/B8GNZv7s.js";import{D as _e}from"../chunks/DL1RlOO9.js";import{E as pt,P as ut,a as ft}from"../chunks/Cfss7k9J.js";import{D as mt}from"../chunks/BLYRAgBX.js";import{I as vt}from"../chunks/CzarUgpd.js";import{g as Ee}from"../chunks/JkzpcrZD.js";import{w as Q}from"../chunks/DSHGoHxX.js";import{t as w}from"../chunks/li_-Mkq2.js";import{C as gt}from"../chunks/BBvIKVJT.js";import{e as X}from"../chunks/BZiHL9L3.js";s[k]="src/routes/enterprises/[id]/+page.svelte";var yt=q(z('<div class="p-6 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading enterprise...</p></div>'),s[k],[[316,2,[[317,3],[318,3]]]]),ht=q(z('<div class="rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),s[k],[[321,2,[[322,3]]]]),_t=q(z("<!> <!> <!> <!> <!>",1),s[k],[]),Et=q(z('<div class="space-y-6"><nav class="flex" aria-label="Breadcrumb"><ol class="inline-flex items-center space-x-1 md:space-x-3"><li class="inline-flex items-center"><a class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white"><svg class="w-3 h-3 mr-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg> Enterprises</a></li> <li><div class="flex items-center"><svg class="w-3 h-3 text-gray-400 mx-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg> <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400"> </span></div></li></ol></nav> <!></div> <!> <!> <!> <!>',1),s[k],[[290,0,[[292,1,[[293,2,[[294,3,[[295,4,[[296,5,[[297,6]]]]]]],[302,3,[[303,4,[[304,5,[[305,6]]],[307,5]]]]]]]]]]]]);function s(be,xe){Ke(new.target),Ye(xe,!1,s);const[$e,Ie]=ot(),Y=()=>(lt(ye,"page"),it(ye,"$page",$e)),D=d();let a=d(null),f=d([]),y=d([]),G=d(!0),F=d(""),S=d(!1),A=d(!1),M=d(!1),U=d(!1),m=d(null),L=null,b=d();async function Z(){if(e(D))try{r(G,!0),r(F,"");const[t,n,o]=(await T(Promise.all([E.getEnterprise(e(D)),E.listEnterprisePools(e(D)).catch(()=>[]),E.listEnterpriseInstances(e(D)).catch(()=>[])])))();r(a,t),r(f,n),r(y,o)}catch(t){r(F,t instanceof Error?t.message:"Failed to load enterprise")}finally{r(G,!1)}}function Te(t,n){const{events:o}=t;return{...n,events:o}}async function we(t){if(e(a))try{(await T(E.updateEnterprise(e(a).id,t)))(),(await T(Z()))(),w.success("Enterprise Updated",`Enterprise ${e(a).name} has been updated successfully.`),r(S,!1)}catch(n){throw n}}async function De(){if(e(a)){try{(await T(E.deleteEnterprise(e(a).id)))(),he(N("/enterprises"))}catch(t){const n=X(t);w.error("Delete Failed",n)}r(A,!1)}}async function Me(){if(e(m))try{(await T(E.deleteInstance(e(m).name)))(),w.success("Instance Deleted",`Instance ${e(m).name} has been deleted successfully.`),r(M,!1),r(m,null)}catch(t){const n=X(t);w.error("Delete Failed",n),r(M,!1),r(m,null)}}function Pe(t){r(m,t),r(M,!0)}function Ce(){r(U,!0)}async function ke(t){try{if(!e(a))return;(await T(E.createEnterprisePool(e(a).id,t.detail)))(),w.success("Pool Created",`Pool has been created successfully for enterprise ${e(a).name}.`),r(U,!1)}catch(n){const o=X(n);w.error("Pool Creation Failed",o)}}function ee(){e(b)&&st(b,e(b).scrollTop=e(b).scrollHeight)}function Fe(t){if(l(t.operation,"update")){const n=t.payload;if(e(a)&&l(n.id,e(a).id)){const o=e(a).events?.length||0,c=n.events?.length||0;r(a,Te(e(a),n)),c>o&&setTimeout(()=>{ee()},100)}}else if(l(t.operation,"delete")){const n=t.payload.id||t.payload;e(a)&&l(e(a).id,n)&&he(N("/enterprises"))}}function Se(t){if(!e(a))return;const n=t.payload;if(!l(n.enterprise_id,e(a).id,!1)){if(l(t.operation,"create"))r(f,[...e(f),n]);else if(l(t.operation,"update"))r(f,e(f).map(o=>l(o.id,n.id)?n:o));else if(l(t.operation,"delete")){const o=n.id||n;r(f,e(f).filter(c=>l(c.id,o,!1)))}}}function Ae(t){if(!e(a)||!e(f))return;const n=t.payload;if(e(f).some(c=>l(c.id,n.pool_id))){if(l(t.operation,"create"))r(y,[...e(y),n]);else if(l(t.operation,"update"))r(y,e(y).map(c=>l(c.id,n.id)?n:c));else if(l(t.operation,"delete")){const c=n.id||n;r(y,e(y).filter(W=>l(W.id,c,!1)))}}}Ze(()=>{Z().then(()=>{e(a)?.events?.length&&setTimeout(()=>{ee()},100)});const t=Q.subscribeToEntity("enterprise",["update","delete"],Fe),n=Q.subscribeToEntity("pool",["create","update","delete"],Se),o=Q.subscribeToEntity("instance",["create","update","delete"],Ae);L=()=>{t(),n(),o()}}),et(()=>{L&&(L(),L=null)}),tt(()=>Y(),()=>{r(D,Y().params.id)}),at(),Xe();var te=Et();Oe(t=>{O(()=>rt.title=`${e(a),p(()=>e(a)?`${e(a).name} - Enterprise Details`:"Enterprise Details")??""} - GARM`)});var j=H(te),R=v(j),ae=v(R),V=v(ae),Ue=v(V);g(V);var ne=u(V,2),re=v(ne),se=u(v(re),2),Le=v(se,!0);g(se),g(re),g(ne),g(ae),g(R);var Be=u(R,2);{var He=t=>{var n=yt();I(t,n)},Ne=t=>{var n=ve(),o=H(n);{var c=x=>{var $=ht(),B=v($),J=v(B,!0);g(B),g($),O(()=>me(J,e(F))),I(x,$)},W=x=>{var $=ve(),B=H($);{var J=K=>{var ce=_t(),de=H(ce);{let P=h(()=>(e(a),p(()=>e(a).name||"Enterprise"))),C=h(()=>(e(a),p(()=>e(a).endpoint?.name))),Je=h(()=>(ge(Ee),p(()=>Ee("github"))));i(()=>mt(de,{get title(){return e(P)},get subtitle(){return`Endpoint: ${e(C)??""} â€¢ GitHub Enterprise`},get forgeIcon(){return e(Je)},onEdit:()=>r(S,!0),onDelete:()=>r(A,!0)}),"component",s,326,2,{componentTag:"DetailHeader"})}var pe=u(de,2);i(()=>pt(pe,{get entity(){return e(a)},entityType:"enterprise"}),"component",s,335,2,{componentTag:"EntityInformation"});var ue=u(pe,2);{let P=h(()=>(e(a),p(()=>e(a).id||""))),C=h(()=>(e(a),p(()=>e(a).name||"")));i(()=>ut(ue,{get pools(){return e(f)},entityType:"enterprise",get entityId(){return e(P)},get entityName(){return e(C)},$$events:{addPool:Ce}}),"component",s,338,2,{componentTag:"PoolsSection"})}var fe=u(ue,2);i(()=>vt(fe,{get instances(){return e(y)},entityType:"enterprise",onDeleteInstance:Pe}),"component",s,347,2,{componentTag:"InstancesSection"});var We=u(fe,2);{let P=h(()=>(e(a),p(()=>e(a)?.events)));i(()=>ft(We,{get events(){return e(P)},get eventsContainer(){return e(b)},set eventsContainer(C){r(b,C)},$$legacy:!0}),"component",s,350,2,{componentTag:"EventsSection"})}I(K,ce)};i(()=>_(B,K=>{e(a)&&K(J)},!0),"if",s,324,1)}I(x,$)};i(()=>_(o,x=>{e(F)?x(c):x(W,!1)},!0),"if",s,320,1)}I(t,n)};i(()=>_(Be,t=>{e(G)?t(He):t(Ne,!1)}),"if",s,315,1)}g(j);var oe=u(j,2);{var qe=t=>{i(()=>dt(t,{get entity(){return e(a)},entityType:"enterprise",$$events:{close:()=>r(S,!1),submit:n=>we(n.detail)}}),"component",s,356,1,{componentTag:"UpdateEntityModal"})};i(()=>_(oe,t=>{e(S)&&e(a)&&t(qe)}),"if",s,355,0)}var ie=u(oe,2);{var ze=t=>{i(()=>_e(t,{title:"Delete Enterprise",message:"Are you sure you want to delete this enterprise? This action cannot be undone and will remove all associated pools and instances.",get itemName(){return e(a),p(()=>e(a).name)},$$events:{close:()=>r(A,!1),confirm:De}}),"component",s,365,1,{componentTag:"DeleteModal"})};i(()=>_(ie,t=>{e(A)&&e(a)&&t(ze)}),"if",s,364,0)}var le=u(ie,2);{var Ge=t=>{i(()=>_e(t,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return e(m),p(()=>e(m).name)},$$events:{close:()=>{r(M,!1),r(m,null)},confirm:Me}}),"component",s,375,1,{componentTag:"DeleteModal"})};i(()=>_(le,t=>{e(M)&&e(m)&&t(Ge)}),"if",s,374,0)}var je=u(le,2);{var Re=t=>{{let n=h(()=>(e(a),p(()=>e(a).id||"")));i(()=>gt(t,{initialEntityType:"enterprise",get initialEntityId(){return e(n)},$$events:{close:()=>r(U,!1),submit:ke}}),"component",s,385,1,{componentTag:"CreatePoolModal"})}};i(()=>_(je,t=>{e(U)&&e(a)&&t(Re)}),"if",s,384,0)}O(t=>{ct(Ue,"href",t),me(Le,(e(a),p(()=>e(a)?e(a).name:"Loading...")))},[()=>(ge(N),p(()=>N("/enterprises")))]),I(be,te);var Ve=nt({...Qe()});return Ie(),Ve}export{s as component};
