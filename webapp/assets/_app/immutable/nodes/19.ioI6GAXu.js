import{f as k,e as ke,a as v,s as H,t as Oe,c as we,h as Pt}from"../chunks/o8CdT7B0.js";import{i as st}from"../chunks/ChJfoPF0.js";import{p as lt,v as Rt,o as it,g as e,m as n,d as r,q as zt,l as U,b as nt,f as V,s as a,c as s,r as o,t as S,n as rr,k as Ge,u as f,a as dt,i as ar,h as ct,$ as At}from"../chunks/DUMcBckj.js";import{i as x,s as ut,a as vt}from"../chunks/i7pKks78.js";import{r as B,s as tr,b as He,g as A,d as tt,c as Dt}from"../chunks/BrpPrY5G.js";import{P as Ut}from"../chunks/Cu6aoEGS.js";import{e as Ar,i as Dr}from"../chunks/DC7Aeygn.js";import{b as le,a as at}from"../chunks/BtzOUN4g.js";import{p as It}from"../chunks/CdEA5IGF.js";import{M as gt}from"../chunks/BEywZTME.js";import{J as Lt,U as jt,a as Ot,b as Gt}from"../chunks/DE-IUNXQ.js";import{e as X}from"../chunks/BZiHL9L3.js";import{w as Ur}from"../chunks/DTRhxHIE.js";import{e as pt,a as ot}from"../chunks/PQvetr74.js";import{U as Ht}from"../chunks/hqIPYtfV.js";import{D as Nt}from"../chunks/BcNnZUp-.js";import{D as qt,G as Ir,A as Ft,L as Bt}from"../chunks/oMjxEQyr.js";import{t as Se}from"../chunks/Bbk4dQfI.js";import{e as Ne,h as Vt}from"../chunks/CDFYnmbx.js";import{E as Jt}from"../chunks/DFpS82qQ.js";import{E as Wt}from"../chunks/B4_S0Pot.js";import{S as Kt}from"../chunks/Bm38E3Lu.js";import{P as Qt}from"../chunks/qg7ZLRoY.js";import"../chunks/Bd2kZdYg.js";var Xt=k('<div class="rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),Yt=k('<div class="animate-pulse bg-gray-200 dark:bg-gray-700 h-10 rounded"></div>'),Zt=k("<option><!></option>"),ea=k('<select id="entity" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"><option> </option><!></select>'),ra=k('<div class="animate-pulse bg-gray-200 dark:bg-gray-700 h-10 rounded"></div>'),ta=k("<option> </option>"),aa=k('<select id="provider" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"><option>Select a provider</option><!></select>'),oa=k('<div class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 flex items-center"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div> <span class="text-sm text-gray-600 dark:text-gray-400">Loading templates...</span></div>'),sa=k("<option> <!></option>"),la=k('<select id="template" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"></select> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Templates define how the runner software is installed and configured. <!></p>',1),ia=k('<div class="w-full px-3 py-2 border border-yellow-300 dark:border-yellow-600 rounded-md bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200"><p class="text-sm"> </p> <p class="text-xs mt-1"><a class="text-yellow-700 dark:text-yellow-300 hover:underline">Create a template first</a> or proceed without a template to use default behavior.</p></div>'),na=k('<div class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-400"><p class="text-sm">Select an entity first to see available templates</p></div>'),da=k('<button type="button" class="underline hover:text-yellow-800 dark:hover:text-yellow-300 cursor-pointer">Enable agent mode</button>'),ca=k('<div class="ml-6 flex items-start space-x-2 text-xs text-yellow-700 dark:text-yellow-400"><svg class="w-4 h-4 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <span> <!></span></div>'),ua=k('<div class="space-y-4"><h3 class="text-lg font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2">Entity & Provider Configuration</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="entity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"> <span class="text-red-500">*</span></label> <!></div> <div><label for="provider" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Provider <span class="text-red-500">*</span></label> <!></div></div></div> <div class="space-y-4"><h3 class="text-lg font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2">Image & OS Configuration</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="image" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Image <span class="text-red-500">*</span></label> <input id="image" type="text" required placeholder="e.g., ubuntu:22.04" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"/></div> <div><label for="flavor" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Flavor <span class="text-red-500">*</span></label> <input id="flavor" type="text" required placeholder="e.g., default" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"/></div> <div><label for="osType" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">OS Type</label> <select id="osType" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"><option>Linux</option><option>Windows</option></select></div> <div><label for="osArch" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Architecture</label> <select id="osArch" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"><option>AMD64</option><option>ARM64</option></select></div></div> <div><label for="template" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Runner Install Template</label> <!></div></div> <div class="space-y-4"><h3 class="text-lg font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2">Runner Limits & Timing</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label for="minIdleRunners" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Min Idle Runners</label> <input id="minIdleRunners" type="number" min="0" placeholder="0" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"/></div> <div><label for="maxRunners" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Runners</label> <input id="maxRunners" type="number" min="1" placeholder="10" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"/></div> <div><label for="bootstrapTimeout" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bootstrap Timeout (min)</label> <input id="bootstrapTimeout" type="number" min="1" placeholder="20" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"/></div></div></div> <div class="space-y-4"><h3 class="text-lg font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700 pb-2">Advanced Settings</h3> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="runnerPrefix" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Runner Prefix</label> <input id="runnerPrefix" type="text" placeholder="garm" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"/></div> <div><label for="githubRunnerGroup" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">GitHub Runner Group (optional)</label> <input id="githubRunnerGroup" type="text" placeholder="Default group" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"/></div></div> <div><div class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Extra Specs (JSON)</div> <!></div> <div class="flex items-center"><input id="enabled" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="enabled" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Enable scale set immediately</label></div> <div class="space-y-2"><div class="flex items-center"><input id="enableShell" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded disabled:opacity-50 disabled:cursor-not-allowed"/> <label for="enableShell">Enable Shell</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute left-full top-1/2 transform -translate-y-1/2 ml-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">This enables remote shell in the GARM agent, allowing users to connect via garm-cli or web UI using websockets. <div class="absolute right-full top-1/2 transform -translate-y-1/2 border-4 border-transparent border-r-gray-900"></div></div></div></div> <!></div></div>',1),va=k('<div class="flex items-center"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div> Creating...</div>'),ga=k('<div class="max-w-6xl w-full max-h-[90vh] overflow-y-auto"><div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700"><h2 class="text-xl font-semibold text-gray-900 dark:text-white">Create New Scale Set</h2> <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Scale sets are only available for GitHub endpoints</p></div> <form class="p-6 space-y-6"><!> <div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Name <span class="text-red-500">*</span></label> <input id="name" type="text" required placeholder="e.g., my-scale-set" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"/></div> <div><fieldset><legend class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Entity Level <span class="text-red-500">*</span></legend> <div class="grid grid-cols-3 gap-4"><button type="button"><svg class="w-8 h-8 mb-2 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"></path></svg> <span class="text-sm font-medium text-gray-900 dark:text-white">Repository</span></button> <button type="button"><svg class="w-8 h-8 mb-2 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <span class="text-sm font-medium text-gray-900 dark:text-white">Organization</span></button> <button type="button"><svg class="w-8 h-8 mb-2 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg> <span class="text-sm font-medium text-gray-900 dark:text-white">Enterprise</span></button></div></fieldset></div> <!> <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200 dark:border-gray-700"><button type="button" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer">Cancel</button> <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"><!></button></div></form></div>'),pa=k("<!> <!>",1);function ba(or,sr){lt(sr,!1);const[lr,ir]=ut(),j=()=>vt(pt,"$eagerCache",lr),ie=n(),$=n(),N=Rt();let Y=n(!1),P=n(""),d=n(""),C=n([]),Z=n([]),_=n([]),O=n(!1),ee=n(!1),re=n(!1),G=n(!1),p=n(null),J=n(""),c=n(""),te=n(""),ne=n(""),de=n(""),ge=n(void 0),pe=n(void 0),$e=n(void 0),Ce=n("garm"),D=n("linux"),be=n("amd64"),Ee=n(""),Me=n(!0),fe=n(!1),ce=n("{}"),I=n(void 0);async function Te(){try{r(ee,!0),r(Z,await A.listProviders())}catch(i){r(P,X(i))}finally{r(ee,!1)}}async function Pe(){try{r(re,!0);const i=Re();if(!i){r(_,[]);return}if(r(_,await A.listTemplates(e(D),void 0,i)),!e(I)||!e(_).find(u=>u.id===e(I))){const u=e(_).find(y=>y.owner_id==="system");u?r(I,u.id):e(_).length>0&&r(I,e(_)[0].id)}}catch(i){r(P,X(i))}finally{r(re,!1)}}function Re(){if(!e(c)||!e(C))return null;const i=e(C).find(u=>u.id===e(c));if(!i)return null;if("forge_type"in i)return i.forge_type;if("endpoint"in i){const u=i.endpoint;if(u&&"endpoint_type"in u)return u.endpoint_type||null}return"github"}function ue(){if(!e(c)||!e(C))return!1;const i=e(C).find(u=>u.id===e(c));return i&&"agent_mode"in i?i.agent_mode??!1:!1}async function qe(){if(e(d))try{switch(r(O,!0),r(C,[]),e(d)){case"repository":r(C,await A.listRepositories());break;case"organization":r(C,await A.listOrganizations());break;case"enterprise":r(C,await A.listEnterprises());break}}catch(i){r(P,X(i))}finally{r(O,!1)}}function me(i){e(d)!==i&&(r(d,i),r(c,""),r(I,void 0),qe())}function Fe(i){if(i.operation!=="update")return;const u=i.payload;if(e(d)==="repository"&&u.id===e(c)){const y=j().repositories.find(L=>L.id===e(c));y&&(Object.assign(y,u),r($,ue()))}else if(e(d)==="organization"&&u.id===e(c)){const y=j().organizations.find(L=>L.id===e(c));y&&(Object.assign(y,u),r($,ue()))}else if(e(d)==="enterprise"&&u.id===e(c)){const y=j().enterprises.find(L=>L.id===e(c));y&&(Object.assign(y,u),r($,ue()))}}async function ye(i){if(!(!e(c)||!e(d)))try{switch(e(d)){case"repository":await A.updateRepository(e(c),i);break;case"organization":await A.updateOrganization(e(c),i);break;case"enterprise":await A.updateEnterprise(e(c),i);break}await qe(),r(G,!1)}catch(u){throw u}}function nr(){return!e(c)||!e(C)?null:e(C).find(i=>i.id===e(c))||null}async function dr(){if(!e(ie)){r(P,"Please fill in all required fields");return}try{r(Y,!0),r(P,"");let i={};if(e(ce).trim())try{i=JSON.parse(e(ce))}catch{throw new Error("Invalid JSON in extra specs")}const u={name:e(J),provider_name:e(te),image:e(ne),flavor:e(de),max_runners:e(ge)||10,min_idle_runners:e(pe)||0,runner_bootstrap_timeout:e($e)||20,runner_prefix:e(Ce),os_type:e(D),os_arch:e(be),"github-runner-group":e(Ee)||void 0,enabled:e(Me),enable_shell:e(fe),extra_specs:e(ce).trim()?i:void 0,template_id:e(I)};let y;switch(e(d)){case"repository":y=await A.createRepositoryScaleSet(e(c),u);break;case"organization":y=await A.createOrganizationScaleSet(e(c),u);break;case"enterprise":y=await A.createEnterpriseScaleSet(e(c),u);break;default:throw new Error("Invalid entity level selected")}N("submit",y)}catch(i){r(P,X(i))}finally{r(Y,!1)}}it(()=>{Te(),e(d)&&(e(d)==="repository"||e(d)==="organization"||e(d)==="enterprise")&&r(p,Ur.subscribeToEntity(e(d),["update"],Fe))}),zt(()=>{e(p)&&(e(p)(),r(p,null))}),U(()=>(e(Y),e(J),e(d),e(c),e(te),e(ne),e(de)),()=>{r(ie,!e(Y)&&e(J).trim()!==""&&e(d)!==""&&e(c)!==""&&e(te)!==""&&e(ne).trim()!==""&&e(de).trim()!=="")}),U(()=>{},()=>{r($,ue())}),U(()=>e($),()=>{e($)||r(fe,!1)}),U(()=>(e(c),e(D)),()=>{e(c)&&e(D)&&Pe()}),U(()=>(e(D),e(c)),()=>{e(D)&&e(c)&&Pe()}),U(()=>(e(d),e(p),Ur),()=>{e(d)&&(e(d)==="repository"||e(d)==="organization"||e(d)==="enterprise")&&(e(p)&&e(p)(),r(p,Ur.subscribeToEntity(e(d),["update"],Fe)))}),nt(),st();var Be=pa(),t=V(Be);gt(t,{$$events:{close:()=>N("close")},children:(i,u)=>{var y=ga(),L=a(s(y),2),Ve=s(L);{var ze=M=>{var q=Xt(),_e=s(q),Ye=s(_e,!0);o(_e),o(q),S(()=>H(Ye,e(P))),v(M,q)};x(Ve,M=>{e(P)&&M(ze)})}var xe=a(Ve,2),Je=a(s(xe),2);B(Je),o(xe);var Ae=a(xe,2),We=s(Ae),W=a(s(We),2),ae=s(W),De=a(ae,2),Ke=a(De,2);o(W),o(We),o(Ae);var Qe=a(Ae,2);{var oe=M=>{var q=ua(),_e=V(q),Ye=a(s(_e),2),ur=s(Ye),vr=s(ur),ft=s(vr);rr(),o(vr);var mt=a(vr,2);{var yt=l=>{var h=Yt();v(l,h)},ht=l=>{var h=ea();S(()=>{e(c),Ge(()=>{e(d),e(C)})});var z=s(h),se=s(z);o(z),z.value=z.__value="";var K=a(z);Ar(K,1,()=>e(C),Dr,(w,g)=>{var E=Zt(),Q=s(E);{var Le=b=>{var R=Oe();S(()=>H(R,`${e(g),f(()=>e(g).owner)??""}/${e(g),f(()=>e(g).name)??""} (${e(g),f(()=>e(g).endpoint?.name||"Unknown endpoint")??""})`)),v(b,R)},F=b=>{var R=Oe();S(()=>H(R,`${e(g),f(()=>e(g).name)??""} (${e(g),f(()=>e(g).endpoint?.name||"Unknown endpoint")??""})`)),v(b,R)};x(Q,b=>{e(d)==="repository"?b(Le):b(F,!1)})}o(E);var T={};S(()=>{T!==(T=(e(g),f(()=>e(g).id)))&&(E.value=(E.__value=(e(g),f(()=>e(g).id)))??"")}),v(w,E)}),o(h),S(()=>H(se,`Select a ${e(d)??""}`)),He(h,()=>e(c),w=>r(c,w)),v(l,h)};x(mt,l=>{e(O)?l(yt):l(ht,!1)})}o(ur);var Lr=a(ur,2),xt=a(s(Lr),2);{var _t=l=>{var h=ra();v(l,h)},kt=l=>{var h=aa();S(()=>{e(te),Ge(()=>{e(Z)})});var z=s(h);z.value=z.__value="";var se=a(z);Ar(se,1,()=>e(Z),Dr,(K,w)=>{var g=ta(),E=s(g,!0);o(g);var Q={};S(()=>{H(E,(e(w),f(()=>e(w).name))),Q!==(Q=(e(w),f(()=>e(w).name)))&&(g.value=(g.__value=(e(w),f(()=>e(w).name)))??"")}),v(K,g)}),o(h),He(h,()=>e(te),K=>r(te,K)),v(l,h)};x(xt,l=>{e(ee)?l(_t):l(kt,!1)})}o(Lr),o(Ye),o(_e);var gr=a(_e,2),pr=a(s(gr),2),br=s(pr),jr=a(s(br),2);B(jr),o(br);var fr=a(br,2),Or=a(s(fr),2);B(Or),o(fr);var mr=a(fr,2),yr=a(s(mr),2);S(()=>{e(D),Ge(()=>{})});var hr=s(yr);hr.value=hr.__value="linux";var Gr=a(hr);Gr.value=Gr.__value="windows",o(yr),o(mr);var Hr=a(mr,2),xr=a(s(Hr),2);S(()=>{e(be),Ge(()=>{})});var _r=s(xr);_r.value=_r.__value="amd64";var Nr=a(_r);Nr.value=Nr.__value="arm64",o(xr),o(Hr),o(pr);var qr=a(pr,2),wt=a(s(qr),2);{var St=l=>{var h=oa();v(l,h)},$t=l=>{var h=we(),z=V(h);{var se=w=>{var g=la(),E=V(g);S(()=>{e(I),Ge(()=>{e(_)})}),Ar(E,5,()=>e(_),Dr,(T,b)=>{var R=sa(),je=s(R),Pr=a(je);{var Rr=zr=>{var rt=Oe();S(()=>H(rt,`- ${e(b),f(()=>e(b).description)??""}`)),v(zr,rt)};x(Pr,zr=>{e(b),f(()=>e(b).description)&&zr(Rr)})}o(R);var er={};S(()=>{H(je,`${e(b),f(()=>e(b).name)??""} ${e(b),f(()=>e(b).owner_id==="system"?"(System)":"")??""} `),er!==(er=(e(b),f(()=>e(b).id)))&&(R.value=(R.__value=(e(b),f(()=>e(b).id)))??"")}),v(T,R)}),o(E);var Q=a(E,2),Le=a(s(Q));{var F=T=>{var b=Oe();S(R=>H(b,`Showing templates for ${R??""} ${e(D)??""}.`),[()=>f(Re)]),v(T,b)};x(Le,T=>{e(c)&&T(F)})}o(Q),He(E,()=>e(I),T=>r(I,T)),v(w,g)},K=w=>{var g=we(),E=V(g);{var Q=F=>{var T=ia(),b=s(T),R=s(b);o(b);var je=a(b,2),Pr=s(je);rr(),o(je),o(T),S((Rr,er)=>{H(R,`No templates found for ${Rr??""} ${e(D)??""}.`),Dt(Pr,"href",er)},[()=>f(Re),()=>(ct(tt),f(()=>tt("/templates")))]),v(F,T)},Le=F=>{var T=na();v(F,T)};x(E,F=>{e(c)?F(Q):F(Le,!1)},!0)}v(w,g)};x(z,w=>{e(_),f(()=>e(_).length>0)?w(se):w(K,!1)},!0)}v(l,h)};x(wt,l=>{e(re)?l(St):l($t,!1)})}o(qr),o(gr);var kr=a(gr,2),Fr=a(s(kr),2),wr=s(Fr),Br=a(s(wr),2);B(Br),o(wr);var Sr=a(wr,2),Vr=a(s(Sr),2);B(Vr),o(Sr);var Jr=a(Sr,2),Wr=a(s(Jr),2);B(Wr),o(Jr),o(Fr),o(kr);var Kr=a(kr,2),$r=a(s(Kr),2),Cr=s($r),Qr=a(s(Cr),2);B(Qr),o(Cr);var Xr=a(Cr,2),Yr=a(s(Xr),2);B(Yr),o(Xr),o($r);var Er=a($r,2),Ct=a(s(Er),2);Lt(Ct,{rows:4,placeholder:"{}",get value(){return e(ce)},set value(l){r(ce,l)},$$legacy:!0}),o(Er);var Mr=a(Er,2),Zr=s(Mr);B(Zr),rr(2),o(Mr);var et=a(Mr,2),Tr=s(et),Ze=s(Tr);B(Ze);var Et=a(Ze,2);rr(2),o(Tr);var Mt=a(Tr,2);{var Tt=l=>{var h=ca(),z=a(s(h),2),se=s(z),K=a(se);{var w=g=>{var E=da();ke("click",E,()=>r(G,!0)),v(g,E)};x(K,g=>{e(c)&&g(w)})}o(z),o(h),S(()=>H(se,`Shell access requires agent mode to be enabled on the ${e(d)??""}. `)),v(l,h)};x(Mt,l=>{e($)||l(Tt)})}o(et),o(Kr),S(l=>{H(ft,`${l??""} `),Ze.disabled=!e($),tr(Et,1,`ml-2 block text-sm font-medium text-gray-700 dark:text-gray-300 ${e($)?"":"opacity-50"}`)},[()=>(e(d),f(()=>e(d).charAt(0).toUpperCase()+e(d).slice(1)))]),le(jr,()=>e(ne),l=>r(ne,l)),le(Or,()=>e(de),l=>r(de,l)),He(yr,()=>e(D),l=>r(D,l)),He(xr,()=>e(be),l=>r(be,l)),le(Br,()=>e(pe),l=>r(pe,l)),le(Vr,()=>e(ge),l=>r(ge,l)),le(Wr,()=>e($e),l=>r($e,l)),le(Qr,()=>e(Ce),l=>r(Ce,l)),le(Yr,()=>e(Ee),l=>r(Ee,l)),at(Zr,()=>e(Me),l=>r(Me,l)),at(Ze,()=>e(fe),l=>r(fe,l)),v(M,q)};x(Qe,M=>{e(d)&&M(oe)})}var ve=a(Qe,2),Xe=s(ve),Ue=a(Xe,2),Ie=s(Ue);{var cr=M=>{var q=va();v(M,q)},bt=M=>{var q=Oe("Create Scale Set");v(M,q)};x(Ie,M=>{e(Y)?M(cr):M(bt,!1)})}o(Ue),o(ve),o(L),o(y),S(()=>{tr(ae,1,`flex flex-col items-center justify-center p-4 border-2 rounded-lg transition-colors cursor-pointer ${e(d)==="repository"?"border-blue-500 bg-blue-50 dark:bg-blue-900":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`),tr(De,1,`flex flex-col items-center justify-center p-4 border-2 rounded-lg transition-colors cursor-pointer ${e(d)==="organization"?"border-blue-500 bg-blue-50 dark:bg-blue-900":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`),tr(Ke,1,`flex flex-col items-center justify-center p-4 border-2 rounded-lg transition-colors cursor-pointer ${e(d)==="enterprise"?"border-blue-500 bg-blue-50 dark:bg-blue-900":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`),Ue.disabled=!e(ie)}),le(Je,()=>e(J),M=>r(J,M)),ke("click",ae,()=>me("repository")),ke("click",De,()=>me("organization")),ke("click",Ke,()=>me("enterprise")),ke("click",Xe,()=>N("close")),ke("submit",L,It(dr)),v(i,y)},$$slots:{default:!0}});var m=a(t,2);{var he=i=>{const u=ar(()=>f(nr));var y=we(),L=V(y);{var Ve=ze=>{var xe=we(),Je=V(xe);{var Ae=W=>{jt(W,{get repository(){return e(u)},$$events:{close:()=>r(G,!1),submit:ae=>ye(ae.detail)}})},We=W=>{var ae=we(),De=V(ae);{var Ke=oe=>{Ot(oe,{get organization(){return e(u)},$$events:{close:()=>r(G,!1),submit:ve=>ye(ve.detail)}})},Qe=oe=>{var ve=we(),Xe=V(ve);{var Ue=Ie=>{Gt(Ie,{get enterprise(){return e(u)},$$events:{close:()=>r(G,!1),submit:cr=>ye(cr.detail)}})};x(Xe,Ie=>{e(d)==="enterprise"&&Ie(Ue)},!0)}v(oe,ve)};x(De,oe=>{e(d)==="organization"?oe(Ke):oe(Qe,!1)},!0)}v(W,ae)};x(Je,W=>{e(d)==="repository"?W(Ae):W(We,!1)})}v(ze,xe)};x(L,ze=>{e(u)&&ze(Ve)})}v(i,y)};x(m,i=>{e(G)&&e(c)&&i(he)})}v(or,Be),dt(),ir()}const fa={};var ma=k('<div class="p-6"><!></div>'),ya=k('<div class="space-y-6"><!> <!></div> <!> <!> <!> <!>',1);function qa(or,sr){lt(sr,!1);const[lr,ir]=ut(),j=()=>vt(pt,"$eagerCache",lr),ie=n(),$=n(),N=n(),Y=n();let P=n([]),d=n(!0),C=n(""),Z=n(""),_=n(1),O=n(25),ee=n(!1),re=n(!1),G=n(!1),p=n(null),J=n(!1);async function c(t){try{r(C,""),r(ee,!1),Se.success("Scale Set Created","Scale set has been created successfully.")}catch(m){throw r(C,X(m)),m}}async function te(t){if(e(p))try{await A.updateScaleSet(e(p).id,t),Se.success("Scale Set Updated",`Scale set ${e(p).name} has been updated successfully.`),r(re,!1),r(p,null)}catch(m){const he=X(m);throw Se.error("Update Failed",he),m}}async function ne(){if(e(p))try{await A.deleteScaleSet(e(p).id),Se.success("Scale Set Deleted",`Scale set ${e(p).name} has been deleted successfully.`)}catch(t){const m=X(t);Se.error("Delete Failed",m)}finally{r(G,!1),r(p,null)}}function de(){r(ee,!0)}async function ge(t){try{r(J,!0);const m=await A.getScaleSet(t.id);r(p,m),r(re,!0)}catch(m){const he=X(m);Se.error("Failed to Load Scale Set Details",he)}finally{r(J,!1)}}function pe(t){r(p,t),r(G,!0)}it(async()=>{try{r(d,!0);const t=await ot.getScaleSets();t&&Array.isArray(t)&&r(P,t)}catch(t){fa?.VITEST||console.error("Failed to load scale sets:",t),r(C,X(t))}finally{r(d,!1)}});async function $e(){try{await ot.retryResource("scalesets")}catch(t){console.error("Retry failed:",t)}}const Ce=[{key:"name",title:"Name",cellComponent:Jt,cellProps:{entityType:"scaleset"}},{key:"image",title:"Image",cellComponent:Ir,cellProps:{field:"image",type:"code",showTitle:!0}},{key:"provider",title:"Provider",cellComponent:Ir,cellProps:{field:"provider_name"}},{key:"flavor",title:"Flavor",cellComponent:Ir,cellProps:{field:"flavor"}},{key:"entity",title:"Entity",cellComponent:Qt},{key:"endpoint",title:"Endpoint",cellComponent:Wt},{key:"status",title:"Status",cellComponent:Kt,cellProps:{statusType:"enabled"}},{key:"actions",title:"Actions",align:"right",cellComponent:Ft}],D={entityType:"scaleset",primaryText:{field:"name",isClickable:!0,href:"/scalesets/{id}"},secondaryText:{field:"entity_name",computedValue:t=>Ne(t)},badges:[{type:"custom",value:t=>({variant:t.enabled?"success":"error",text:t.enabled?"Enabled":"Disabled"})}],actions:[{type:"edit",handler:t=>ge(t)},{type:"delete",handler:t=>pe(t)}]};function be(t){r(Z,t.detail.term),r(_,1)}function Ee(t){r(_,t.detail.page)}function Me(t){r(O,t.detail.perPage),r(_,1)}function fe(t){ge(t.detail.item)}function ce(t){pe(t.detail.item)}U(()=>(e(P),j()),()=>{(!e(P).length||j().loaded.scalesets)&&r(P,j().scalesets)}),U(()=>j(),()=>{r(d,j().loading.scalesets)}),U(()=>j(),()=>{r(ie,j().errorMessages.scalesets)}),U(()=>(e(P),e(Z),Ne),()=>{r($,Vt(e(P),e(Z),t=>Ne(t)))}),U(()=>(e($),e(O)),()=>{r(N,Math.ceil(e($).length/e(O)))}),U(()=>(e(_),e(N)),()=>{e(_)>e(N)&&e(N)>0&&r(_,e(N))}),U(()=>(e($),e(_),e(O)),()=>{r(Y,e($).slice((e(_)-1)*e(O),e(_)*e(O)))}),nt(),st();var I=ya();Pt(t=>{At.title="Scale Sets - GARM"});var Te=V(I),Pe=s(Te);Ut(Pe,{title:"Scale Sets",description:"Manage GitHub runner scale sets",actionLabel:"Add Scale Set",$$events:{action:de}});var Re=a(Pe,2);{let t=ar(()=>e(ie)||e(C)),m=ar(()=>!!e(ie));qt(Re,{get columns(){return Ce},get data(){return e(Y)},get loading(){return e(d)},get error(){return e(t)},get searchTerm(){return e(Z)},searchPlaceholder:"Search by entity name...",get currentPage(){return e(_)},get perPage(){return e(O)},get totalPages(){return e(N)},get totalItems(){return e($),f(()=>e($).length)},itemName:"scale sets",emptyIconType:"cog",get showRetry(){return e(m)},get mobileCardConfig(){return D},$$events:{search:be,pageChange:Ee,perPageChange:Me,retry:$e,edit:fe,delete:ce}})}o(Te);var ue=a(Te,2);{var qe=t=>{ba(t,{$$events:{close:()=>r(ee,!1),submit:m=>c(m.detail)}})};x(ue,t=>{e(ee)&&t(qe)})}var me=a(ue,2);{var Fe=t=>{Ht(t,{get scaleSet(){return e(p)},$$events:{close:()=>{r(re,!1),r(p,null)},submit:m=>te(m.detail)}})};x(me,t=>{e(re)&&e(p)&&t(Fe)})}var ye=a(me,2);{var nr=t=>{{let m=ar(()=>(e(p),ct(Ne),f(()=>`Scale Set ${e(p).name} (${Ne(e(p))})`)));Nt(t,{title:"Delete Scale Set",message:"Are you sure you want to delete this scale set? This action cannot be undone and will remove all associated runners.",get itemName(){return e(m)},$$events:{close:()=>{r(G,!1),r(p,null)},confirm:ne}})}};x(ye,t=>{e(G)&&e(p)&&t(nr)})}var dr=a(ye,2);{var Be=t=>{gt(t,{$$events:{close:()=>{}},children:(m,he)=>{var i=ma(),u=s(i);Bt(u,{message:"Loading scale set details..."}),o(i),v(m,i)},$$slots:{default:!0}})};x(dr,t=>{e(J)&&t(Be)})}v(or,I),dt(),ir()}export{qa as component};
