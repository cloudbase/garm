import{c as Ie,a as B,s as ne,b as D,d as ot,e as Re,l as Je,f as G,h as nt}from"../chunks/CxOx-TIJ.js";import{i as We}from"../chunks/3NxSoY2_.js";import{p as Ve,B as it,o as Ye,l as $,j as r,m as d,g as e,i as W,b as Ke,d as c,s as o,c as n,r as i,t as V,v as Ue,u as y,f as Oe,w as Le,k as se,a as Qe,n as Y,F as M,$ as lt,e as oe,y as dt,h as H}from"../chunks/DzFKsO_V.js";import{a as Xe,i as L,s as Ze,v as et}from"../chunks/B_jyf0qs.js";import{r as Me,b as Ne,d as ct,c as ze,g as Pe}from"../chunks/BguOOs3x.js";import{l as Fe}from"../chunks/BAcG6-Ep.js";import{P as pt}from"../chunks/DTko0dwG.js";import{e as ut,i as mt}from"../chunks/CdXRaxkX.js";import{w as gt}from"../chunks/DoJxysSt.js";import{b as je,a as ft}from"../chunks/BVM1034P.js";import{p as vt}from"../chunks/CdEA5IGF.js";import{M as bt}from"../chunks/Pgjt70l7.js";import{e as fe}from"../chunks/BZiHL9L3.js";import{e as ve,a as De}from"../chunks/Penjr-j0.js";import{U as ht}from"../chunks/B8GNZv7s.js";import{D as yt}from"../chunks/DL1RlOO9.js";import{t as ge}from"../chunks/li_-Mkq2.js";import{k as Te,l as _t}from"../chunks/JkzpcrZD.js";import{B as xt}from"../chunks/1CdJgrM6.js";import{D as kt,E as wt,a as Et,G as Ct,S as $t,A as Mt}from"../chunks/C2FKJqnN.js";import{A as qe}from"../chunks/Ct5kWObc.js";p[M]="src/lib/components/CreateEnterpriseModal.svelte";var Pt=B(G('<div class="mb-4 rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),p[M],[[90,3,[[91,4]]]]),Tt=B(G('<div class="text-center py-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading...</p></div>'),p[M],[[96,3,[[97,4],[98,4]]]]),Dt=B(G("<option> </option>"),p[M],[[130,7]]),At=B(G('<p class="mt-1 text-xs text-gray-600 dark:text-gray-400">Loading credentials...</p>'),p[M],[[136,6]]),Bt=B(G('<p class="mt-1 text-xs text-red-600 dark:text-red-400">No GitHub credentials found. Please create GitHub credentials first.</p>'),p[M],[[140,6]]),Gt=B(G(`<form class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Enterprise Name</label> <input id="name" type="text" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter enterprise name"/></div> <div><label for="credentials" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">GitHub Credentials</label> <select id="credentials" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Select GitHub credentials...</option><!></select> <!></div> <div><div class="flex items-center mb-1"><label for="pool_balancer_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Pool Balancer Type</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50"><div class="mb-2"><strong>Round Robin:</strong> Cycles through pools in turn. Job 1 → Pool 1, Job 2 → Pool 2, etc.</div> <div><strong>Pack:</strong> Uses first available pool until full, then moves to next pool.</div> <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="pool_balancer_type" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Round Robin</option><option>Pack</option></select></div> <div><div class="flex items-center mb-3"><input id="agent-mode" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="agent-mode" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Agent Mode</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">When enabled, runners will be installed with the GARM agent via userdata install templates. This allows for enhanced runner management and control. <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div></div> <div><label for="webhook_secret" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Webhook Secret</label> <input id="webhook_secret" type="password" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter webhook secret"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">You'll need to manually configure this secret in GitHub's enterprise webhook settings.</p></div> <div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 cursor-pointer">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"> </button></div></form>`),p[M],[[101,3,[[103,4,[[104,5],[107,5]]],[118,4,[[119,5],[122,5,[[128,6]]]]],[147,4,[[148,5,[[149,6],[152,6,[[153,7,[[154,8]]],[156,7,[[157,8,[[158,9]]],[160,8,[[161,9]]],[163,8]]]]]]],[167,5,[[172,6],[173,6]]]]],[178,4,[[179,5,[[180,6],[186,6],[189,6,[[190,7,[[191,8]]],[193,7,[[195,8]]]]]]]]],[202,4,[[203,5],[206,5],[213,5]]],[219,4,[[220,5],[227,5]]]]]]),St=B(G('<div class="max-w-2xl w-full p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Create Enterprise</h3> <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Enterprises are only available for GitHub endpoints.</p> <!> <!></div>'),p[M],[[83,1,[[84,2],[85,2]]]]);function p(be,he){Ie(new.target),Ve(he,!1,p);const[ye,_e]=Ze(),g=()=>(et(ve,"eagerCache"),Xe(ve,"$eagerCache",ye)),R=d(),k=d(),f=d(),N=d(),P=it();let C=d(!1),_=d(""),a=d({name:"",credentials_name:"",webhook_secret:"",pool_balancer_type:"roundrobin",agent_mode:!1});async function w(){if(!g().loaded.credentials&&!g().loading.credentials)try{(await Y(De.getCredentials()))()}catch(v){r(_,fe(v))}}async function A(){if(!e(a).name||!e(a).name.trim()){r(_,"Enterprise name is required");return}if(!e(a).credentials_name){r(_,"Please select credentials");return}try{r(C,!0),r(_,"");const v={...e(a)};P("submit",v)}catch(v){r(_,fe(v)),r(C,!1)}}Ye(()=>{w()}),$(()=>g(),()=>{r(R,g().credentials)}),$(()=>g(),()=>{r(k,g().loading.credentials)}),$(()=>e(R),()=>{r(f,e(R).filter(v=>W(v.forge_type,"github")))}),$(()=>e(a),()=>{r(N,e(a).name&&W(e(a).name.trim(),"",!1)&&W(e(a).credentials_name,"",!1)&&e(a).webhook_secret&&W(e(a).webhook_secret.trim(),"",!1))}),Ke(),We(),c(()=>bt(be,{$$events:{close:()=>P("close")},children:gt(p,(v,K)=>{var l=St(),ie=o(n(l),4);{var xe=b=>{var E=Pt(),S=n(E),F=n(S,!0);i(S),i(E),V(()=>ne(F,e(_))),D(b,E)};c(()=>L(ie,b=>{e(_)&&b(xe)}),"if",p,89,2)}var ke=o(ie,2);{var we=b=>{var E=Tt();D(b,E)},O=b=>{var E=Gt(),S=n(E),F=o(n(S),2);Me(F),i(S);var Q=o(S,2),j=o(n(Q),2);V(()=>{e(a),Ue(()=>{e(f)})});var X=n(j);X.value=X.__value="";var Ee=o(X);c(()=>ut(Ee,1,()=>e(f),mt,(s,h)=>{var x=Dt(),U=n(x);i(x);var T={};V(()=>{ne(U,`${e(h),y(()=>e(h).name)??""} (${e(h),y(()=>e(h).endpoint?.name||"Unknown endpoint")??""})`),T!==(T=(e(h),y(()=>e(h).name)))&&(x.value=(x.__value=(e(h),y(()=>e(h).name)))??"")}),D(s,x)}),"each",p,129,6),i(j);var Ce=o(j,2);{var le=s=>{var h=At();D(s,h)},Z=s=>{var h=ot(),x=Oe(h);{var U=T=>{var ae=Bt();D(T,ae)};c(()=>L(x,T=>{e(f),y(()=>W(e(f).length,0))&&T(U)},!0),"if",p,139,5)}D(s,h)};c(()=>L(Ce,s=>{e(k)?s(le):s(Z,!1)}),"if",p,135,5)}i(Q);var q=o(Q,2),ee=o(n(q),2);V(()=>{e(a),Ue(()=>{})});var I=n(ee);I.value=I.__value="roundrobin";var de=o(I);de.value=de.__value="pack",i(ee),i(q);var J=o(q,2),ce=n(J),pe=n(ce);Me(pe),Le(4),i(ce),i(J);var te=o(J,2),ue=o(n(te),2);Me(ue),Le(2),i(te);var t=o(te,2),u=n(t),re=o(u,2),me=n(re,!0);i(re),i(t),i(E),V(()=>{re.disabled=(e(C),e(k),e(N),e(f),y(()=>e(C)||e(k)||!e(N)||W(e(f).length,0))),ne(me,e(C)?"Creating...":"Create Enterprise")}),je(F,()=>e(a).name,s=>se(a,e(a).name=s)),Ne(j,()=>e(a).credentials_name,s=>se(a,e(a).credentials_name=s)),Ne(ee,()=>e(a).pool_balancer_type,s=>se(a,e(a).pool_balancer_type=s)),ft(pe,()=>e(a).agent_mode,s=>se(a,e(a).agent_mode=s)),je(ue,()=>e(a).webhook_secret,s=>se(a,e(a).webhook_secret=s)),Re("click",u,()=>P("close")),Re("submit",E,vt(A)),D(b,E)};c(()=>L(ke,b=>{e(C)?b(we):b(O,!1)}),"if",p,95,2)}i(l),D(v,l)}),$$slots:{default:!0}}),"component",p,82,0,{componentTag:"Modal"});var z=Qe({...Je()});return _e(),z}m[M]="src/routes/enterprises/+page.svelte";var Ht=B(G('<div class="flex items-center justify-between"><div class="flex-1 min-w-0"><a class="block"><p class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 truncate"> </p> <p class="text-sm text-gray-500 dark:text-gray-400 truncate mt-1"> </p></a></div> <div class="flex items-center space-x-3 ml-4"><!> <div class="flex space-x-2"><!> <!></div></div></div>'),m[M],[[270,3,[[271,4,[[272,5,[[273,6],[276,6]]]]],[281,4,[[283,5]]]]]]),Rt=B(G('<div class="space-y-6"><!> <!></div> <!> <!> <!>',1),m[M],[[236,0]]);function m(be,he){Ie(new.target),Ve(he,!1,m);const[ye,_e]=Ze(),g=()=>(et(ve,"eagerCache"),Xe(ve,"$eagerCache",ye)),R=d(),k=d(),f=d(),N=d();let P=d([]),C=d(!0),_=d(""),a=d(""),w=d(1),A=d(25),z=d(!1),v=d(!1),K=d(!1),l=d(null);async function ie(t){try{r(_,""),(await Y(Pe.createEnterprise(t)))(),ge.success("Enterprise Created",`Enterprise ${t.name} has been created successfully.`),r(z,!1)}catch(u){throw r(_,fe(u)),u}}async function xe(t){if(e(l))try{(await Y(Pe.updateEnterprise(e(l).id,t)))(),ge.success("Enterprise Updated",`Enterprise ${e(l).name} has been updated successfully.`),r(v,!1),r(l,null)}catch(u){throw u}}async function ke(){if(e(l))try{r(_,""),(await Y(Pe.deleteEnterprise(e(l).id)))(),ge.success("Enterprise Deleted",`Enterprise ${e(l).name} has been deleted successfully.`),r(K,!1),r(l,null)}catch(t){const u=fe(t);ge.error("Delete Failed",u)}}function we(){r(z,!0)}function O(t){r(l,t),r(v,!0)}function b(t){r(l,t),r(K,!0)}Ye(async()=>{try{r(C,!0);const t=(await Y(De.getEnterprises()))();t&&Array.isArray(t)&&r(P,t)}catch(t){console.error(...Fe("error","Failed to load enterprises:",t)),r(_,t instanceof Error?t.message:"Failed to load enterprises")}finally{r(C,!1)}});async function E(){try{(await Y(De.retryResource("enterprises")))()}catch(t){console.error(...Fe("error","Retry failed:",t))}}const S=[{key:"name",title:"Name",cellComponent:wt,cellProps:{entityType:"enterprise"}},{key:"endpoint",title:"Endpoint",cellComponent:Et},{key:"credentials",title:"Credentials",cellComponent:Ct,cellProps:{field:"credentials_name"}},{key:"status",title:"Status",cellComponent:$t,cellProps:{statusType:"entity"}},{key:"actions",title:"Actions",align:"right",cellComponent:Mt}],F={entityType:"enterprise",primaryText:{field:"name",isClickable:!0,href:"/enterprises/{id}"},secondaryText:{field:"credentials_name"},badges:[{type:"custom",value:t=>Te(t)}],actions:[{type:"edit",handler:t=>O(t)},{type:"delete",handler:t=>b(t)}]};function Q(t){r(a,t.detail.term),r(w,1)}function j(t){r(w,t.detail.page)}function X(t){r(A,t.detail.perPage),r(w,1)}function Ee(t){O(t.detail.item)}function Ce(t){b(t.detail.item)}$(()=>(e(P),g()),()=>{(!e(P).length||g().loaded.enterprises)&&r(P,g().enterprises)}),$(()=>g(),()=>{r(C,g().loading.enterprises)}),$(()=>g(),()=>{r(R,g().errorMessages.enterprises)}),$(()=>(e(P),e(a)),()=>{r(k,_t(e(P),e(a)))}),$(()=>(e(k),e(A)),()=>{r(f,Math.ceil(e(k).length/e(A)))}),$(()=>(e(w),e(f)),()=>{e(w)>e(f)&&e(f)>0&&r(w,e(f))}),$(()=>(e(k),e(w),e(A)),()=>{r(N,e(k).slice((e(w)-1)*e(A),e(w)*e(A)))}),Ke(),We();var le=Rt();nt(t=>{lt.title="Enterprises - GARM"});var Z=Oe(le),q=n(Z);c(()=>pt(q,{title:"Enterprises",description:"Manage GitHub enterprises",actionLabel:"Add Enterprise",$$events:{action:we}}),"component",m,238,1,{componentTag:"PageHeader"});var ee=o(q,2);{let t=oe(()=>e(R)||e(_)),u=oe(()=>!!e(R));c(()=>kt(ee,{get columns(){return S},get data(){return e(N)},get loading(){return e(C)},get error(){return e(t)},get searchTerm(){return e(a)},searchPlaceholder:"Search enterprises...",get currentPage(){return e(w)},get perPage(){return e(A)},get totalPages(){return e(f)},get totalItems(){return e(k),y(()=>e(k).length)},itemName:"enterprises",emptyIconType:"building",get showRetry(){return e(u)},get mobileCardConfig(){return F},$$events:{search:Q,pageChange:j,perPageChange:X,retry:E,edit:Ee,delete:Ce},$$slots:{"mobile-card":(re,me)=>{const s=oe(()=>me.item),h=oe(()=>me.index),x=dt(oe(()=>(H(Te),H(e(s)),y(()=>Te(e(s))))),"status");e(x);var U=Ht(),T=n(U),ae=n(T),$e=n(ae),tt=n($e,!0);i($e);var Ae=o($e,2),rt=n(Ae,!0);i(Ae),i(ae),i(T);var Be=o(T,2),Ge=n(Be);c(()=>xt(Ge,{get variant(){return H(e(x)),y(()=>e(x).variant)},get text(){return H(e(x)),y(()=>e(x).text)}}),"component",m,282,5,{componentTag:"Badge"});var Se=o(Ge,2),He=n(Se);c(()=>qe(He,{action:"edit",size:"sm",title:"Edit enterprise",ariaLabel:"Edit enterprise",$$events:{click:()=>O(e(s))}}),"component",m,284,6,{componentTag:"ActionButton"});var at=o(He,2);c(()=>qe(at,{action:"delete",size:"sm",title:"Delete enterprise",ariaLabel:"Delete enterprise",$$events:{click:()=>b(e(s))}}),"component",m,291,6,{componentTag:"ActionButton"}),i(Se),i(Be),i(U),V(st=>{ct(ae,"href",st),ne(tt,(H(e(s)),y(()=>e(s).name))),ne(rt,(H(e(s)),y(()=>e(s).credentials_name)))},[()=>(H(ze),H(e(s)),y(()=>ze(`/enterprises/${e(s).id}`)))]),D(re,U)}}}),"component",m,245,1,{componentTag:"DataTable"})}i(Z);var I=o(Z,2);{var de=t=>{c(()=>p(t,{$$events:{close:()=>r(z,!1),submit:u=>ie(u.detail)}}),"component",m,308,1,{componentTag:"CreateEnterpriseModal"})};c(()=>L(I,t=>{e(z)&&t(de)}),"if",m,307,0)}var J=o(I,2);{var ce=t=>{c(()=>ht(t,{get entity(){return e(l)},entityType:"enterprise",$$events:{close:()=>{r(v,!1),r(l,null)},submit:u=>xe(u.detail)}}),"component",m,315,1,{componentTag:"UpdateEntityModal"})};c(()=>L(J,t=>{e(v)&&e(l)&&t(ce)}),"if",m,314,0)}var pe=o(J,2);{var te=t=>{c(()=>yt(t,{title:"Delete Enterprise",message:"Are you sure you want to delete this enterprise? This action cannot be undone.",get itemName(){return e(l),y(()=>e(l).name)},$$events:{close:()=>{r(K,!1),r(l,null)},confirm:ke}}),"component",m,324,1,{componentTag:"DeleteModal"})};c(()=>L(pe,t=>{e(K)&&e(l)&&t(te)}),"if",m,323,0)}D(be,le);var ue=Qe({...Je()});return _e(),ue}export{m as component};
