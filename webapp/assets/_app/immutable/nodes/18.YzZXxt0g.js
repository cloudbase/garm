import{c as Le,a as W,s as Re,b as I,e as Pe,l as Ne,f as U,h as at}from"../chunks/CxOx-TIJ.js";import{i as ze}from"../chunks/3NxSoY2_.js";import{p as He,B as ot,o as Oe,l as $,j as r,m as o,g as e,i as V,k as D,b as Je,d as f,s as i,c as d,r as c,t as ne,v as je,u as O,w as Me,a as Ve,n as H,F as P,f as st,$ as nt,e as Be}from"../chunks/DzFKsO_V.js";import{a as Ye,i as Q,s as Ke,v as Qe}from"../chunks/B_jyf0qs.js";import{l as Te}from"../chunks/BAcG6-Ep.js";import{r as Y,b as Ge,g as pe}from"../chunks/BguOOs3x.js";import{e as it,i as lt}from"../chunks/CdXRaxkX.js";import{w as dt}from"../chunks/DoJxysSt.js";import{b as Ee,a as De}from"../chunks/BVM1034P.js";import{p as ct}from"../chunks/CdEA5IGF.js";import{M as ut}from"../chunks/Pgjt70l7.js";import{e as me}from"../chunks/BZiHL9L3.js";import{F as pt}from"../chunks/DvQW-lMP.js";import{e as ge,a as Se}from"../chunks/Penjr-j0.js";import{U as mt}from"../chunks/B8GNZv7s.js";import{D as gt}from"../chunks/DL1RlOO9.js";import{P as ft}from"../chunks/DTko0dwG.js";import{t as K}from"../chunks/li_-Mkq2.js";import{k as bt,g as yt,c as vt,m as ht,p as _t}from"../chunks/JkzpcrZD.js";import{D as wt,E as kt,a as xt,G as $t,S as Ct,A as Rt}from"../chunks/C2FKJqnN.js";p[P]="src/lib/components/CreateRepositoryModal.svelte";var Pt=W(U('<div class="mb-4 rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),p[P],[[132,3,[[133,4]]]]),Mt=W(U('<div class="text-center py-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading...</p></div>'),p[P],[[138,3,[[139,4],[140,4]]]]),Tt=W(U("<option> </option>"),p[P],[[194,7]]),Et=W(U('<input type="password" class="block w-full px-3 py-2 mt-3 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter webhook secret"/>'),p[P],[[284,7]]),Dt=W(U('<p class="text-sm text-gray-500 dark:text-gray-400">Webhook secret will be automatically generated</p>'),p[P],[[291,7]]),St=W(U('<form class="space-y-4"><!> <div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Repository Name</label> <input id="name" type="text" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter repository name"/></div> <div><label for="owner" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Repository Owner</label> <input id="owner" type="text" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter repository owner"/></div> <div><label for="credentials" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Credentials</label> <select id="credentials" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Select credentials...</option><!></select></div> <div><div class="flex items-center mb-1"><label for="pool_balancer_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Pool Balancer Type</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50"><div class="mb-2"><strong>Round Robin:</strong> Cycles through pools in turn. Job 1 → Pool 1, Job 2 → Pool 2, etc.</div> <div><strong>Pack:</strong> Uses first available pool until full, then moves to next pool.</div> <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="pool_balancer_type" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Round Robin</option><option>Pack</option></select></div> <div><div class="flex items-center mb-3"><input id="agent-mode" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="agent-mode" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Agent Mode</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">When enabled, runners will be installed with the GARM agent via userdata install templates. This allows for enhanced runner management and control. <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div></div> <div><div class="flex items-center mb-3"><input id="install-webhook" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="install-webhook" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Install Webhook</label></div> <div class="space-y-3"><div class="flex items-center"><input id="generate-webhook-secret" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="generate-webhook-secret" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Auto-generate webhook secret</label></div> <!></div></div> <div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 cursor-pointer">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"> </button></div></form>'),p[P],[[143,3,[[151,4,[[152,5],[155,5]]],[166,4,[[167,5],[170,5]]],[181,4,[[182,5],[185,5,[[192,6]]]]],[202,4,[[203,5,[[204,6],[207,6,[[208,7,[[209,8]]],[211,7,[[212,8,[[213,9]]],[215,8,[[216,9]]],[218,8]]]]]]],[222,5,[[227,6],[228,6]]]]],[233,4,[[234,5,[[235,6],[241,6],[244,6,[[245,7,[[246,8]]],[248,7,[[250,8]]]]]]]]],[257,4,[[258,5,[[259,6],[265,6]]],[270,5,[[271,6,[[272,7],[278,7]]]]]]],[299,4,[[300,5],[307,5]]]]]]),At=W(U('<div class="max-w-2xl w-full p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Create Repository</h3> <!> <!></div>'),p[P],[[128,1,[[129,2]]]]);function p(fe,be){Le(new.target),He(be,!1,p);const[ye,ve]=Ke(),m=()=>(Qe(ge,"eagerCache"),Ye(ge,"$eagerCache",ye)),S=o(),C=o(),J=o(),M=o(),A=ot();let h=o(!1),b=o(""),y=o("github"),a=o({name:"",owner:"",credentials_name:"",webhook_secret:"",pool_balancer_type:"roundrobin",agent_mode:!1}),q=o(!0),u=o(!0);async function v(){if(!m().loaded.credentials&&!m().loading.credentials)try{(await H(Se.getCredentials()))()}catch(l){r(b,me(l))}}function k(l){r(y,l.detail),D(a,e(a).credentials_name="")}function T(){if(e(a).credentials_name){const l=e(S).find(E=>V(E.name,e(a).credentials_name));l&&l.forge_type&&r(y,l.forge_type)}}function F(){const l=new Uint8Array(32);return crypto.getRandomValues(l),Array.from(l,E=>E.toString(16).padStart(2,"0")).join("")}Oe(()=>{v()});async function he(){if(!e(a).name?.trim()){r(b,"Repository name is required");return}if(!e(a).owner?.trim()){r(b,"Repository owner is required");return}if(!e(a).credentials_name){r(b,"Please select credentials");return}try{r(h,!0),r(b,"");const l={...e(a),install_webhook:e(q),auto_generate_secret:e(u)};A("submit",l)}catch(l){r(b,me(l)),r(h,!1)}}$(()=>m(),()=>{r(S,m().credentials)}),$(()=>m(),()=>{r(C,m().loading.credentials)}),$(()=>(e(S),e(y)),()=>{r(J,e(S).filter(l=>e(y)?V(l.forge_type,e(y)):!0))}),$(()=>e(u),()=>{e(u)?D(a,e(a).webhook_secret=F()):e(u)||D(a,e(a).webhook_secret="")}),$(()=>(e(a),e(u)),()=>{r(M,V(e(a).name?.trim(),"",!1)&&V(e(a).owner?.trim(),"",!1)&&V(e(a).credentials_name,"",!1)&&(e(u)||V(e(a).webhook_secret?.trim(),"",!1)))}),Je(),ze(),f(()=>ut(fe,{$$events:{close:()=>A("close")},children:dt(p,(l,E)=>{var X=At(),le=i(d(X),2);{var _e=_=>{var w=Pt(),j=d(w),B=d(j,!0);c(j),c(w),ne(()=>Re(B,e(b))),I(_,w)};f(()=>Q(le,_=>{e(b)&&_(_e)}),"if",p,131,2)}var we=i(le,2);{var ke=_=>{var w=Mt();I(_,w)},xe=_=>{var w=St(),j=d(w);f(()=>pt(j,{get selectedForgeType(){return e(y)},set selectedForgeType(s){r(y,s)},$$events:{select:k},$$legacy:!0}),"component",p,145,4,{componentTag:"ForgeTypeSelector"});var B=i(j,2),Z=i(d(B),2);Y(Z),c(B);var G=i(B,2),ee=i(d(G),2);Y(ee),c(G);var te=i(G,2),L=i(d(te),2);ne(()=>{e(a),je(()=>{e(J)})});var re=d(L);re.value=re.__value="";var de=i(re);f(()=>it(de,1,()=>e(J),lt,(s,g)=>{var z=Tt(),rt=d(z);c(z);var qe={};ne(()=>{Re(rt,`${e(g),O(()=>e(g).name)??""} (${e(g),O(()=>e(g).endpoint?.name)??""})`),qe!==(qe=(e(g),O(()=>e(g).name)))&&(z.value=(z.__value=(e(g),O(()=>e(g).name)))??"")}),I(s,z)}),"each",p,193,6),c(L),c(te);var ae=i(te,2),oe=i(d(ae),2);ne(()=>{e(a),je(()=>{})});var se=d(oe);se.value=se.__value="roundrobin";var ce=i(se);ce.value=ce.__value="pack",c(oe),c(ae);var t=i(ae,2),n=d(t),ue=d(n);Y(ue),Me(4),c(n),c(t);var R=i(t,2),N=d(R),Ae=d(N);Y(Ae),Me(2),c(N);var Fe=i(N,2),$e=d(Fe),Ie=d($e);Y(Ie),Me(2),c($e);var Xe=i($e,2);{var Ze=s=>{var g=Et();Y(g),Ee(g,()=>e(a).webhook_secret,z=>D(a,e(a).webhook_secret=z)),I(s,g)},et=s=>{var g=Dt();I(s,g)};f(()=>Q(Xe,s=>{e(u)?s(et,!1):s(Ze)}),"if",p,283,6)}c(Fe),c(R);var We=i(R,2),Ue=d(We),Ce=i(Ue,2),tt=d(Ce,!0);c(Ce),c(We),c(w),ne(()=>{Ce.disabled=e(h)||e(C)||!e(M),Re(tt,e(h)?"Creating...":"Create Repository")}),Ee(Z,()=>e(a).name,s=>D(a,e(a).name=s)),Ee(ee,()=>e(a).owner,s=>D(a,e(a).owner=s)),Ge(L,()=>e(a).credentials_name,s=>D(a,e(a).credentials_name=s)),Pe("change",L,T),Ge(oe,()=>e(a).pool_balancer_type,s=>D(a,e(a).pool_balancer_type=s)),De(ue,()=>e(a).agent_mode,s=>D(a,e(a).agent_mode=s)),De(Ae,()=>e(q),s=>r(q,s)),De(Ie,()=>e(u),s=>r(u,s)),Pe("click",Ue,()=>A("close")),Pe("submit",w,ct(he)),I(_,w)};f(()=>Q(we,_=>{e(h)?_(ke):_(xe,!1)}),"if",p,137,2)}c(X),I(l,X)}),$$slots:{default:!0}}),"component",p,127,0,{componentTag:"Modal"});var ie=Ve({...Ne()});return ve(),ie}x[P]="src/routes/repositories/+page.svelte";var Ft=W(U('<div class="space-y-6"><!> <!></div> <!> <!> <!>',1),x[P],[[277,0]]);function x(fe,be){Le(new.target),He(be,!1,x);const[ye,ve]=Ke(),m=()=>(Qe(ge,"eagerCache"),Ye(ge,"$eagerCache",ye)),S=o(),C=o(),J=o();let M=o([]),A=o(!0),h=o(""),b=o(""),y=o(!1),a=o(!1),q=o(!1),u=o(null),v=o(null),k=o(1),T=o(25),F=o(1);Oe(async()=>{try{r(A,!0);const t=(await H(Se.getRepositories()))();t&&Array.isArray(t)&&r(M,t)}catch(t){console.error(...Te("error","Failed to load repositories:",t)),r(h,t instanceof Error?t.message:"Failed to load repositories")}finally{r(A,!1)}});async function he(){try{(await H(Se.retryResource("repositories")))()}catch(t){console.error(...Te("error","Retry failed:",t))}}function ie(t){r(u,t),r(a,!0)}function l(t){r(v,t),r(q,!0)}function E(){r(y,!1),r(a,!1),r(q,!1),r(u,null),r(v,null),r(h,"")}async function X(t){try{r(h,"");const n=t.detail,ue={name:n.name,owner:n.owner,credentials_name:n.credentials_name,webhook_secret:n.webhook_secret},R=(await H(pe.createRepository(ue)))();if(n.install_webhook&&R.id)try{(await H(pe.installRepoWebhook(R.id)))(),K.success("Webhook Installed",`Webhook for repository ${R.owner}/${R.name} has been installed successfully.`)}catch(N){console.warn(...Te("warn","Repository created but webhook installation failed:",N)),K.error("Webhook Installation Failed",N instanceof Error?N.message:"Failed to install webhook. You can try installing it manually from the repository details page.")}r(y,!1),K.success("Repository Created",`Repository ${R.owner}/${R.name} has been created successfully.`)}catch(n){throw r(h,me(n)),n}}async function le(t){if(e(u))try{(await H(pe.updateRepository(e(u).id,t)))(),K.success("Repository Updated",`Repository ${e(u).owner}/${e(u).name} has been updated successfully.`),E()}catch(n){throw n}}async function _e(){if(e(v))try{r(h,""),(await H(pe.deleteRepository(e(v).id)))(),K.success("Repository Deleted",`Repository ${e(v).owner}/${e(v).name} has been deleted successfully.`)}catch(t){const n=me(t);K.error("Delete Failed",n)}finally{E()}}const we=[{key:"repository",title:"Repository",cellComponent:kt,cellProps:{entityType:"repository",showOwner:!0}},{key:"endpoint",title:"Endpoint",cellComponent:xt},{key:"credentials",title:"Credentials",cellComponent:$t,cellProps:{field:"credentials_name"}},{key:"status",title:"Status",cellComponent:Ct,cellProps:{statusType:"entity"}},{key:"actions",title:"Actions",align:"right",cellComponent:Rt}],ke={entityType:"repository",primaryText:{field:"name",isClickable:!0,href:"/repositories/{id}",showOwner:!0},customInfo:[{icon:t=>yt(t?.endpoint?.endpoint_type||"unknown"),text:t=>t?.endpoint?.name||"Unknown"}],badges:[{type:"custom",value:t=>bt(t)}],actions:[{type:"edit",handler:t=>ie(t)},{type:"delete",handler:t=>l(t)}]};function xe(t){r(b,t.detail.term),r(k,1)}function _(t){r(k,t.detail.page)}function w(t){const n=vt(t.detail.perPage);r(T,n.newPerPage),r(k,n.newCurrentPage)}function j(t){ie(t.detail.item)}function B(t){l(t.detail.item)}$(()=>(e(M),m()),()=>{(!e(M).length||m().loaded.repositories)&&r(M,m().repositories)}),$(()=>m(),()=>{r(A,m().loading.repositories)}),$(()=>m(),()=>{r(S,m().errorMessages.repositories)}),$(()=>(e(M),e(b)),()=>{r(C,ht(e(M),e(b)))}),$(()=>(e(F),e(C),e(T),e(k)),()=>{r(F,Math.ceil(e(C).length/e(T))),e(k)>e(F)&&e(F)>0&&r(k,e(F))}),$(()=>(e(C),e(k),e(T)),()=>{r(J,_t(e(C),e(k),e(T)))}),Je(),ze();var Z=Ft();at(t=>{nt.title="Repositories - GARM"});var G=st(Z),ee=d(G);f(()=>ft(ee,{title:"Repositories",description:"Manage your GitHub repositories and their runners",actionLabel:"Add Repository",$$events:{action:()=>{r(y,!0)}}}),"component",x,279,1,{componentTag:"PageHeader"});var te=i(ee,2);{let t=Be(()=>e(S)||e(h)),n=Be(()=>!!e(S));f(()=>wt(te,{get columns(){return we},get data(){return e(J)},get loading(){return e(A)},get error(){return e(t)},get searchTerm(){return e(b)},searchPlaceholder:"Search repositories by name or owner...",get currentPage(){return e(k)},get perPage(){return e(T)},get totalPages(){return e(F)},get totalItems(){return e(C),O(()=>e(C).length)},itemName:"repositories",emptyIconType:"building",get showRetry(){return e(n)},get mobileCardConfig(){return ke},$$events:{search:xe,pageChange:_,perPageChange:w,retry:he,edit:j,delete:B}}),"component",x,286,1,{componentTag:"DataTable"})}c(G);var L=i(G,2);{var re=t=>{f(()=>p(t,{$$events:{close:()=>r(y,!1),submit:X}}),"component",x,312,1,{componentTag:"CreateRepositoryModal"})};f(()=>Q(L,t=>{e(y)&&t(re)}),"if",x,311,0)}var de=i(L,2);{var ae=t=>{f(()=>mt(t,{get entity(){return e(u)},entityType:"repository",$$events:{close:E,submit:n=>le(n.detail)}}),"component",x,319,1,{componentTag:"UpdateEntityModal"})};f(()=>Q(de,t=>{e(a)&&e(u)&&t(ae)}),"if",x,318,0)}var oe=i(de,2);{var se=t=>{f(()=>gt(t,{title:"Delete Repository",message:"Are you sure you want to delete this repository? This action cannot be undone and will remove all associated pools and runners.",get itemName(){return`${e(v),O(()=>e(v).owner)??""}/${e(v),O(()=>e(v).name)??""}`},$$events:{close:E,confirm:_e}}),"component",x,328,1,{componentTag:"DeleteModal"})};f(()=>Q(oe,t=>{e(q)&&e(v)&&t(se)}),"if",x,327,0)}I(fe,Z);var ce=Ve({...Ne()});return ve(),ce}export{x as component};
