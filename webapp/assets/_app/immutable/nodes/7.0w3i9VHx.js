import"../chunks/DsnmJJEf.js";import{i as Xe}from"../chunks/B3Pzt0F_.js";import{p as Ye,o as Ze,l as R,a as er,f as m,h as rr,t as re,g as e,e as ar,c as n,d as tr,m as i,$ as dr,j as a,k as d,s,r as t,z as L,u as h,C as lr,b as sr,D as or,v as $e,q as ir}from"../chunks/D8EpLgQ1.js";import{i as u,s as nr,a as vr}from"../chunks/5WA7h8uK.js";import{B as Ue,r as A,s as F,c as ze}from"../chunks/CiE1LlKV.js";import{b as P}from"../chunks/C6k1Q4We.js";import{p as mr}from"../chunks/D4Caz1gY.js";import{g as W}from"../chunks/CTf6mQoE.js";import{b as q}from"../chunks/CoIRRsD9.js";import{a as cr,b as ur}from"../chunks/duD3WMbl.js";import{t as pr}from"../chunks/BEkVdVE1.js";var br=m('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Username is required</p>'),gr=m('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Please enter a valid email address</p>'),fr=m('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Full name is required</p>'),xr=m('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Password must be at least 8 characters long</p>'),hr=m('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Passwords do not match</p>'),yr=lr('<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> Advanced Configuration (Optional)',1),kr=m('<div class="mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-md border border-gray-200 dark:border-gray-600"><div class="space-y-4"><div><label for="metadataUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Metadata URL</label> <div class="mt-1"><input id="metadataUrl" name="metadataUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/api/v1/metadata"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where runners can fetch metadata and setup information.</p></div></div> <div><label for="callbackUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Callback URL</label> <div class="mt-1"><input id="callbackUrl" name="callbackUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/api/v1/callbacks"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where runners send status updates and lifecycle events.</p></div></div> <div><label for="webhookUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Webhook URL</label> <div class="mt-1"><input id="webhookUrl" name="webhookUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/webhooks"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where GitHub/Gitea will send webhook events for job notifications.</p></div></div></div></div>'),_r=m("<li>Enter a username</li>"),wr=m("<li>Enter a valid email address</li>"),$r=m("<li>Enter your full name</li>"),Ur=m("<li>Enter a password with at least 8 characters</li>"),zr=m("<li>Confirm your password</li>"),Mr=m('<div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Please complete all required fields</h3> <div class="mt-2 text-sm text-yellow-700 dark:text-yellow-300"><ul class="list-disc list-inside space-y-1"><!> <!> <!> <!> <!></ul></div></div></div></div>'),Rr=m('<div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><p class="text-sm text-red-800 dark:text-red-200"> </p></div></div></div>'),Ar=m('<div class="min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col justify-center py-12 sm:px-6 lg:px-8"><div class="sm:mx-auto sm:w-full sm:max-w-md"><div class="flex justify-center"><img alt="GARM" class="h-16 w-auto dark:hidden"/> <img alt="GARM" class="h-16 w-auto hidden dark:block"/></div> <h1 class="mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white">Welcome to GARM</h1> <p class="mt-2 text-center text-sm text-gray-600 dark:text-gray-400">Complete the first-run setup to get started</p></div> <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md"><div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 mb-6"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">First-Run Initialization</h3> <div class="mt-2 text-sm text-blue-700 dark:text-blue-300"><p>GARM needs to be initialized before first use. This will create the admin user and generate a unique controller ID for this installation.</p></div></div></div></div> <div class="bg-white dark:bg-gray-800 py-8 px-4 shadow sm:rounded-lg sm:px-10"><form class="space-y-6"><div><label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Username</label> <div class="mt-1"><input id="username" name="username" type="text" required placeholder="Enter admin username"/> <!></div></div> <div><label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email Address</label> <div class="mt-1"><input id="email" name="email" type="email" required placeholder="admin@example.com"/> <!></div></div> <div><label for="fullName" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Full Name</label> <div class="mt-1"><input id="fullName" name="fullName" type="text" required placeholder="Enter full name"/> <!></div></div> <div><label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label> <div class="mt-1"><input id="password" name="password" type="password" required placeholder="Choose a strong password"/> <!></div></div> <div><label for="confirmPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Confirm Password</label> <div class="mt-1"><input id="confirmPassword" name="confirmPassword" type="password" required placeholder="Confirm your password"/> <!></div></div> <div class="pt-4"><!> <!></div> <!> <!> <div><!></div></form> <div class="mt-6"><div class="text-center"><p class="text-xs text-gray-500 dark:text-gray-400">This will create the admin user, generate a unique controller ID, and configure the required URLs for your GARM installation. <br/> Make sure to remember these credentials as they cannot be recovered.</p></div></div></div></div></div>');function Sr(Me,Re){Ye(Re,!1);const[Ae,Pe]=nr(),C=()=>vr(cr,"$authStore",Ae),k=i(),_=i(),w=i(),$=i(),U=i(),N=i();let g=i("admin"),p=i("admin@garm.local"),c=i(""),f=i(""),x=i("Administrator"),S=i(!1),H=i(""),T=i(!1),E=i(""),I=i(""),V=i("");async function qe(){if(e(N))try{s(S,!0),s(H,""),await ur.initialize(e(g).trim(),e(p).trim(),e(c),e(x).trim(),{callbackUrl:e(E).trim()||void 0,metadataUrl:e(I).trim()||void 0,webhookUrl:e(V).trim()||void 0}),pr.success("GARM Initialized","GARM has been successfully initialized. Welcome!"),W(`${q}/`)}catch(r){s(H,r instanceof Error?r.message:"Failed to initialize GARM")}finally{s(S,!1)}}Ze(()=>{if(C().isAuthenticated){W(`${q}/`);return}!C().needsInitialization&&!C().loading&&W(`${q}/login`)}),R(()=>(e(E),e(I),e(V)),()=>{if(typeof window<"u"){const r=window.location.origin;e(E)||s(E,`${r}/api/v1/callbacks`),e(I)||s(I,`${r}/api/v1/metadata`),e(V)||s(V,`${r}/webhooks`)}}),R(()=>e(p),()=>{s(k,e(p).trim()!==""&&e(p).includes("@"))}),R(()=>e(c),()=>{s(_,e(c).length>=8)}),R(()=>(e(f),e(c)),()=>{s(w,e(f).length>0&&e(c)===e(f))}),R(()=>e(g),()=>{s($,e(g).trim()!=="")}),R(()=>e(x),()=>{s(U,e(x).trim()!=="")}),R(()=>(e($),e(k),e(U),e(_),e(w)),()=>{s(N,e($)&&e(k)&&e(U)&&e(_)&&e(w))}),R(()=>(C(),q),()=>{C().isAuthenticated?W(`${q}/`):!C().needsInitialization&&!C().loading&&W(`${q}/login`)}),er(),Xe();var ae=Ar();rr(r=>{dr.title="Initialize GARM - First Run Setup"});var te=a(ae),me=a(te),ce=a(me),Ce=d(ce,2);t(me),L(4),t(te);var ue=d(te,2),pe=d(a(ue),2),de=a(pe),le=a(de),be=d(a(le),2),O=a(be);A(O);var Ge=d(O,2);{var Le=r=>{var l=br();n(r,l)};u(Ge,r=>{e($),e(g),h(()=>!e($)&&e(g).length>0)&&r(Le)})}t(be),t(le);var se=d(le,2),ge=d(a(se),2),J=a(ge);A(J);var Ee=d(J,2);{var Ie=r=>{var l=gr();n(r,l)};u(Ee,r=>{e(k),e(p),h(()=>!e(k)&&e(p).length>0)&&r(Ie)})}t(ge),t(se);var oe=d(se,2),fe=d(a(oe),2),K=a(fe);A(K);var Ve=d(K,2);{var Be=r=>{var l=fr();n(r,l)};u(Ve,r=>{e(U),e(x),h(()=>!e(U)&&e(x).length>0)&&r(Be)})}t(fe),t(oe);var ie=d(oe,2),xe=d(a(ie),2),Q=a(xe);A(Q);var Fe=d(Q,2);{var Ne=r=>{var l=xr();n(r,l)};u(Fe,r=>{e(_),e(c),h(()=>!e(_)&&e(c).length>0)&&r(Ne)})}t(xe),t(ie);var ne=d(ie,2),he=d(a(ne),2),X=a(he);A(X);var Se=d(X,2);{var je=r=>{var l=hr();n(r,l)};u(Se,r=>{e(w),e(f),h(()=>!e(w)&&e(f).length>0)&&r(je)})}t(he),t(ne);var ve=d(ne,2),ye=a(ve);Ue(ye,{type:"button",variant:"ghost",size:"sm",$$events:{click:()=>s(T,!e(T))},children:(r,l)=>{var b=yr(),v=sr(b);L(),re(()=>F(v,0,`w-4 h-4 mr-2 transition-transform ${e(T)?"rotate-90":""}`)),n(r,b)},$$slots:{default:!0}});var De=d(ye,2);{var We=r=>{var l=kr(),b=a(l),v=a(b),z=d(a(v),2),G=a(z);A(G),L(2),t(z),t(v);var B=d(v,2),Y=d(a(B),2),j=a(Y);A(j),L(2),t(Y),t(B);var Z=d(B,2),D=d(a(Z),2),ee=a(D);A(ee),L(2),t(D),t(Z),t(b),t(l),P(G,()=>e(I),M=>s(I,M)),P(j,()=>e(E),M=>s(E,M)),P(ee,()=>e(V),M=>s(V,M)),n(r,l)};u(De,r=>{e(T)&&r(We)})}t(ve);var ke=d(ve,2);{var He=r=>{var l=Mr(),b=a(l),v=d(a(b),2),z=d(a(v),2),G=a(z),B=a(G);{var Y=o=>{var y=_r();n(o,y)};u(B,o=>{e($)||o(Y)})}var j=d(B,2);{var Z=o=>{var y=wr();n(o,y)};u(j,o=>{e(k)||o(Z)})}var D=d(j,2);{var ee=o=>{var y=$r();n(o,y)};u(D,o=>{e(U)||o(ee)})}var M=d(D,2);{var Je=o=>{var y=Ur();n(o,y)};u(M,o=>{e(_)||o(Je)})}var Ke=d(M,2);{var Qe=o=>{var y=zr();n(o,y)};u(Ke,o=>{e(w)||o(Qe)})}t(G),t(z),t(v),t(b),t(l),n(r,l)};u(ke,r=>{e(N),e(g),e(p),e(x),e(c),e(f),h(()=>!e(N)&&(e(g).length>0||e(p).length>0||e(x).length>0||e(c).length>0||e(f).length>0))&&r(He)})}var _e=d(ke,2);{var Te=r=>{var l=Rr(),b=a(l),v=d(a(b),2),z=a(v),G=a(z,!0);t(z),t(v),t(b),t(l),re(()=>$e(G,e(H))),n(r,l)};u(_e,r=>{e(H)&&r(Te)})}var we=d(_e,2),Oe=a(we);{let r=ir(()=>!e(N)||e(S));Ue(Oe,{type:"submit",variant:"primary",size:"lg",fullWidth:!0,get loading(){return e(S)},get disabled(){return e(r)},children:(l,b)=>{L();var v=or();re(()=>$e(v,e(S)?"Initializing...":"Initialize GARM")),n(l,v)},$$slots:{default:!0}})}t(we),t(de),L(2),t(pe),t(ue),t(ae),re(()=>{ze(ce,"src",`${q??""}/assets/garm-light.svg`),ze(Ce,"src",`${q??""}/assets/garm-dark.svg`),F(O,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e($),e(g),h(()=>!e($)&&e(g).length>0?"border-red-300 dark:border-red-600":"")??""}`),F(J,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(k),e(p),h(()=>!e(k)&&e(p).length>0?"border-red-300 dark:border-red-600":"")??""}`),F(K,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(U),e(x),h(()=>!e(U)&&e(x).length>0?"border-red-300 dark:border-red-600":"")??""}`),F(Q,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(_),e(c),h(()=>!e(_)&&e(c).length>0?"border-red-300 dark:border-red-600":"")??""}`),F(X,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(w),e(f),h(()=>!e(w)&&e(f).length>0?"border-red-300 dark:border-red-600":"")??""}`)}),P(O,()=>e(g),r=>s(g,r)),P(J,()=>e(p),r=>s(p,r)),P(K,()=>e(x),r=>s(x,r)),P(Q,()=>e(c),r=>s(c,r)),P(X,()=>e(f),r=>s(f,r)),ar("submit",de,mr(qe)),n(Me,ae),tr(),Pe()}export{Sr as component};
