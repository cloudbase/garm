import{c as la,a as k,h as na,b as f,l as oa,s as o,f as S,d as De}from"../chunks/CxOx-TIJ.js";import{i as ca}from"../chunks/3NxSoY2_.js";import{p as va,o as ma,x as xa,l as ua,b as ga,f as R,d as x,t as D,a as fa,s,g as e,m as I,u as i,h as p,F as h,c as a,j as v,$ as pa,r,e as A,n as C,k as B,i as _}from"../chunks/DzFKsO_V.js";import{i as y}from"../chunks/B_jyf0qs.js";import{c as $,d as q,g as z,s as nt}from"../chunks/BguOOs3x.js";import{p as ot}from"../chunks/CH-vk5qo.js";import{g as ct}from"../chunks/BzzAh3Be.js";import{U as _a}from"../chunks/CZK5Ma2H.js";import{D as vt}from"../chunks/DL1RlOO9.js";import{I as ya}from"../chunks/CzarUgpd.js";import{D as ha}from"../chunks/BLYRAgBX.js";import{w as mt}from"../chunks/DSHGoHxX.js";import{t as V}from"../chunks/li_-Mkq2.js";import{e as xt}from"../chunks/BZiHL9L3.js";import{e as N,i as W,j as ut,b as K,g as gt}from"../chunks/JkzpcrZD.js";import{F as ba}from"../chunks/DaHsWCjd.js";n[h]="src/routes/scalesets/[id]/+page.svelte";var ka=k(S('<div class="p-6 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading scale set...</p></div>'),n[h],[[227,2,[[228,3],[229,3]]]]),Sa=k(S('<div class="rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),n[h],[[232,2,[[233,3]]]]),wa=k(S('<a class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300"> </a>'),n[h],[[351,9]]),Da=k(S('<a class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300"> </a>'),n[h],[[355,9]]),Ia=k(S('<span class="text-sm text-gray-500 dark:text-gray-400">Default system template</span>'),n[h],[[359,9]]),$a=k(S('<div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">GitHub Runner Group</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div>'),n[h],[[364,7,[[365,8],[366,8]]]]),Ta=k(S('<div class="bg-white dark:bg-gray-800 shadow rounded-lg"><div class="px-4 py-5 sm:p-6"><h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Extra Specifications</h2> <pre class="bg-gray-100 dark:bg-gray-700 p-4 rounded-md overflow-x-auto text-sm text-gray-900 dark:text-white font-mono"> </pre></div></div>'),n[h],[[378,3,[[379,4,[[380,5],[381,5]]]]]]),Ma=k(S('<!> <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-white dark:bg-gray-800 shadow rounded-lg"><div class="px-4 py-5 sm:p-6"><h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Basic Information</h2> <dl class="space-y-4"><div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Scale Set ID</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Name</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white font-medium"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Provider</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Forge Type</dt> <dd class="mt-1"><!></dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Image</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"><code class="bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-xs"> </code></dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Flavor</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Status</dt> <dd class="mt-1"><span> </span></dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Entity</dt> <dd class="mt-1"><div class="flex items-center space-x-2"><span class="inline-flex px-2 py-1 text-xs font-medium rounded-full bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"> </span> <a class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300"> </a></div></dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Created At</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Updated At</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div></dl></div></div> <div class="bg-white dark:bg-gray-800 shadow rounded-lg"><div class="px-4 py-5 sm:p-6"><h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Configuration</h2> <dl class="space-y-4"><div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Max Runners</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Min Idle Runners</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Bootstrap Timeout</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Runner Prefix</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">OS Type / Architecture</dt> <dd class="mt-1 text-sm text-gray-900 dark:text-white"> </dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Shell Access</dt> <dd class="mt-1"><span> </span></dd></div> <div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Runner Install Template</dt> <dd class="mt-1"><!></dd></div> <!></dl></div></div></div> <!> <!>',1),n[h],[[246,2,[[248,3,[[249,4,[[250,5],[251,5,[[252,6,[[253,7],[254,7]]],[256,6,[[257,7],[258,7]]],[260,6,[[261,7],[262,7]]],[264,6,[[265,7],[266,7]]],[270,6,[[271,7],[272,7,[[273,8]]]]],[276,6,[[277,7],[278,7]]],[280,6,[[281,7],[282,7,[[283,8]]]]],[288,6,[[289,7],[290,7,[[291,8,[[292,9],[295,9]]]]]]],[301,6,[[302,7],[303,7]]],[305,6,[[306,7],[307,7]]]]]]]]],[314,3,[[315,4,[[316,5],[317,5,[[318,6,[[319,7],[320,7]]],[322,6,[[323,7],[324,7]]],[326,6,[[327,7],[328,7]]],[331,6,[[332,7],[333,7]]],[335,6,[[336,7],[337,7]]],[339,6,[[340,7],[341,7,[[342,8]]]]],[347,6,[[348,7],[349,7]]]]]]]]]]]]),Ea=k(S('<div class="space-y-6"><nav class="flex" aria-label="Breadcrumb"><ol class="inline-flex items-center space-x-1 md:space-x-3"><li class="inline-flex items-center"><a class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white"><svg class="w-3 h-3 mr-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg> Scale Sets</a></li> <li><div class="flex items-center"><svg class="w-3 h-3 text-gray-400 mx-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg> <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400"> </span></div></li></ol></nav> <!></div> <!> <!> <!>',1),n[h],[[201,0,[[203,1,[[204,2,[[205,3,[[206,4,[[207,5,[[208,6]]]]]]],[213,3,[[214,4,[[215,5,[[216,6]]],[218,5]]]]]]]]]]]]);function n(ft,pt){la(new.target),va(pt,!1,n);const L=I();let t=I(null),Q=I(!0),G=I(""),H=I(!1),O=I(!1),J=I(!1),b=I(null),P=null;async function Ie(){if(!(!e(L)||isNaN(e(L))))try{v(Q,!0),v(G,""),v(t,(await C(z.getScaleSet(e(L))))()),e(t).instances||B(t,e(t).instances=[])}catch(d){v(G,d instanceof Error?d.message:"Failed to load scale set")}finally{v(Q,!1)}}async function _t(d){if(e(t))try{(await C(z.updateScaleSet(e(t).id,d)))(),(await C(Ie()))(),V.success("Scale Set Updated",`Scale Set ${e(t).name} has been updated successfully.`),v(H,!1)}catch(l){throw l}}async function yt(){if(e(t)){try{(await C(z.deleteScaleSet(e(t).id)))(),ct($("/scalesets"))}catch(d){const l=xt(d);V.error("Delete Failed",l)}v(O,!1)}}async function ht(){if(e(b)){try{(await C(z.deleteInstance(e(b).name)))(),V.success("Instance Deleted",`Instance ${e(b).name} has been deleted successfully.`)}catch(d){const l=xt(d);V.error("Delete Failed",l)}v(J,!1),v(b,null)}}function bt(d){v(b,d),v(J,!0)}function kt(d){if(!d)return"{}";try{if(_(typeof d,"string")){const l=JSON.parse(d);return JSON.stringify(l,null,2)}return JSON.stringify(d,null,2)}catch{return d.toString()}}function St(d){if(_(d.operation,"update")){const l=d.payload;e(t)&&_(l.id,e(t).id)&&v(t,l)}else if(_(d.operation,"delete")){const l=d.payload.id||d.payload;e(t)&&_(e(t).id,l)&&ct($("/scalesets"))}}function wt(d){if(!e(t))return;const l=d.payload;if(!_(l.scale_set_id,e(t).id,!1)){if(e(t).instances||B(t,e(t).instances=[]),_(d.operation,"create"))B(t,e(t).instances=[...e(t).instances,l]);else if(_(d.operation,"update"))B(t,e(t).instances=e(t).instances.map(T=>_(T.id,l.id)?l:T));else if(_(d.operation,"delete")){const T=l.id||l;B(t,e(t).instances=e(t).instances.filter(ee=>_(ee.id,T,!1)))}v(t,e(t))}}ma(()=>{Ie();const d=mt.subscribeToEntity("scaleset",["update","delete"],St),l=mt.subscribeToEntity("instance",["create","update","delete"],wt);P=()=>{d(),l()}}),xa(()=>{P&&(P(),P=null)}),ua(()=>ot,()=>{v(L,parseInt(ot.params.id||"0"))}),ga(),ca();var $e=Ea();na(d=>{D(()=>pa.title=`${e(t),i(()=>e(t)?`${e(t).name} - Scale Set Details`:"Scale Set Details")??""} - GARM`)});var X=R($e),Y=a(X),Te=a(Y),Z=a(Te),Dt=a(Z);r(Z);var Me=s(Z,2),Ee=a(Me),Fe=s(a(Ee),2),It=a(Fe,!0);r(Fe),r(Ee),r(Me),r(Te),r(Y);var $t=s(Y,2);{var Tt=d=>{var l=ka();f(d,l)},Mt=d=>{var l=De(),T=R(l);{var ee=M=>{var E=Sa(),j=a(E),te=a(j,!0);r(j),r(E),D(()=>o(te,e(G))),f(M,E)},Ut=M=>{var E=De(),j=R(E);{var te=ae=>{var Ue=Ma(),Re=R(Ue);{let c=A(()=>(e(t),i(()=>e(t).name||"Scale Set"))),m=A(()=>(p(N),e(t),i(()=>N(e(t))))),u=A(()=>(p(W),e(t),i(()=>W(e(t))))),g=A(()=>(p(gt),i(()=>gt("github"))));x(()=>ha(Re,{get title(){return e(c)},get subtitle(){return`Scale set for ${e(m)??""} (${e(u)??""}) â€¢ GitHub Runner Scale Set`},get forgeIcon(){return e(g)},onEdit:()=>v(H,!0),onDelete:()=>v(O,!0)}),"component",n,237,2,{componentTag:"DetailHeader"})}var re=s(Re,2),de=a(re),Ce=a(de),Be=s(a(Ce),2),se=a(Be),Le=s(a(se),2),Rt=a(Le,!0);r(Le),r(se);var ie=s(se,2),Ge=s(a(ie),2),Ct=a(Ge,!0);r(Ge),r(ie);var le=s(ie,2),He=s(a(le),2),Bt=a(He,!0);r(He),r(le);var ne=s(le,2),Oe=s(a(ne),2),Lt=a(Oe);x(()=>ba(Lt,{get item(){return e(t)}}),"component",n,267,8,{componentTag:"ForgeTypeCell"}),r(Oe),r(ne);var oe=s(ne,2),Je=s(a(oe),2),Pe=a(Je),Gt=a(Pe,!0);r(Pe),r(Je),r(oe);var ce=s(oe,2),je=s(a(ce),2),Ht=a(je,!0);r(je),r(ce);var ve=s(ce,2),qe=s(a(ve),2),me=a(qe),Ot=a(me,!0);r(me),r(qe),r(ve);var xe=s(ve,2),ze=s(a(xe),2),Ve=a(ze),ue=a(Ve),Jt=a(ue,!0);r(ue);var ge=s(ue,2),Pt=a(ge,!0);r(ge),r(Ve),r(ze),r(xe);var fe=s(xe,2),We=s(a(fe),2),jt=a(We,!0);r(We),r(fe);var Ke=s(fe,2),Qe=s(a(Ke),2),qt=a(Qe,!0);r(Qe),r(Ke),r(Be),r(Ce),r(de);var Xe=s(de,2),Ye=a(Xe),Ze=s(a(Ye),2),pe=a(Ze),et=s(a(pe),2),zt=a(et,!0);r(et),r(pe);var _e=s(pe,2),tt=s(a(_e),2),Vt=a(tt,!0);r(tt),r(_e);var ye=s(_e,2),at=s(a(ye),2),Wt=a(at);r(at),r(ye);var he=s(ye,2),rt=s(a(he),2),Kt=a(rt,!0);r(rt),r(he);var be=s(he,2),dt=s(a(be),2),Qt=a(dt);r(dt),r(be);var ke=s(be,2),st=s(a(ke),2),Se=a(st),Xt=a(Se,!0);r(Se),r(st),r(ke);var we=s(ke,2),it=s(a(we),2),Yt=a(it);{var Zt=c=>{var m=wa(),u=a(m,!0);r(m),D(g=>{q(m,"href",g),o(u,(e(t),i(()=>e(t).template_name)))},[()=>(p($),e(t),i(()=>$(`/templates/${e(t).template_id}`)))]),f(c,m)},ea=c=>{var m=De(),u=R(m);{var g=w=>{var F=Da(),sa=a(F);r(F),D(ia=>{q(F,"href",ia),o(sa,`Template ID: ${e(t),i(()=>e(t).template_id)??""}`)},[()=>(p($),e(t),i(()=>$(`/templates/${e(t).template_id}`)))]),f(w,F)},U=w=>{var F=Ia();f(w,F)};x(()=>y(u,w=>{e(t),i(()=>e(t).template_id)?w(g):w(U,!1)},!0),"if",n,354,8)}f(c,m)};x(()=>y(Yt,c=>{e(t),i(()=>e(t).template_name)?c(Zt):c(ea,!1)}),"if",n,350,8)}r(it),r(we);var ta=s(we,2);{var aa=c=>{var m=$a(),u=s(a(m),2),g=a(u,!0);r(u),r(m),D(()=>o(g,(e(t),i(()=>e(t)["github-runner-group"])))),f(c,m)};x(()=>y(ta,c=>{e(t),i(()=>e(t)["github-runner-group"])&&c(aa)}),"if",n,363,6)}r(Ze),r(Ye),r(Xe),r(re);var lt=s(re,2);{var ra=c=>{var m=Ta(),u=a(m),g=s(a(u),2),U=a(g,!0);r(g),r(u),r(m),D(w=>o(U,w),[()=>(e(t),i(()=>kt(e(t).extra_specs)))]),f(c,m)};x(()=>y(lt,c=>{e(t),i(()=>e(t).extra_specs)&&c(ra)}),"if",n,377,2)}var da=s(lt,2);{let c=A(()=>(e(t),i(()=>e(t).instances||[])));x(()=>ya(da,{get instances(){return e(c)},entityType:"scaleset",onDeleteInstance:bt}),"component",n,387,2,{componentTag:"InstancesSection"})}D((c,m,u,g,U)=>{o(Rt,(e(t),i(()=>e(t).id))),o(Ct,(e(t),i(()=>e(t).name))),o(Bt,(e(t),i(()=>e(t).provider_name))),o(Gt,(e(t),i(()=>e(t).image))),o(Ht,(e(t),i(()=>e(t).flavor))),nt(me,1,`inline-flex px-2 py-1 text-xs font-medium rounded-full ${e(t),i(()=>e(t).enabled?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200")??""}`),o(Ot,(e(t),i(()=>e(t).enabled?"Enabled":"Disabled"))),o(Jt,c),q(ge,"href",m),o(Pt,u),o(jt,g),o(qt,U),o(zt,(e(t),i(()=>e(t).max_runners))),o(Vt,(e(t),i(()=>e(t).min_idle_runners))),o(Wt,`${e(t),i(()=>e(t).runner_bootstrap_timeout)??""} minutes`),o(Kt,(e(t),i(()=>e(t).runner_prefix||"garm"))),o(Qt,`${e(t),i(()=>e(t).os_type)??""} / ${e(t),i(()=>e(t).os_arch)??""}`),nt(Se,1,`inline-flex px-2 py-1 text-xs font-medium rounded-full ${e(t),i(()=>e(t).enable_shell?"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200")??""}`),o(Xt,(e(t),i(()=>e(t).enable_shell?"Enabled":"Disabled")))},[()=>(p(W),e(t),i(()=>W(e(t)))),()=>(p(ut),e(t),i(()=>ut(e(t)))),()=>(p(N),e(t),i(()=>N(e(t)))),()=>(p(K),e(t),i(()=>K(e(t).created_at||""))),()=>(p(K),e(t),i(()=>K(e(t).updated_at||"")))]),f(ae,Ue)};x(()=>y(j,ae=>{e(t)&&ae(te)},!0),"if",n,235,1)}f(M,E)};x(()=>y(T,M=>{e(G)?M(ee):M(Ut,!1)},!0),"if",n,231,1)}f(d,l)};x(()=>y($t,d=>{e(Q)?d(Tt):d(Mt,!1)}),"if",n,226,1)}r(X);var Ae=s(X,2);{var Et=d=>{x(()=>_a(d,{get scaleSet(){return e(t)},$$events:{close:()=>v(H,!1),submit:l=>_t(l.detail)}}),"component",n,394,1,{componentTag:"UpdateScaleSetModal"})};x(()=>y(Ae,d=>{e(H)&&e(t)&&d(Et)}),"if",n,393,0)}var Ne=s(Ae,2);{var Ft=d=>{{let l=A(()=>(e(t),p(N),i(()=>`Scale Set ${e(t).name} (${N(e(t))})`)));x(()=>vt(d,{title:"Delete Scale Set",message:"Are you sure you want to delete this scale set? This action cannot be undone and will remove all associated runners.",get itemName(){return e(l)},$$events:{close:()=>v(O,!1),confirm:yt}}),"component",n,402,1,{componentTag:"DeleteModal"})}};x(()=>y(Ne,d=>{e(O)&&e(t)&&d(Ft)}),"if",n,401,0)}var At=s(Ne,2);{var Nt=d=>{x(()=>vt(d,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return e(b),i(()=>e(b).name)},$$events:{close:()=>{v(J,!1),v(b,null)},confirm:ht}}),"component",n,412,1,{componentTag:"DeleteModal"})};x(()=>y(At,d=>{e(J)&&e(b)&&d(Nt)}),"if",n,411,0)}return D(d=>{q(Dt,"href",d),o(It,(e(t),i(()=>e(t)?e(t).name:"Loading...")))},[()=>(p($),i(()=>$("/scalesets")))]),f(ft,$e),fa({...oa()})}export{n as component};
