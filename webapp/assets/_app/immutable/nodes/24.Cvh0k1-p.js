import{c as tt,a as U,h as at,b as R,l as rt,f as H,g as lt,s as ot,e as E}from"../chunks/CxOx-TIJ.js";import{i as st}from"../chunks/3NxSoY2_.js";import{p as nt,o as it,l as ae,b as dt,f as Fe,d as _,a as ut,g as e,m as g,t as $,s as r,F as C,j as l,i as k,u as I,$ as ct,e as re,c as o,r as s,v as le,w as W,k as v,n as oe}from"../chunks/DzFKsO_V.js";import{i as se}from"../chunks/B_jyf0qs.js";import{r as De,b as ne,g as Me,c as ie}from"../chunks/BguOOs3x.js";import{b as Ee}from"../chunks/BVM1034P.js";import{b as pt}from"../chunks/Dtavz0EF.js";import{p as gt}from"../chunks/CdEA5IGF.js";import{l as bt}from"../chunks/BAcG6-Ep.js";import{g as de}from"../chunks/BzzAh3Be.js";import{p as mt}from"../chunks/CH-vk5qo.js";import"../chunks/Ct5kWObc.js";import{t as w}from"../chunks/li_-Mkq2.js";import{e as Ie}from"../chunks/BZiHL9L3.js";import"../chunks/1CdJgrM6.js";import{D as ft}from"../chunks/BLYRAgBX.js";import{a as vt,C as xt}from"../chunks/g1bAVjVL.js";p[C]="src/routes/templates/create/+page.svelte";var yt=U(H('<div class="flex items-center justify-center py-12"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> <span class="ml-3 text-gray-600 dark:text-gray-400">Loading...</span></div>'),p[C],[[296,1,[[297,2],[298,2]]]]),ht=U(H('<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 mr-2"></div> Uploading...',1),p[C],[[402,8]]),_t=U(lt('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg> Upload File',1),p[C],[[405,8,[[406,9]]]]),kt=U(H('<!> <div class="flex flex-col h-full space-y-6"><div class="bg-white dark:bg-gray-800 shadow rounded-lg flex-shrink-0"><div class="px-4 py-5 sm:p-6"><h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4">Template Information</h3> <form class="space-y-4"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Name *</label> <input type="text" id="name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"/></div> <div><label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Description</label> <input type="text" id="description" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"/></div></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="forge_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Forge Type *</label> <select id="forge_type" required class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>GitHub</option><option>Gitea</option></select></div> <div><label for="os_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">OS Type *</label> <select id="os_type" required class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Linux</option><option>Windows</option></select></div></div></form></div></div> <div class="bg-white dark:bg-gray-800 shadow rounded-lg flex-1 flex flex-col min-h-0"><div class="px-4 py-5 sm:p-6 flex-1 flex flex-col"><div class="flex items-center justify-between mb-4"><h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Template Content</h3> <div class="flex items-center space-x-3"><button type="button" class="inline-flex items-center px-3 py-1.5 text-sm font-medium rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"><!></button> <label for="language-select" class="text-sm font-medium text-gray-700 dark:text-gray-300">Language:</label> <select id="language-select" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"><option>Bash</option><option>PowerShell</option><option>Python</option><option>Text</option></select></div></div> <input type="file" accept=".sh,.bash,.ps1,.psm1,.py,.txt,.md" style="display: none"/> <div class="mb-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"><h4 class="text-sm font-medium text-blue-900 dark:text-blue-100 mb-2">Available Template Variables</h4> <p class="text-xs text-blue-800 dark:text-blue-200 mb-3">Your template can use the following variables using Go template syntax (e.g., <code class="bg-blue-100 dark:bg-blue-800 px-1 rounded"></code>):</p> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-xs"><div><h5 class="font-medium text-blue-900 dark:text-blue-100 mb-1">Runner Info</h5> <ul class="space-y-1 text-blue-800 dark:text-blue-200"><li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.RunnerName</code> - Runner name</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.RunnerLabels</code> - Comma separated labels</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.RunnerUsername</code> - Runner service username</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.RunnerGroup</code> - Runner service group</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.GitHubRunnerGroup</code> - GitHub runner group</li></ul></div> <div><h5 class="font-medium text-blue-900 dark:text-blue-100 mb-1">Download & Install</h5> <ul class="space-y-1 text-blue-800 dark:text-blue-200"><li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.FileName</code> - Download file name</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.DownloadURL</code> - Runner download URL</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.TempDownloadToken</code> - Download token</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.RepoURL</code> - Repository URL</li></ul></div> <div><h5 class="font-medium text-blue-900 dark:text-blue-100 mb-1">Configuration</h5> <ul class="space-y-1 text-blue-800 dark:text-blue-200"><li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.MetadataURL</code> - Instance metadata URL</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.CallbackURL</code> - Status callback URL</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.CallbackToken</code> - Callback token</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.CABundle</code> - CA certificate bundle</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.EnableBootDebug</code> - Enable debug mode</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.UseJITConfig</code> - Use JIT configuration</li> <li><code class="bg-blue-100 dark:bg-blue-800 px-1 rounded">.ExtraContext</code> - Additional context map</li></ul></div></div> <p class="text-xs text-blue-700 dark:text-blue-300 mt-3">ðŸ’¡ <strong>Tip:</strong> Use <code class="bg-blue-100 dark:bg-blue-800 px-1 rounded"></code> for conditional content, or <code class="bg-blue-100 dark:bg-blue-800 px-1 rounded"></code> to iterate over extra context.</p></div> <div class="flex-1 min-h-0"><!> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400"> </p></div></div></div></div>',1),p[C],[[316,1,[[318,2,[[319,3,[[320,4],[324,4,[[325,5,[[326,6,[[327,7],[330,7]]],[339,6,[[340,7],[343,7]]]]],[352,5,[[353,6,[[354,7],[357,7,[[363,8],[364,8]]]]],[368,6,[[369,7],[372,7,[[378,8],[379,8]]]]]]]]]]]]],[388,2,[[389,3,[[390,4,[[391,5],[394,5,[[395,6],[411,6],[414,6,[[420,7],[421,7],[422,7],[423,7]]]]]]],[429,4],[438,4,[[439,5],[442,5,[[443,84]]],[445,5,[[446,6,[[447,7],[448,7,[[449,8,[[449,12]]],[450,8,[[450,12]]],[451,8,[[451,12]]],[452,8,[[452,12]]],[453,8,[[453,12]]]]]]],[456,6,[[457,7],[458,7,[[459,8,[[459,12]]],[460,8,[[460,12]]],[461,8,[[461,12]]],[462,8,[[462,12]]]]]]],[465,6,[[466,7],[467,7,[[468,8,[[468,12]]],[469,8,[[469,12]]],[470,8,[[470,12]]],[471,8,[[471,12]]],[472,8,[[472,12]]],[473,8,[[473,12]]],[474,8,[[474,12]]]]]]]]],[478,5,[[479,9],[479,35],[479,157]]]]],[483,4,[[493,5]]]]]]]]]]),wt=U(H("<!> <!>",1),p[C],[]);function p(We,He){tt(new.target),nt(He,!1,p);const ue=g(),S=g();let T=g(!1),d=g(null),t=g({name:"",description:"",forge_type:"github",os_type:"linux",data:new Uint8Array}),u=g(""),x=g("text"),y=g(!1),G=g(),A=g(!1),F={name:"",description:"",forge_type:"github",os_type:"linux"},Se="",D=g(!1);async function ce(){if(e(S))try{l(T,!0);const a={name:e(t).name,description:e(t).description||void 0,forge_type:e(t).forge_type,os_type:e(t).os_type,data:Array.from(new TextEncoder().encode(e(u)))};(await oe(Me.createTemplate(a)))(),w.add({type:"success",title:"Template created",message:`Template "${e(t).name}" has been created successfully.`}),de(ie("/templates"))}catch(a){const c=Ie(a);w.add({type:"error",title:"Failed to create template",message:c})}finally{l(T,!1)}}function Ge(){return e(ue)}function Pe(){if(Ge()){l(D,!0);return}pe()}function pe(){de(ie("/templates"))}function Ne(){l(D,!1),pe()}function je(){e(G).click()}async function Be(a){const c=a.target,i=c.files?.[0];if(i){if(i.size>1024*1024){w.add({type:"error",title:"File too large",message:"Please select a file smaller than 1MB."});return}try{l(A,!0);const h=(await oe(i.text()))();l(u,h);const b=i.name.toLowerCase();let f="text";b.endsWith(".sh")||b.endsWith(".bash")?f="bash":b.endsWith(".ps1")||b.endsWith(".psm1")?f="powershell":b.endsWith(".py")?f="python":f=P(h),l(x,f),l(y,!1),w.add({type:"success",title:"File uploaded",message:`Successfully loaded content from "${i.name}".`})}catch{w.add({type:"error",title:"Failed to read file",message:"Unable to read the selected file. Please try again."})}finally{l(A,!1),c.value=""}}}function P(a){const i=a.split(`
`)[0]?.trim()||"";return i.startsWith("#!/bin/bash")||i.startsWith("#!/bin/sh")?"bash":i.startsWith("#!/usr/bin/env pwsh")||i.includes("#ps1_sysnative")?"powershell":i.startsWith("#!/usr/bin/env python")||i.startsWith("#!/usr/bin/python")?"python":a.includes("param(")||a.includes("Write-Host")||a.includes("$_")?"powershell":a.includes("def ")||a.includes("import ")||a.includes("print(")?"python":a.includes("echo ")||a.includes("export ")||a.includes("if [")?"bash":"text"}async function qe(){const a=mt.url.searchParams.get("clone");if(a)try{if(l(T,!0),l(d,(await oe(Me.getTemplate(parseInt(a))))()),!e(d))throw new Error("Template not found");if(v(t,e(t).name=`${e(d).name} (Copy)`),v(t,e(t).description=e(d).description||""),v(t,e(t).forge_type=e(d).forge_type||"github"),v(t,e(t).os_type=e(d).os_type||"linux"),e(d).data)try{if(Array.isArray(e(d).data)){const c=new Uint8Array(e(d).data);l(u,new TextDecoder().decode(c))}else l(u,atob(e(d).data));l(x,P(e(u)))}catch(c){console.error(...bt("error","Failed to decode template data:",c)),l(u,"")}}catch(c){const i=Ie(c);w.add({type:"error",title:"Failed to load template",message:i}),de(ie("/templates"))}finally{l(T,!1)}}it(()=>{qe()}),ae(()=>(e(t),e(u)),()=>{l(ue,k(e(t).name,F.name,!1)||k(e(t).description,F.description,!1)||k(e(t).forge_type,F.forge_type,!1)||k(e(t).os_type,F.os_type,!1)||k(e(u),Se,!1))}),ae(()=>(e(t),e(u)),()=>{l(S,e(t).name.trim().length>0&&e(u).trim().length>0)}),ae(()=>(e(u),e(y)),()=>{e(u)&&!e(y)&&l(x,P(e(u)))}),dt(),st();var ge=wt();at(a=>{$(()=>ct.title=`${e(d),I(()=>e(d)?`Clone ${e(d).name}`:"Create Template")??""} - GARM`)});var be=Fe(ge);{var Ve=a=>{var c=yt();R(a,c)},Je=a=>{var c=kt(),i=Fe(c);{let n=re(()=>(e(d),I(()=>e(d)?`Clone Template: ${e(d).name}`:"Create New Template"))),m=re(()=>!e(S));_(()=>ft(i,{get title(){return e(n)},subtitle:"Create a new runner install template",onEdit:Pe,onDelete:ce,editLabel:"Cancel",deleteLabel:"Create Template",editVariant:"secondary",deleteVariant:"primary",get deleteDisabled(){return e(m)},editIcon:"<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12'/>",deleteIcon:"<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h8a2 2 0 002-2V9a2 2 0 00-2-2h-3m0 0V5a2 2 0 00-2-2H9a2 2 0 00-2 2v2m0 0h4'/>"}),"component",p,302,1,{componentTag:"DetailHeader"})}var h=r(i,2),b=o(h),f=o(b),N=r(o(f),2),j=o(N),B=o(j),me=r(o(B),2);De(me),s(B);var fe=r(B,2),ve=r(o(fe),2);De(ve),s(fe),s(j);var xe=r(j,2),q=o(xe),V=r(o(q),2);$(()=>{e(t),le(()=>{})});var J=o(V);J.value=J.__value="github";var ye=r(J);ye.value=ye.__value="gitea",s(V),s(q);var he=r(q,2),O=r(o(he),2);$(()=>{e(t),le(()=>{})});var Y=o(O);Y.value=Y.__value="linux";var _e=r(Y);_e.value=_e.__value="windows",s(O),s(he),s(xe),s(N),s(f),s(b);var ke=r(b,2),we=o(ke),z=o(we),Ce=r(o(z),2),L=o(Ce),ze=o(L);{var Ke=n=>{var m=ht();W(),R(n,m)},Qe=n=>{var m=_t();W(),R(n,m)};_(()=>se(ze,n=>{e(A)?n(Ke):n(Qe,!1)}),"if",p,401,7)}s(L);var M=r(L,4);$(()=>{e(x),le(()=>{e(y)})});var K=o(M);K.value=K.__value="bash";var Q=r(K);Q.value=Q.__value="powershell";var X=r(Q);X.value=X.__value="python";var Te=r(X);Te.value=Te.__value="text",s(M),s(Ce),s(z);var Z=r(z,2);pt(Z,n=>l(G,n),()=>e(G));var ee=r(Z,2),te=r(o(ee),2),Xe=r(o(te));Xe.textContent="{{ .RunnerName }}",W(),s(te);var Le=r(te,4),Re=r(o(Le),3);Re.textContent="{{if .CABundle}}...{{end}}";var Ze=r(Re,2);Ze.textContent="{{range $key, $value := .ExtraContext}}{{$key}}: {{$value}}{{end}}",W(),s(Le),s(ee);var $e=r(ee,2),Ue=o($e);{let n=re(()=>!e(y));_(()=>vt(Ue,{get language(){return e(x)},get autoDetect(){return e(n)},enableTemplateCompletion:!0,minHeight:"400px",placeholder:"Enter your template script content here...",get value(){return e(u)},set value(m){l(u,m)},$$events:{change:m=>l(u,m.detail.value)},$$legacy:!0}),"component",p,484,5,{componentTag:"CodeEditor"})}var Ae=r(Ue,2),et=o(Ae);s(Ae),s($e),s(we),s(ke),s(h),$(()=>{L.disabled=e(A),ot(et,`Template content should be a ${e(t),I(()=>k(e(t).os_type,"windows")?"PowerShell":"bash")??""} script for runner installation and configuration on ${e(t),I(()=>e(t).os_type)??""}.`)}),Ee(me,()=>e(t).name,n=>v(t,e(t).name=n)),Ee(ve,()=>e(t).description,n=>v(t,e(t).description=n)),ne(V,()=>e(t).forge_type,n=>v(t,e(t).forge_type=n)),ne(O,()=>e(t).os_type,n=>v(t,e(t).os_type=n)),E("submit",N,gt(ce)),E("click",L,je),ne(M,()=>e(x),n=>l(x,n)),E("change",M,()=>l(y,!0)),E("change",Z,Be),R(a,c)};_(()=>se(be,a=>{e(T)?a(Ve):a(Je,!1)}),"if",p,295,0)}var Oe=r(be,2);{var Ye=a=>{_(()=>xt(a,{title:"Unsaved Changes",message:"You have unsaved changes. Are you sure you want to discard them?",confirmText:"Discard Changes",cancelText:"Stay on Page",variant:"danger",$$events:{close:()=>l(D,!1),confirm:Ne}}),"component",p,504,1,{componentTag:"ConfirmationModal"})};_(()=>se(Oe,a=>{e(D)&&a(Ye)}),"if",p,503,0)}return R(We,ge),ut({...rt()})}export{p as component};
