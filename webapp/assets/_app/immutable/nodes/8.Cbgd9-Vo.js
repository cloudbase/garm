import"../chunks/DsnmJJEf.js";import{i as z}from"../chunks/B3Pzt0F_.js";import{p as J,f as C,c as x,d as K,j as y,n as _,u as f,r as b,t as E,v as L,B as ce,b as O,o as de,A as ue,l as S,a as me,h as pe,g as e,m as u,$ as fe,q as ge,k as w,s}from"../chunks/D8EpLgQ1.js";import{p as ve,i as D}from"../chunks/5WA7h8uK.js";import{c as T,g as B}from"../chunks/CiE1LlKV.js";import{D as he}from"../chunks/KQ2xQpA3.js";import{P as _e}from"../chunks/CO4LUyTP.js";import{w as ye}from"../chunks/u94nIB4-.js";import{t as be}from"../chunks/BEkVdVE1.js";import{D as xe,G as Ce,a as Pe}from"../chunks/B_CZMFLe.js";import{e as ke}from"../chunks/BZiHL9L3.js";import{E as Ie}from"../chunks/C9H3KoyH.js";import{b as H}from"../chunks/D3_ugSUS.js";import{S as W}from"../chunks/dB1NgJWc.js";var Se=C('<a class="text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 truncate block text-sm"> </a>'),we=C('<a class="text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 truncate block text-sm"> </a>'),Te=C('<span class="text-gray-400 dark:text-gray-500 text-sm">-</span>'),De=C('<div class="w-full min-w-0 text-sm font-medium"><!></div>');function $e($,k){J(k,!1);let a=ve(k,"item",8);z();var m=De(),I=y(m);{var i=r=>{var p=Se(),v=y(p);b(p),E(()=>{T(p,"href",`${H??""}/pools/${_(a()),f(()=>a().pool_id)??""}`),T(p,"title",`Pool: ${_(a()),f(()=>a().pool_id)??""}`),L(v,`Pool: ${_(a()),f(()=>a().pool_id)??""}`)}),x(r,p)},P=r=>{var p=ce(),v=O(p);{var l=n=>{var o=we(),c=y(o);b(o),E(()=>{T(o,"href",`${H??""}/scalesets/${_(a()),f(()=>a().scale_set_id)??""}`),T(o,"title",`Scale Set: ${_(a()),f(()=>a().scale_set_id)??""}`),L(c,`Scale Set: ${_(a()),f(()=>a().scale_set_id)??""}`)}),x(n,o)},g=n=>{var o=Te();x(n,o)};D(v,n=>{_(a()),f(()=>a()?.scale_set_id)?n(l):n(g,!1)},!0)}x(r,p)};D(I,r=>{_(a()),f(()=>a()?.pool_id)?r(i):r(P,!1)})}b(m),x($,m),K()}var Ae=C('<div class="bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-800 rounded-md p-4"><div class="flex"><div class="ml-3"><h3 class="text-sm font-medium text-red-800 dark:text-red-200">Error</h3> <div class="mt-2 text-sm text-red-700 dark:text-red-300"> </div></div></div></div>'),Ee=C('<div class="space-y-6"><!> <!> <!></div> <!>',1);function Oe($,k){J(k,!1);const a=u(),m=u(),I=u();let i=u([]),P=u(!0),r=u(""),p="",v=null,l=u(1),g=u(25),n=u(""),o=u(!1),c=u(null);async function M(){try{s(P,!0),s(r,""),s(i,await B.listInstances())}catch(t){s(r,t instanceof Error?t.message:"Failed to load instances")}finally{s(P,!1)}}function R(t){s(c,t),s(o,!0)}async function Q(){if(e(c))try{await B.deleteInstance(e(c).name),be.success("Instance Deleted",`Instance ${e(c).name} has been deleted successfully.`)}catch(t){s(r,ke(t))}finally{s(o,!1),s(c,null)}}const U=[{key:"name",title:"Name",cellComponent:Ie,cellProps:{entityType:"instance",showId:!0}},{key:"pool_scale_set",title:"Pool/Scale Set",flexible:!0,cellComponent:$e},{key:"created",title:"Created",cellComponent:Ce,cellProps:{field:"created_at",type:"date"}},{key:"status",title:"Status",cellComponent:W,cellProps:{statusType:"instance",statusField:"status"}},{key:"runner_status",title:"Runner Status",cellComponent:W,cellProps:{statusType:"instance",statusField:"runner_status"}},{key:"actions",title:"Actions",align:"right",cellComponent:Pe,cellProps:{actions:[{type:"delete",title:"Delete",ariaLabel:"Delete instance",action:"delete"}]}}],V={entityType:"instance",primaryText:{field:"name",isClickable:!0,href:"/instances/{name}"},secondaryText:{field:"provider_id"},badges:[{type:"status",field:"status"},{type:"status",field:"runner_status"}],actions:[{type:"delete",handler:t=>R(t)}]};function X(t){s(n,t.detail.term),s(l,1)}function Y(t){s(l,t.detail.page)}function Z(t){s(g,t.detail.perPage),s(l,1)}async function ee(){try{await M()}catch(t){console.error("Retry failed:",t)}}function te(t){}function ae(t){R(t.detail.item)}function se(t){if(t.operation==="create"){const d=t.payload;s(i,[...e(i),d])}else if(t.operation==="update"){const d=t.payload;s(i,e(i).map(h=>h.name===d.name?d:h))}else if(t.operation==="delete"){const d=t.payload.name||t.payload;s(i,e(i).filter(h=>h.name!==d))}}de(()=>{M(),v=ye.subscribeToEntity("instance",["create","update","delete"],se)}),ue(()=>{v&&(v(),v=null)}),S(()=>(e(i),e(n)),()=>{s(a,e(i).filter(t=>(e(n)===""||t.name?.toLowerCase().includes(e(n).toLowerCase())||t.provider_id?.toLowerCase().includes(e(n).toLowerCase()))&&p===""))}),S(()=>(e(a),e(g)),()=>{s(m,Math.ceil(e(a).length/e(g)))}),S(()=>(e(l),e(m)),()=>{e(l)>e(m)&&e(m)>0&&s(l,e(m))}),S(()=>(e(a),e(l),e(g)),()=>{s(I,e(a).slice((e(l)-1)*e(g),e(l)*e(g)))}),me(),z();var F=Ee();pe(t=>{fe.title="Instances - GARM"});var A=O(F),N=y(A);_e(N,{title:"Runner Instances",description:"Monitor your running instances",showAction:!1});var G=w(N,2);{var re=t=>{var d=Ae(),h=y(d),q=y(h),j=w(y(q),2),ie=y(j,!0);b(j),b(q),b(h),b(d),E(()=>L(ie,e(r))),x(t,d)};D(G,t=>{e(r)&&t(re)})}var ne=w(G,2);{let t=ge(()=>!!e(r));xe(ne,{get columns(){return U},get data(){return e(I)},get loading(){return e(P)},get error(){return e(r)},get searchTerm(){return e(n)},searchPlaceholder:"Search instances...",get currentPage(){return e(l)},get perPage(){return e(g)},get totalPages(){return e(m)},get totalItems(){return e(a),f(()=>e(a).length)},itemName:"instances",emptyIconType:"cog",get showRetry(){return e(t)},get mobileCardConfig(){return V},$$events:{search:X,pageChange:Y,perPageChange:Z,retry:ee,edit:te,delete:ae}})}b(A);var le=w(A,2);{var oe=t=>{he(t,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return e(c),f(()=>e(c).name)},$$events:{close:()=>{s(o,!1),s(c,null)},confirm:Q}})};D(le,t=>{e(o)&&e(c)&&t(oe)})}x($,F),K()}export{Oe as component};
