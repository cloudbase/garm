import"../chunks/DsnmJJEf.js";import{i as We}from"../chunks/B3Pzt0F_.js";import{p as qe,o as ze,A as He,l as je,a as Ge,f as A,h as Oe,b as M,t as z,c as w,d as Ve,g as e,m as l,s as r,u as s,$ as Je,j as u,r as f,k as d,v as le,y as Ke,B as de,q as m,n as Qe}from"../chunks/D8EpLgQ1.js";import{i as g,s as Xe,a as Ye}from"../chunks/5WA7h8uK.js";import{c as Ze,g as h}from"../chunks/CiE1LlKV.js";import{p as et}from"../chunks/C41YH50Q.js";import{g as ce}from"../chunks/CTf6mQoE.js";import{b as H}from"../chunks/CoIRRsD9.js";import{U as tt}from"../chunks/CclkODgu.js";import{D as pe}from"../chunks/KQ2xQpA3.js";import{E as ot,P as at,a as rt}from"../chunks/BmGWMSQm.js";import{D as st,I as nt}from"../chunks/DDhBTdDt.js";import{g as ue}from"../chunks/BGVHQGl-.js";import{W as it}from"../chunks/Dbd6PPbz.js";import{C as lt}from"../chunks/CwqI2jFH.js";import{w as j}from"../chunks/u94nIB4-.js";import{t as C}from"../chunks/BEkVdVE1.js";var dt=A('<div class="p-6 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading repository...</p></div>'),ct=A('<div class="rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),pt=A("<!> <!> <!> <!> <!> <!>",1),ut=A('<div class="space-y-6"><nav class="flex" aria-label="Breadcrumb"><ol class="inline-flex items-center space-x-1 md:space-x-3"><li class="inline-flex items-center"><a class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white"><svg class="w-3 h-3 mr-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg> Repositories</a></li> <li><div class="flex items-center"><svg class="w-3 h-3 text-gray-400 mx-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg> <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400"> </span></div></li></ol></nav> <!></div> <!> <!> <!> <!>',1);function kt(fe,me){qe(me,!1);const[ye,ve]=Xe(),G=()=>Ye(et,"$page",ye),x=l();let t=l(null),c=l([]),y=l([]),F=l(!0),I=l(""),R=l(!1),D=l(!1),E=l(!1),T=l(!1),p=l(null),P=null,_=l();async function O(){if(e(x))try{r(F,!0),r(I,"");const[o,a,n]=await Promise.all([h.getRepository(e(x)),h.listRepositoryPools(e(x)).catch(()=>[]),h.listRepositoryInstances(e(x)).catch(()=>[])]);r(t,o),r(c,a),r(y,n)}catch(o){r(I,o instanceof Error?o.message:"Failed to load repository")}finally{r(F,!1)}}function ge(o,a){const{events:n}=o;return{...a,events:n}}async function he(o){if(e(t))try{await h.updateRepository(e(t).id,o),await O(),C.success("Repository Updated",`Repository ${e(t).owner}/${e(t).name} has been updated successfully.`),r(R,!1)}catch(a){throw a}}async function _e(){if(e(t)){try{await h.deleteRepository(e(t).id),ce(`${H}/repositories`)}catch(o){r(I,o instanceof Error?o.message:"Failed to delete repository")}r(D,!1)}}async function $e(){if(e(p))try{await h.deleteInstance(e(p).name),C.success("Instance Deleted",`Instance ${e(p).name} has been deleted successfully.`),r(E,!1),r(p,null)}catch(o){const a=o instanceof Error?o.message:"Failed to delete instance";C.error("Delete Failed",a),r(E,!1),r(p,null)}}function be(o){r(p,o),r(E,!0)}function we(){r(T,!0)}async function xe(o){try{if(!e(t))return;await h.createRepositoryPool(e(t).id,o.detail),C.success("Pool Created",`Pool has been created successfully for repository ${e(t).owner}/${e(t).name}.`),r(T,!1)}catch(a){throw a}}function V(){e(_)&&Ke(_,e(_).scrollTop=e(_).scrollHeight)}function Ie(o){if(o.operation==="update"){const a=o.payload;if(e(t)&&a.id===e(t).id){const n=e(t).events?.length||0,i=a.events?.length||0;r(t,ge(e(t),a)),i>n&&setTimeout(()=>{V()},100)}}else if(o.operation==="delete"){const a=o.payload.id||o.payload;e(t)&&e(t).id===a&&ce(`${H}/repositories`)}}function Ee(o){if(!e(t))return;const a=o.payload;if(a.repo_id===e(t).id){if(o.operation==="create")r(c,[...e(c),a]);else if(o.operation==="update")r(c,e(c).map(n=>n.id===a.id?a:n));else if(o.operation==="delete"){const n=a.id||a;r(c,e(c).filter(i=>i.id!==n))}}}function Re(o){if(!e(t)||!e(c))return;const a=o.payload;if(e(c).some(i=>i.id===a.pool_id)){if(o.operation==="create")r(y,[...e(y),a]);else if(o.operation==="update")r(y,e(y).map(i=>i.id===a.id?a:i));else if(o.operation==="delete"){const i=a.id||a;r(y,e(y).filter(L=>L.id!==i))}}}ze(()=>{O().then(()=>{e(t)?.events?.length&&setTimeout(()=>{V()},100)});const o=j.subscribeToEntity("repository",["update","delete"],Ie),a=j.subscribeToEntity("pool",["create","update","delete"],Ee),n=j.subscribeToEntity("instance",["create","update","delete"],Re);P=()=>{o(),a(),n()}}),He(()=>{P&&(P(),P=null)}),je(()=>G(),()=>{r(x,G().params.id)}),Ge(),We();var J=ut();Oe(o=>{z(()=>Je.title=`${e(t),s(()=>e(t)?`${e(t).name} - Repository Details`:"Repository Details")??""} - GARM`)});var S=M(J),B=u(S),K=u(B),U=u(K),De=u(U);f(U);var Q=d(U,2),X=u(Q),Y=d(u(X),2),Te=u(Y,!0);f(Y),f(X),f(Q),f(K),f(B);var Pe=d(B,2);{var ke=o=>{var a=dt();w(o,a)},Me=o=>{var a=de(),n=M(a);{var i=$=>{var b=ct(),k=u(b),N=u(k,!0);f(k),f(b),z(()=>le(N,e(I))),w($,b)},L=$=>{var b=de(),k=M(b);{var N=W=>{var oe=pt(),ae=M(oe);{let v=m(()=>(e(t),s(()=>e(t).name||"Repository"))),q=m(()=>(e(t),s(()=>e(t).owner))),Le=m(()=>(e(t),s(()=>e(t).endpoint?.name))),Ne=m(()=>(Qe(ue),e(t),s(()=>ue(e(t).endpoint?.endpoint_type||"unknown"))));st(ae,{get title(){return e(v)},get subtitle(){return`Owner: ${e(q)??""} â€¢ Endpoint: ${e(Le)??""}`},get forgeIcon(){return e(Ne)},onEdit:()=>r(R,!0),onDelete:()=>r(D,!0)})}var re=d(ae,2);ot(re,{get entity(){return e(t)},entityType:"repository"});var se=d(re,2);{let v=m(()=>(e(t),s(()=>e(t).id||"")));it(se,{entityType:"repository",get entityId(){return e(v)},get entityName(){return`${e(t),s(()=>e(t).owner)??""}/${e(t),s(()=>e(t).name)??""}`}})}var ne=d(se,2);{let v=m(()=>(e(t),s(()=>e(t).id||"")));at(ne,{get pools(){return e(c)},entityType:"repository",get entityId(){return e(v)},get entityName(){return`${e(t),s(()=>e(t).owner)??""}/${e(t),s(()=>e(t).name)??""}`},$$events:{addPool:we}})}var ie=d(ne,2);nt(ie,{get instances(){return e(y)},entityType:"repository",onDeleteInstance:be});var Ue=d(ie,2);{let v=m(()=>(e(t),s(()=>e(t)?.events)));rt(Ue,{get events(){return e(v)},get eventsContainer(){return e(_)},set eventsContainer(q){r(_,q)},$$legacy:!0})}w(W,oe)};g(k,W=>{e(t)&&W(N)},!0)}w($,b)};g(n,$=>{e(I)?$(i):$(L,!1)},!0)}w(o,a)};g(Pe,o=>{e(F)?o(ke):o(Me,!1)})}f(S);var Z=d(S,2);{var Ce=o=>{tt(o,{get entity(){return e(t)},entityType:"repository",$$events:{close:()=>r(R,!1),submit:a=>he(a.detail)}})};g(Z,o=>{e(R)&&e(t)&&o(Ce)})}var ee=d(Z,2);{var Ae=o=>{{let a=m(()=>(e(t),s(()=>`${e(t).owner}/${e(t).name}`)));pe(o,{title:"Delete Repository",message:"Are you sure you want to delete this repository? This action cannot be undone and will remove all associated pools and instances.",get itemName(){return e(a)},$$events:{close:()=>r(D,!1),confirm:_e}})}};g(ee,o=>{e(D)&&e(t)&&o(Ae)})}var te=d(ee,2);{var Fe=o=>{pe(o,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return e(p),s(()=>e(p).name)},$$events:{close:()=>{r(E,!1),r(p,null)},confirm:$e}})};g(te,o=>{e(E)&&e(p)&&o(Fe)})}var Se=d(te,2);{var Be=o=>{{let a=m(()=>(e(t),s(()=>e(t).id||"")));lt(o,{initialEntityType:"repository",get initialEntityId(){return e(a)},$$events:{close:()=>r(T,!1),submit:xe}})}};g(Se,o=>{e(T)&&e(t)&&o(Be)})}z(()=>{Ze(De,"href",`${H}/repositories`),le(Te,(e(t),s(()=>e(t)?e(t).name:"Loading...")))}),w(fe,J),Ve(),ve()}export{kt as component};
