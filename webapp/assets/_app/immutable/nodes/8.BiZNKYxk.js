import"../chunks/DsnmJJEf.js";import{i as z}from"../chunks/B3Pzt0F_.js";import{p as J,f as C,c as x,d as K,j as y,n as _,u as f,r as b,t as A,v as L,B as ce,b as O,o as de,A as ue,l as w,a as me,h as pe,g as e,m as d,$ as fe,q as ge,k as S,s}from"../chunks/D8EpLgQ1.js";import{p as ve,i as D}from"../chunks/5WA7h8uK.js";import{c as T,g as B}from"../chunks/CiE1LlKV.js";import{D as he}from"../chunks/KQ2xQpA3.js";import{P as _e}from"../chunks/CO4LUyTP.js";import{w as ye}from"../chunks/u94nIB4-.js";import{t as be}from"../chunks/BEkVdVE1.js";import{D as xe,G as Ce,a as ke}from"../chunks/C9DJVOi1.js";import{E as Pe}from"../chunks/B7ITzBt8.js";import{S as H}from"../chunks/BE4wujub.js";import{b as W}from"../chunks/CoIRRsD9.js";var Ie=C('<a class="text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 truncate block text-sm"> </a>'),we=C('<a class="text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 truncate block text-sm"> </a>'),Se=C('<span class="text-gray-400 dark:text-gray-500 text-sm">-</span>'),Te=C('<div class="w-full min-w-0 text-sm font-medium"><!></div>');function De($,P){J(P,!1);let a=ve(P,"item",8);z();var p=Te(),I=y(p);{var u=r=>{var n=Ie(),h=y(n);b(n),A(()=>{T(n,"href",`${W??""}/pools/${_(a()),f(()=>a().pool_id)??""}`),T(n,"title",`Pool: ${_(a()),f(()=>a().pool_id)??""}`),L(h,`Pool: ${_(a()),f(()=>a().pool_id)??""}`)}),x(r,n)},k=r=>{var n=ce(),h=O(n);{var o=l=>{var i=we(),m=y(i);b(i),A(()=>{T(i,"href",`${W??""}/scalesets/${_(a()),f(()=>a().scale_set_id)??""}`),T(i,"title",`Scale Set: ${_(a()),f(()=>a().scale_set_id)??""}`),L(m,`Scale Set: ${_(a()),f(()=>a().scale_set_id)??""}`)}),x(l,i)},g=l=>{var i=Se();x(l,i)};D(h,l=>{_(a()),f(()=>a()?.scale_set_id)?l(o):l(g,!1)},!0)}x(r,n)};D(I,r=>{_(a()),f(()=>a()?.pool_id)?r(u):r(k,!1)})}b(p),x($,p),K()}var $e=C('<div class="bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-800 rounded-md p-4"><div class="flex"><div class="ml-3"><h3 class="text-sm font-medium text-red-800 dark:text-red-200">Error</h3> <div class="mt-2 text-sm text-red-700 dark:text-red-300"> </div></div></div></div>'),Ee=C('<div class="space-y-6"><!> <!> <!></div> <!>',1);function Je($,P){J(P,!1);const a=d(),p=d(),I=d();let u=d([]),k=d(!0),r=d(""),n=d(""),h=null,o=d(1),g=d(25),l=d(""),i=d(!1),m=d(null);async function M(){try{s(k,!0),s(r,""),s(u,await B.listInstances())}catch(t){s(r,t instanceof Error?t.message:"Failed to load instances")}finally{s(k,!1)}}function F(t){s(m,t),s(i,!0)}async function Q(){if(e(m))try{await B.deleteInstance(e(m).name),be.success("Instance Deleted",`Instance ${e(m).name} has been deleted successfully.`),s(i,!1),s(m,null)}catch(t){s(r,t instanceof Error?t.message:"Failed to delete instance")}}const U=[{key:"name",title:"Name",cellComponent:Pe,cellProps:{entityType:"instance",showId:!0}},{key:"pool_scale_set",title:"Pool/Scale Set",flexible:!0,cellComponent:De},{key:"created",title:"Created",cellComponent:Ce,cellProps:{field:"created_at",type:"date"}},{key:"status",title:"Status",cellComponent:H,cellProps:{statusType:"instance",statusField:"status"}},{key:"runner_status",title:"Runner Status",cellComponent:H,cellProps:{statusType:"instance",statusField:"runner_status"}},{key:"actions",title:"Actions",align:"right",cellComponent:ke,cellProps:{actions:[{type:"delete",title:"Delete",ariaLabel:"Delete instance",action:"delete"}]}}],V={entityType:"instance",primaryText:{field:"name",isClickable:!0,href:"/instances/{name}"},secondaryText:{field:"provider_id"},badges:[{type:"status",field:"status"},{type:"status",field:"runner_status"}],actions:[{type:"delete",handler:t=>F(t)}]};function X(t){s(l,t.detail.term),s(o,1)}function Y(t){s(o,t.detail.page)}function Z(t){s(g,t.detail.perPage),s(o,1)}async function ee(){try{await M()}catch(t){console.error("Retry failed:",t)}}function te(t){}function ae(t){F(t.detail.item)}function se(t){if(t.operation==="create"){const c=t.payload;s(u,[...e(u),c])}else if(t.operation==="update"){const c=t.payload;s(u,e(u).map(v=>v.name===c.name?c:v))}else if(t.operation==="delete"){const c=t.payload.name||t.payload;s(u,e(u).filter(v=>v.name!==c))}}de(()=>{M(),h=ye.subscribeToEntity("instance",["create","update","delete"],se)}),ue(()=>{h&&(h(),h=null)}),w(()=>(e(u),e(l),e(n)),()=>{s(a,e(u).filter(t=>{const c=e(l)===""||t.name?.toLowerCase().includes(e(l).toLowerCase())||t.provider_id?.toLowerCase().includes(e(l).toLowerCase()),v=e(n)===""||t.status===e(n)||t.runner_status===e(n);return c&&v}))}),w(()=>(e(a),e(g)),()=>{s(p,Math.ceil(e(a).length/e(g)))}),w(()=>(e(o),e(p)),()=>{e(o)>e(p)&&e(p)>0&&s(o,e(p))}),w(()=>(e(a),e(o),e(g)),()=>{s(I,e(a).slice((e(o)-1)*e(g),e(o)*e(g)))}),me(),z();var R=Ee();pe(t=>{fe.title="Instances - GARM"});var E=O(R),N=y(E);_e(N,{title:"Runner Instances",description:"Monitor your running instances",showAction:!1});var G=S(N,2);{var re=t=>{var c=$e(),v=y(c),q=y(v),j=S(y(q),2),ie=y(j,!0);b(j),b(q),b(v),b(c),A(()=>L(ie,e(r))),x(t,c)};D(G,t=>{e(r)&&t(re)})}var ne=S(G,2);{let t=ge(()=>!!e(r));xe(ne,{get columns(){return U},get data(){return e(I)},get loading(){return e(k)},get error(){return e(r)},get searchTerm(){return e(l)},searchPlaceholder:"Search instances...",get currentPage(){return e(o)},get perPage(){return e(g)},get totalPages(){return e(p)},get totalItems(){return e(a),f(()=>e(a).length)},itemName:"instances",emptyIconType:"cog",get showRetry(){return e(t)},get mobileCardConfig(){return V},$$events:{search:X,pageChange:Y,perPageChange:Z,retry:ee,edit:te,delete:ae}})}b(E);var le=S(E,2);{var oe=t=>{he(t,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return e(m),f(()=>e(m).name)},$$events:{close:()=>{s(i,!1),s(m,null)},confirm:Q}})};D(le,t=>{e(i)&&e(m)&&t(oe)})}x($,R),K()}export{Je as component};
