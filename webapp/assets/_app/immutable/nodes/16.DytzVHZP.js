import{c as Me,a as Y,h as Te,b as z,l as De,f as Z}from"../chunks/CxOx-TIJ.js";import{i as we}from"../chunks/3NxSoY2_.js";import{p as Ee,o as ke,l as u,b as Ae,f as Ie,d as i,a as Se,g as t,m as s,$ as Fe,c as B,s as P,e as I,u as J,F as L,j as o,n as v,r as K,h as Le}from"../chunks/DzFKsO_V.js";import{s as Ue,a as xe,i as M,v as Ne}from"../chunks/B_jyf0qs.js";import{w as Re}from"../chunks/DoJxysSt.js";import{l as O}from"../chunks/BAcG6-Ep.js";import{g as S}from"../chunks/BguOOs3x.js";import{P as Ge}from"../chunks/DTko0dwG.js";import{C as Ve}from"../chunks/BBvIKVJT.js";import{U as He}from"../chunks/lcoLiK7X.js";import{D as je}from"../chunks/DL1RlOO9.js";import{M as qe}from"../chunks/Pgjt70l7.js";import{D as ze,E as Be,G as F,P as Je,a as Ke,S as Oe,A as Qe,L as We}from"../chunks/C2FKJqnN.js";import{e as Q,a as W}from"../chunks/Penjr-j0.js";import{t as f}from"../chunks/li_-Mkq2.js";import{e as T,h as Xe}from"../chunks/JkzpcrZD.js";import{e as D}from"../chunks/BZiHL9L3.js";const X={};r[L]="src/routes/pools/+page.svelte";var Ye=Y(Z('<div class="p-6"><!></div>'),r[L],[[370,2]]),Ze=Y(Z('<div class="space-y-6"><!> <!></div> <!> <!> <!> <!>',1),r[L],[[308,0]]);function r(ee,te){Me(new.target),Ee(te,!1,r);const[oe,ae]=Ue(),n=()=>(Ne(Q,"eagerCache"),xe(Q,"$eagerCache",oe)),w=s(),p=s(),g=s(),U=s();let y=s([]),_=s(!0),x=s(""),C=s(""),c=s(1),m=s(25),$=s(!1),b=s(!1),h=s(!1),a=s(null),E=s(!1);async function le(e){try{f.success("Pool Created","Pool has been created successfully."),o($,!1)}catch(l){const d=D(l);f.error("Pool Creation Failed",d)}}async function re(e){if(t(a))try{(await v(S.updatePool(t(a).id,e)))(),o(b,!1),f.add({type:"success",title:"Pool Updated",message:`Pool ${t(a).id.slice(0,8)}... has been updated successfully.`}),o(a,null)}catch(l){const d=D(l);throw f.add({type:"error",title:"Update Failed",message:d}),l}}async function se(){if(!t(a))return;const e=`Pool ${t(a).id.slice(0,8)}...`;try{(await v(S.deletePool(t(a).id)))(),o(h,!1),f.add({type:"success",title:"Pool Deleted",message:`${e} has been deleted successfully.`}),o(a,null)}catch(l){const d=D(l);f.add({type:"error",title:"Delete Failed",message:d})}o(h,!1),o(a,null)}function ne(){o($,!0)}async function N(e){try{o(E,!0);const l=(await v(S.getPool(e.id)))();o(a,l),o(b,!0)}catch(l){const d=D(l);f.error("Failed to Load Pool Details",d)}finally{o(E,!1)}}function R(e){o(a,e),o(h,!0)}ke(async()=>{try{o(_,!0);const e=(await v(W.getPools()))();e&&Array.isArray(e)&&o(y,e)}catch(e){X?.VITEST||console.error(...O("error","Failed to load pools:",e)),o(x,e instanceof Error?e.message:"Failed to load pools")}finally{o(_,!1)}});async function ie(){try{(await v(W.retryResource("pools")))()}catch(e){X?.VITEST||console.error(...O("error","Retry failed:",e))}}const ce=[{key:"id",title:"ID",flexible:!0,cellComponent:Be,cellProps:{entityType:"pool",showId:!0,fontMono:!0}},{key:"image",title:"Image",flexible:!0,cellComponent:F,cellProps:{field:"image",type:"code",showTitle:!0}},{key:"provider",title:"Provider",cellComponent:F,cellProps:{field:"provider_name"}},{key:"flavor",title:"Flavor",cellComponent:F,cellProps:{field:"flavor"}},{key:"entity",title:"Entity",cellComponent:Je},{key:"endpoint",title:"Endpoint",cellComponent:Ke},{key:"status",title:"Status",cellComponent:Oe,cellProps:{statusType:"enabled"}},{key:"actions",title:"Actions",align:"right",cellComponent:Qe}],de={entityType:"pool",primaryText:{field:"id",isClickable:!0,href:"/pools/{id}",useId:!0,isMonospace:!0},secondaryText:{field:"entity_name",computedValue:e=>T(e,n())},badges:[{type:"custom",value:e=>({variant:e.enabled?"success":"error",text:e.enabled?"Enabled":"Disabled"})}],actions:[{type:"edit",handler:e=>N(e)},{type:"delete",handler:e=>R(e)}]};function pe(e){o(C,e.detail.term),o(c,1)}function me(e){o(c,e.detail.page)}function ue(e){o(m,e.detail.perPage),o(c,1)}function fe(e){N(e.detail.item)}function ge(e){R(e.detail.item)}u(()=>(t(y),n()),()=>{(!t(y).length||n().loaded.pools)&&o(y,n().pools)}),u(()=>n(),()=>{o(_,n().loading.pools)}),u(()=>n(),()=>{o(w,n().errorMessages.pools)}),u(()=>(t(y),t(C),n()),()=>{o(p,Xe(t(y),t(C),e=>T(e,n())))}),u(()=>(t(p),t(m)),()=>{o(g,Math.ceil(t(p).length/t(m)))}),u(()=>(t(c),t(g)),()=>{t(c)>t(g)&&t(g)>0&&o(c,t(g))}),u(()=>(t(p),t(c),t(m)),()=>{o(U,t(p).slice((t(c)-1)*t(m),t(c)*t(m)))}),Ae(),we();var G=Ze();Te(e=>{Fe.title="Pools - GARM"});var k=Ie(G),V=B(k);i(()=>Ge(V,{title:"Pools",description:"Manage runner pools across all entities",actionLabel:"Add Pool",$$events:{action:ne}}),"component",r,310,1,{componentTag:"PageHeader"});var ye=P(V,2);{let e=I(()=>t(w)||t(x)),l=I(()=>!!t(w));i(()=>ze(ye,{get columns(){return ce},get data(){return t(U)},get loading(){return t(_)},get error(){return t(e)},get searchTerm(){return t(C)},searchPlaceholder:"Search by entity name...",get currentPage(){return t(c)},get perPage(){return t(m)},get totalPages(){return t(g)},get totalItems(){return t(p),J(()=>t(p).length)},itemName:"pools",emptyIconType:"cog",get showRetry(){return t(l)},get mobileCardConfig(){return de},$$events:{search:pe,pageChange:me,perPageChange:ue,retry:ie,edit:fe,delete:ge}}),"component",r,317,1,{componentTag:"DataTable"})}K(k);var H=P(k,2);{var he=e=>{i(()=>Ve(e,{$$events:{close:()=>o($,!1),submit:le}}),"component",r,343,1,{componentTag:"CreatePoolModal"})};i(()=>M(H,e=>{t($)&&e(he)}),"if",r,342,0)}var j=P(H,2);{var Pe=e=>{i(()=>He(e,{get pool(){return t(a)},$$events:{close:()=>{o(b,!1),o(a,null)},submit:l=>re(l.detail)}}),"component",r,350,1,{componentTag:"UpdatePoolModal"})};i(()=>M(j,e=>{t(b)&&t(a)&&e(Pe)}),"if",r,349,0)}var q=P(j,2);{var ve=e=>{{let l=I(()=>(t(a),Le(T),n(),J(()=>`Pool ${t(a).id.slice(0,8)}... (${T(t(a),n())})`)));i(()=>je(e,{title:"Delete Pool",message:"Are you sure you want to delete this pool? This action cannot be undone and will remove all associated runners.",get itemName(){return t(l)},$$events:{close:()=>{o(h,!1),o(a,null)},confirm:se}}),"component",r,358,1,{componentTag:"DeleteModal"})}};i(()=>M(q,e=>{t(h)&&t(a)&&e(ve)}),"if",r,357,0)}var _e=P(q,2);{var Ce=e=>{i(()=>qe(e,{$$events:{close:()=>{}},children:Re(r,(l,d)=>{var A=Ye(),be=B(A);i(()=>We(be,{message:"Loading pool details..."}),"component",r,371,3,{componentTag:"LoadingState"}),K(A),z(l,A)}),$$slots:{default:!0}}),"component",r,369,1,{componentTag:"Modal"})};i(()=>M(_e,e=>{t(E)&&e(Ce)}),"if",r,368,0)}z(ee,G);var $e=Se({...De()});return ae(),$e}export{r as component};
