import"../chunks/DsnmJJEf.js";import{i as re}from"../chunks/B3Pzt0F_.js";import{p as se,o as ne,l as d,a as ie,f as ce,h as de,b as pe,c as me,d as ue,g as t,m as r,$ as fe,j as ge,q as E,u as S,k as v,s as o,r as ye,n as he}from"../chunks/D8EpLgQ1.js";import{i as w,s as Pe,a as Ce}from"../chunks/5WA7h8uK.js";import{g as N}from"../chunks/CiE1LlKV.js";import"../chunks/CoIRRsD9.js";import{P as ve}from"../chunks/CO4LUyTP.js";import{C as $e}from"../chunks/CwqI2jFH.js";import{U as be}from"../chunks/DQP15tlf.js";import{D as _e}from"../chunks/KQ2xQpA3.js";import{e as Me,a as R}from"../chunks/wyaP0EDu.js";import{t as $}from"../chunks/BEkVdVE1.js";import{e as b,h as Ee}from"../chunks/BGVHQGl-.js";import{D as we,G as D,a as De}from"../chunks/C9DJVOi1.js";import{E as Te}from"../chunks/B7ITzBt8.js";import{E as ke}from"../chunks/CGpPw4EW.js";import{S as Ae}from"../chunks/BE4wujub.js";import{P as Fe}from"../chunks/CLYUNKnN.js";var Ue=ce('<div class="space-y-6"><!> <!></div> <!> <!> <!>',1);function Xe(G,q){se(q,!1);const[L,j]=Pe(),s=()=>Ce(Me,"$eagerCache",L),_=r(),i=r(),p=r(),T=r();let m=r([]),g=r(!0),u=r(""),y=r(""),n=r(1),c=r(25),h=r(!1),P=r(!1),f=r(!1),a=r(null);async function H(e){try{o(u,""),o(h,!1)}catch(l){throw o(u,l instanceof Error?l.message:"Failed to create pool"),l}}async function V(e){if(t(a))try{await N.updatePool(t(a).id,e),o(P,!1),$.add({type:"success",title:"Pool Updated",message:`Pool ${t(a).id.slice(0,8)}... has been updated successfully.`}),o(a,null)}catch(l){const C=l instanceof Error?l.message:"Failed to update pool";throw $.add({type:"error",title:"Update Failed",message:C}),l}}async function z(){if(!t(a))return;const e=`Pool ${t(a).id.slice(0,8)}...`;try{await N.deletePool(t(a).id),o(f,!1),$.add({type:"success",title:"Pool Deleted",message:`${e} has been deleted successfully.`}),o(a,null)}catch(l){const C=l instanceof Error?l.message:"Failed to delete pool";o(u,C),$.add({type:"error",title:"Delete Failed",message:C})}o(f,!1),o(a,null)}function B(){o(h,!0)}function k(e){o(a,e),o(P,!0)}function A(e){o(a,e),o(f,!0)}ne(async()=>{try{o(g,!0);const e=await R.getPools();e&&Array.isArray(e)&&o(m,e)}catch(e){console.error("Failed to load pools:",e),o(u,e instanceof Error?e.message:"Failed to load pools")}finally{o(g,!1)}});async function J(){try{await R.retryResource("pools")}catch(e){console.error("Retry failed:",e)}}const K=[{key:"id",title:"ID",flexible:!0,cellComponent:Te,cellProps:{entityType:"pool",showId:!0,fontMono:!0}},{key:"image",title:"Image",flexible:!0,cellComponent:D,cellProps:{field:"image",type:"code",showTitle:!0}},{key:"provider",title:"Provider",cellComponent:D,cellProps:{field:"provider_name"}},{key:"flavor",title:"Flavor",cellComponent:D,cellProps:{field:"flavor"}},{key:"entity",title:"Entity",cellComponent:Fe},{key:"endpoint",title:"Endpoint",cellComponent:ke},{key:"status",title:"Status",cellComponent:Ae,cellProps:{statusType:"enabled"}},{key:"actions",title:"Actions",align:"right",cellComponent:De}],O={entityType:"pool",primaryText:{field:"id",isClickable:!0,href:"/pools/{id}",useId:!0,isMonospace:!0},secondaryText:{field:"entity_name",computedValue:e=>b(e,s())},badges:[{type:"custom",value:e=>({variant:e.enabled?"success":"error",text:e.enabled?"Enabled":"Disabled"})}],actions:[{type:"edit",handler:e=>k(e)},{type:"delete",handler:e=>A(e)}]};function Q(e){o(y,e.detail.term),o(n,1)}function W(e){o(n,e.detail.page)}function X(e){o(c,e.detail.perPage),o(n,1)}function Y(e){k(e.detail.item)}function Z(e){A(e.detail.item)}d(()=>(t(m),s()),()=>{(!t(m).length||s().loaded.pools)&&o(m,s().pools)}),d(()=>s(),()=>{o(g,s().loading.pools)}),d(()=>s(),()=>{o(_,s().errorMessages.pools)}),d(()=>(t(m),t(y),s()),()=>{o(i,Ee(t(m),t(y),e=>b(e,s())))}),d(()=>(t(i),t(c)),()=>{o(p,Math.ceil(t(i).length/t(c)))}),d(()=>(t(n),t(p)),()=>{t(n)>t(p)&&t(p)>0&&o(n,t(p))}),d(()=>(t(i),t(n),t(c)),()=>{o(T,t(i).slice((t(n)-1)*t(c),t(n)*t(c)))}),ie(),re();var F=Ue();de(e=>{fe.title="Pools - GARM"});var M=pe(F),U=ge(M);ve(U,{title:"Pools",description:"Manage runner pools across all entities",actionLabel:"Add Pool",$$events:{action:B}});var ee=v(U,2);{let e=E(()=>t(_)||t(u)),l=E(()=>!!t(_));we(ee,{get columns(){return K},get data(){return t(T)},get loading(){return t(g)},get error(){return t(e)},get searchTerm(){return t(y)},searchPlaceholder:"Search by entity name...",get currentPage(){return t(n)},get perPage(){return t(c)},get totalPages(){return t(p)},get totalItems(){return t(i),S(()=>t(i).length)},itemName:"pools",emptyIconType:"cog",get showRetry(){return t(l)},get mobileCardConfig(){return O},$$events:{search:Q,pageChange:W,perPageChange:X,retry:J,edit:Y,delete:Z}})}ye(M);var x=v(M,2);{var te=e=>{$e(e,{$$events:{close:()=>o(h,!1),submit:l=>H(l.detail)}})};w(x,e=>{t(h)&&e(te)})}var I=v(x,2);{var oe=e=>{be(e,{get pool(){return t(a)},$$events:{close:()=>{o(P,!1),o(a,null)},submit:l=>V(l.detail)}})};w(I,e=>{t(P)&&t(a)&&e(oe)})}var ae=v(I,2);{var le=e=>{{let l=E(()=>(t(a),he(b),s(),S(()=>`Pool ${t(a).id.slice(0,8)}... (${b(t(a),s())})`)));_e(e,{title:"Delete Pool",message:"Are you sure you want to delete this pool? This action cannot be undone and will remove all associated runners.",get itemName(){return t(l)},$$events:{close:()=>{o(f,!1),o(a,null)},confirm:z}})}};w(ae,e=>{t(f)&&t(a)&&e(le)})}me(G,F),ue(),j()}export{Xe as component};
