import{c as Ke,a as W,h as Qe,b as w,l as Xe,s as ge,f as H,d as ve}from"../chunks/CxOx-TIJ.js";import{i as Ye}from"../chunks/3NxSoY2_.js";import{p as Ze,o as et,x as tt,l as at,b as nt,f as L,d as s,t as Q,a as ot,s as u,g as e,m,u as c,h as ye,F as P,c as g,j as o,$ as rt,r as v,e as y,n as E,k as it,i as l}from"../chunks/DzFKsO_V.js";import{s as st,a as lt,i as z,v as ct}from"../chunks/B_jyf0qs.js";import{c as N,d as dt,g as $}from"../chunks/BguOOs3x.js";import{p as he}from"../chunks/DgabA6iF.js";import{g as _e}from"../chunks/BzzAh3Be.js";import{U as ut}from"../chunks/B8GNZv7s.js";import{D as be}from"../chunks/DL1RlOO9.js";import{E as mt,P as pt,a as ft}from"../chunks/Cfss7k9J.js";import{D as gt}from"../chunks/BLYRAgBX.js";import{g as ze}from"../chunks/JkzpcrZD.js";import{e as B}from"../chunks/BZiHL9L3.js";import{I as vt}from"../chunks/CzarUgpd.js";import{W as yt}from"../chunks/DMKMpIvH.js";import{C as ht}from"../chunks/BBvIKVJT.js";import{w as X}from"../chunks/DSHGoHxX.js";import{t as D}from"../chunks/li_-Mkq2.js";r[P]="src/routes/organizations/[id]/+page.svelte";var _t=W(H('<div class="p-6 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading organization...</p></div>'),r[P],[[320,2,[[321,3],[322,3]]]]),bt=W(H('<div class="rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),r[P],[[325,2,[[326,3]]]]),zt=W(H("<!> <!> <!> <!> <!> <!>",1),r[P],[]),$t=W(H('<div class="space-y-6"><nav class="flex" aria-label="Breadcrumb"><ol class="inline-flex items-center space-x-1 md:space-x-3"><li class="inline-flex items-center"><a class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white"><svg class="w-3 h-3 mr-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg> Organizations</a></li> <li><div class="flex items-center"><svg class="w-3 h-3 text-gray-400 mx-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg> <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400"> </span></div></li></ol></nav> <!></div> <!> <!> <!> <!>',1),r[P],[[294,0,[[296,1,[[297,2,[[298,3,[[299,4,[[300,5,[[301,6]]]]]]],[306,3,[[307,4,[[308,5,[[309,6]]],[311,5]]]]]]]]]]]]);function r($e,xe){Ke(new.target),Ze(xe,!1,r);const[Ie,Te]=st(),Y=()=>(ct(he,"page"),lt(he,"$page",Ie)),M=m();let a=m(null),p=m([]),h=m([]),q=m(!0),k=m(""),C=m(!1),S=m(!1),O=m(!1),A=m(!1),f=m(null),F=null,x=m();async function Z(){if(e(M))try{o(q,!0),o(k,"");const[t,n,i]=(await E(Promise.all([$.getOrganization(e(M)),$.listOrganizationPools(e(M)).catch(()=>[]),$.listOrganizationInstances(e(M)).catch(()=>[])])))();o(a,t),o(p,n),o(h,i)}catch(t){o(k,B(t))}finally{o(q,!1)}}function we(t,n){const{events:i}=t;return{...n,events:i}}async function Ee(t){if(e(a))try{(await E($.updateOrganization(e(a).id,t)))(),(await E(Z()))(),D.success("Organization Updated",`Organization ${e(a).name} has been updated successfully.`),o(C,!1)}catch(n){throw n}}async function De(){if(e(a)){try{(await E($.deleteOrganization(e(a).id)))(),_e(N("/organizations"))}catch(t){const n=B(t);D.error("Delete Failed",n)}o(S,!1)}}async function Me(){if(e(f))try{(await E($.deleteInstance(e(f).name)))(),D.success("Instance Deleted",`Instance ${e(f).name} has been deleted successfully.`),o(O,!1),o(f,null)}catch(t){const n=B(t);D.error("Delete Failed",n),o(O,!1),o(f,null)}}function Oe(t){o(f,t),o(O,!0)}function Pe(){o(A,!0)}async function ke(t){try{if(!e(a))return;(await E($.createOrganizationPool(e(a).id,t.detail)))(),D.success("Pool Created",`Pool has been created successfully for organization ${e(a).name}.`),o(A,!1)}catch(n){const i=B(n);D.error("Pool Creation Failed",i)}}function ee(){e(x)&&it(x,e(x).scrollTop=e(x).scrollHeight)}function Ce(t){if(l(t.operation,"update")){const n=t.payload;if(e(a)&&l(n.id,e(a).id)){const i=e(a).events?.length||0,d=n.events?.length||0;o(a,we(e(a),n)),d>i&&setTimeout(()=>{ee()},100)}}else if(l(t.operation,"delete")){const n=t.payload.id||t.payload;e(a)&&l(e(a).id,n)&&_e(N("/organizations"))}}function Se(t){if(!e(a))return;const n=t.payload;if(!l(n.org_id,e(a).id,!1)){if(l(t.operation,"create"))o(p,[...e(p),n]);else if(l(t.operation,"update"))o(p,e(p).map(i=>l(i.id,n.id)?n:i));else if(l(t.operation,"delete")){const i=n.id||n;o(p,e(p).filter(d=>l(d.id,i,!1)))}}}function Ae(t){if(!e(a)||!e(p))return;const n=t.payload;if(e(p).some(d=>l(d.id,n.pool_id))){if(l(t.operation,"create"))o(h,[...e(h),n]);else if(l(t.operation,"update"))o(h,e(h).map(d=>l(d.id,n.id)?n:d));else if(l(t.operation,"delete")){const d=n.id||n;o(h,e(h).filter(V=>l(V.id,d,!1)))}}}et(()=>{Z().then(()=>{e(a)?.events?.length&&setTimeout(()=>{ee()},100)});const t=X.subscribeToEntity("organization",["update","delete"],Ce),n=X.subscribeToEntity("pool",["create","update","delete"],Se),i=X.subscribeToEntity("instance",["create","update","delete"],Ae);F=()=>{t(),n(),i()}}),tt(()=>{F&&(F(),F=null)}),at(()=>Y(),()=>{o(M,Y().params.id)}),nt(),Ye();var te=$t();Qe(t=>{Q(()=>rt.title=`${e(a),c(()=>e(a)?`${e(a).name} - Organization Details`:"Organization Details")??""} - GARM`)});var j=L(te),G=g(j),ae=g(G),R=g(ae),Fe=g(R);v(R);var ne=u(R,2),oe=g(ne),re=u(g(oe),2),Ue=g(re,!0);v(re),v(oe),v(ne),v(ae),v(G);var Le=u(G,2);{var Ne=t=>{var n=_t();w(t,n)},Be=t=>{var n=ve(),i=L(n);{var d=I=>{var T=bt(),U=g(T),J=g(U,!0);v(U),v(T),Q(()=>ge(J,e(k))),w(I,T)},V=I=>{var T=ve(),U=L(T);{var J=K=>{var ce=zt(),de=L(ce);{let _=y(()=>(e(a),c(()=>e(a).name||"Organization"))),b=y(()=>(e(a),c(()=>e(a).endpoint?.name))),Je=y(()=>(ye(ze),e(a),c(()=>ze(e(a).endpoint?.endpoint_type||"unknown"))));s(()=>gt(de,{get title(){return e(_)},get subtitle(){return`Endpoint: ${e(b)??""}`},get forgeIcon(){return e(Je)},onEdit:()=>o(C,!0),onDelete:()=>o(S,!0)}),"component",r,330,2,{componentTag:"DetailHeader"})}var ue=u(de,2);s(()=>mt(ue,{get entity(){return e(a)},entityType:"organization"}),"component",r,339,2,{componentTag:"EntityInformation"});var me=u(ue,2);{let _=y(()=>(e(a),c(()=>e(a).id||""))),b=y(()=>(e(a),c(()=>e(a).name||"")));s(()=>yt(me,{entityType:"organization",get entityId(){return e(_)},get entityName(){return e(b)}}),"component",r,342,2,{componentTag:"WebhookSection"})}var pe=u(me,2);{let _=y(()=>(e(a),c(()=>e(a).id||""))),b=y(()=>(e(a),c(()=>e(a).name||"")));s(()=>pt(pe,{get pools(){return e(p)},entityType:"organization",get entityId(){return e(_)},get entityName(){return e(b)},$$events:{addPool:Pe}}),"component",r,349,2,{componentTag:"PoolsSection"})}var fe=u(pe,2);s(()=>vt(fe,{get instances(){return e(h)},entityType:"organization",onDeleteInstance:Oe}),"component",r,358,2,{componentTag:"InstancesSection"});var Ve=u(fe,2);{let _=y(()=>(e(a),c(()=>e(a)?.events)));s(()=>ft(Ve,{get events(){return e(_)},get eventsContainer(){return e(x)},set eventsContainer(b){o(x,b)},$$legacy:!0}),"component",r,361,2,{componentTag:"EventsSection"})}w(K,ce)};s(()=>z(U,K=>{e(a)&&K(J)},!0),"if",r,328,1)}w(I,T)};s(()=>z(i,I=>{e(k)?I(d):I(V,!1)},!0),"if",r,324,1)}w(t,n)};s(()=>z(Le,t=>{e(q)?t(Ne):t(Be,!1)}),"if",r,319,1)}v(j);var ie=u(j,2);{var We=t=>{s(()=>ut(t,{get entity(){return e(a)},entityType:"organization",$$events:{close:()=>o(C,!1),submit:n=>Ee(n.detail)}}),"component",r,367,1,{componentTag:"UpdateEntityModal"})};s(()=>z(ie,t=>{e(C)&&e(a)&&t(We)}),"if",r,366,0)}var se=u(ie,2);{var He=t=>{s(()=>be(t,{title:"Delete Organization",message:"Are you sure you want to delete this organization? This action cannot be undone and will remove all associated pools and instances.",get itemName(){return e(a),c(()=>e(a).name)},$$events:{close:()=>o(S,!1),confirm:De}}),"component",r,376,1,{componentTag:"DeleteModal"})};s(()=>z(se,t=>{e(S)&&e(a)&&t(He)}),"if",r,375,0)}var le=u(se,2);{var qe=t=>{s(()=>be(t,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return e(f),c(()=>e(f).name)},$$events:{close:()=>{o(O,!1),o(f,null)},confirm:Me}}),"component",r,386,1,{componentTag:"DeleteModal"})};s(()=>z(le,t=>{e(O)&&e(f)&&t(qe)}),"if",r,385,0)}var je=u(le,2);{var Ge=t=>{{let n=y(()=>(e(a),c(()=>e(a).id||"")));s(()=>ht(t,{initialEntityType:"organization",get initialEntityId(){return e(n)},$$events:{close:()=>o(A,!1),submit:ke}}),"component",r,396,1,{componentTag:"CreatePoolModal"})}};s(()=>z(je,t=>{e(A)&&e(a)&&t(Ge)}),"if",r,395,0)}Q(t=>{dt(Fe,"href",t),ge(Ue,(e(a),c(()=>e(a)?e(a).name:"Loading...")))},[()=>(ye(N),c(()=>N("/organizations")))]),w($e,te);var Re=ot({...Xe()});return Te(),Re}export{r as component};
