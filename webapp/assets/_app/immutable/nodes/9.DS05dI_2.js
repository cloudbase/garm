import{f as m,h as qe,a as v,s as u,c as Lt,e as Pt,t as Rt}from"../chunks/ZGz3X54u.js";import{i as Fe}from"../chunks/CY7Wcm-1.js";import{p as Ge,o as We,q as Je,l as qt,b as Ke,f as P,t as h,a as Qe,g as t,m as S,u as s,h as b,c as r,s as d,d as f,$ as Xe,r as a,i as Ft}from"../chunks/kDtaAWAK.js";import{i as _,s as Ye,a as Ze}from"../chunks/Cun6jNAp.js";import{e as Gt,i as Wt}from"../chunks/DdT9Vz5Q.js";import{d as M,c as R,g as Jt,s as ut}from"../chunks/CYK-UalN.js";import{b as ta}from"../chunks/DochbgGJ.js";import{p as ea}from"../chunks/DXEzcvud.js";import{g as Kt}from"../chunks/C8dZhfFx.js";import{D as aa}from"../chunks/Dxx83T0m.js";import{S as ra}from"../chunks/DC7O3Apj.js";import{w as sa}from"../chunks/KU08Mex1.js";import{g as q,f as F}from"../chunks/ow_oMtSd.js";import{s as Qt,b as B,d as Xt}from"../chunks/ZelbukuJ.js";import{e as da}from"../chunks/BZiHL9L3.js";import{B as Yt}from"../chunks/DbE0zTOa.js";var ia=m('<div class="bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-800 rounded-md p-4"><div class="flex"><div class="ml-3"><h3 class="text-sm font-medium text-red-800 dark:text-red-200">Error</h3> <div class="mt-2 text-sm text-red-700 dark:text-red-300"> </div></div></div></div>'),la=m('<div class="bg-white dark:bg-gray-800 shadow rounded-lg"><div class="px-6 py-4 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading instance details...</p></div></div>'),na=m('<a class="text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 hover:underline"> </a>'),oa=m('<a class="text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 hover:underline"> </a>'),va=m('<span class="text-gray-400 dark:text-gray-500">-</span>'),ca=m('<div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Updated At:</dt> <dd class="text-sm text-gray-900 dark:text-white"> </dd></div>'),xa=m('<div class="flex justify-between items-center bg-gray-50 dark:bg-gray-700 p-2 rounded"><span class="font-mono text-gray-900 dark:text-white"> </span> <!></div>'),ua=m('<div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Network Addresses:</dt> <dd class="text-sm space-y-1"></dd></div>'),ma=m('<div><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Network Addresses:</dt> <dd class="text-sm text-gray-500 dark:text-gray-400 italic">No addresses available</dd></div>'),ga=m('<div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">OS Type:</dt> <dd class="text-sm text-gray-900 dark:text-white"> </dd></div>'),fa=m('<div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">OS Name:</dt> <dd class="text-sm text-gray-900 dark:text-white"> </dd></div>'),_a=m('<div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">OS Version:</dt> <dd class="text-sm text-gray-900 dark:text-white"> </dd></div>'),pa=m('<div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">OS Architecture:</dt> <dd class="text-sm text-gray-900 dark:text-white"> </dd></div>'),ha=m('<div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"><div class="flex justify-between items-start"><p class="text-sm text-gray-900 dark:text-white flex-1 mr-4"> </p> <div class="flex items-center space-x-2 flex-shrink-0"><!> <span class="text-xs text-gray-500 dark:text-gray-400"><!></span></div></div></div>'),ya=m('<div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Status Messages</h3> <div class="space-y-3 max-h-96 overflow-y-auto scroll-smooth"></div></div>'),ba=m('<div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Status Messages</h3> <div class="text-center py-8"><svg class="w-12 h-12 text-gray-400 dark:text-gray-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> <p class="text-sm text-gray-500 dark:text-gray-400">No status messages available</p></div></div>'),ka=m('<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"><div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-medium text-gray-900 dark:text-white">Instance Information</h3> <div class="flex items-center space-x-3"><button><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg> <span>Shell</span></button> <button class="px-4 py-2 bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white rounded-lg font-medium text-sm cursor-pointer">Delete Instance</button></div></div> <dl class="space-y-3"><div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">ID:</dt> <dd class="text-sm font-mono text-gray-900 dark:text-white break-all"> </dd></div> <div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Name:</dt> <dd class="text-sm text-gray-900 dark:text-white"> </dd></div> <div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Provider ID:</dt> <dd class="text-sm font-mono text-gray-900 dark:text-white break-all"> </dd></div> <div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Provider:</dt> <dd class="text-sm text-gray-900 dark:text-white"> </dd></div> <div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Pool/Scale Set:</dt> <dd class="text-sm font-mono text-gray-900 dark:text-white break-all"><!></dd></div> <div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Agent ID:</dt> <dd class="text-sm font-mono text-gray-900 dark:text-white"> </dd></div> <div class="flex justify-between"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Created At:</dt> <dd class="text-sm text-gray-900 dark:text-white"> </dd></div> <!></dl></div> <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Status & Network</h3> <dl class="space-y-3"><div class="flex justify-between items-center"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Instance Status:</dt> <dd class="text-sm"><span> </span></dd></div> <div class="flex justify-between items-center"><dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Runner Status:</dt> <dd class="text-sm"><span> </span></dd></div> <!> <!> <!> <!> <!></dl></div></div> <!>',1),wa=m('<div class="bg-white dark:bg-gray-800 shadow rounded-lg"><div class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">Instance not found.</div></div>'),Ia=m('<div class="fixed inset-0 bg-black/30 dark:bg-black/50 overflow-hidden h-full w-full z-50"><div class="relative w-full h-full flex items-center justify-center p-4"><!></div></div>'),Sa=m('<div class="space-y-6"><nav class="flex" aria-label="Breadcrumb"><ol class="inline-flex items-center space-x-1 md:space-x-3"><li class="inline-flex items-center"><a class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white"><svg class="w-3 h-3 mr-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg> Instances</a></li> <li><div class="flex items-center"><svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg> <span class="text-sm font-medium text-gray-500 dark:text-gray-400 ml-1 md:ml-2"> </span></div></li></ol></nav> <!> <!></div> <!> <!>',1);function Pa(Zt,te){Ge(te,!1);const[ee,ae]=Ye(),mt=()=>Ze(ea,"$page",ee),G=S(),C=S();let e=S(null),W=S(!0),N=S(""),$=S(!1),J=S(!1),z=null,O=S(),K=S(Date.now()),U=null;async function re(){if(t(G))try{f(W,!0),f(N,""),f(e,await Jt.getInstance(t(G)))}catch(n){f(N,n instanceof Error?n.message:"Failed to load instance")}finally{f(W,!1)}}async function se(){if(t(e)){try{await Jt.deleteInstance(t(e).name),Kt(M("/instances"))}catch(n){f(N,da(n))}f($,!1)}}function de(n){if(t(e))if(n.operation==="update"&&n.payload.id===t(e).id){const g=t(e).status_messages?.length||0,k={...t(e),...n.payload},j=k.status_messages?.length||0;f(e,k),j>g&&setTimeout(()=>{Qt(t(O))},100)}else n.operation==="delete"&&(n.payload.id||n.payload)===t(e).id&&Kt(M("/instances"))}We(()=>{re().then(()=>{t(e)?.status_messages?.length&&setTimeout(()=>{Qt(t(O))},100)}),z=sa.subscribeToEntity("instance",["update","delete"],de),U=setInterval(()=>{f(K,Date.now())},1e3)}),Je(()=>{z&&(z(),z=null),U&&(clearInterval(U),U=null)}),qt(()=>mt(),()=>{f(G,decodeURIComponent(mt().params.id||""))}),qt(()=>(t(e),t(K)),()=>{f(C,t(e)?.agent_id?(()=>{if(!t(e).capabilities?.has_shell||t(e).status==="stopped")return!0;const n=t(e).heartbeat;if(!n)return!0;const g=new Date(n);return t(K)-g.getTime()>6e4})():!0)}),Ke(),Fe();var gt=Sa();qe(n=>{h(()=>Xe.title=`${t(e),s(()=>t(e)?`${t(e).name} - Instance Details`:"Instance Details")??""} - GARM`)});var Q=P(gt),X=r(Q),ft=r(X),Y=r(ft),ie=r(Y);a(Y);var _t=d(Y,2),pt=r(_t),ht=d(r(pt),2),le=r(ht,!0);a(ht),a(pt),a(_t),a(ft),a(X);var yt=d(X,2);{var ne=n=>{var g=ia(),k=r(g),j=r(k),V=d(r(j),2),D=r(V,!0);a(V),a(j),a(k),a(g),h(()=>u(D,t(N))),v(n,g)};_(yt,n=>{t(N)&&n(ne)})}var oe=d(yt,2);{var ve=n=>{var g=la();v(n,g)},ce=n=>{var g=Lt(),k=P(g);{var j=D=>{var H=ka(),Z=P(H),tt=r(Z),et=r(tt),kt=d(r(et),2),T=r(kt),ge=d(T,2);a(kt),a(et);var wt=d(et,2),at=r(wt),It=d(r(at),2),fe=r(It,!0);a(It),a(at);var rt=d(at,2),St=d(r(rt),2),_e=r(St,!0);a(St),a(rt);var st=d(rt,2),jt=d(r(st),2),pe=r(jt,!0);a(jt),a(st);var dt=d(st,2),Dt=d(r(dt),2),he=r(Dt,!0);a(Dt),a(dt);var it=d(dt,2),Mt=d(r(it),2),ye=r(Mt);{var be=i=>{var l=na(),o=r(l,!0);a(l),h(c=>{R(l,"href",c),u(o,(t(e),s(()=>t(e).pool_id)))},[()=>(b(M),t(e),s(()=>M(`/pools/${t(e).pool_id}`)))]),v(i,l)},ke=i=>{var l=Lt(),o=P(l);{var c=p=>{var y=oa(),A=r(y,!0);a(y),h(E=>{R(y,"href",E),u(A,(t(e),s(()=>t(e).scale_set_id)))},[()=>(b(M),t(e),s(()=>M(`/scalesets/${t(e).scale_set_id}`)))]),v(p,y)},x=p=>{var y=va();v(p,y)};_(o,p=>{t(e),s(()=>t(e).scale_set_id)?p(c):p(x,!1)},!0)}v(i,l)};_(ye,i=>{t(e),s(()=>t(e).pool_id)?i(be):i(ke,!1)})}a(Mt),a(it);var lt=d(it,2),At=d(r(lt),2),we=r(At,!0);a(At),a(lt);var nt=d(lt,2),Ct=d(r(nt),2),Ie=r(Ct,!0);a(Ct),a(nt);var Se=d(nt,2);{var je=i=>{var l=ca(),o=d(r(l),2),c=r(o,!0);a(o),a(l),h(x=>u(c,x),[()=>(b(B),t(e),s(()=>B(t(e).updated_at)))]),v(i,l)};_(Se,i=>{t(e),s(()=>t(e).updated_at&&t(e).updated_at!==t(e).created_at)&&i(je)})}a(wt),a(tt);var Bt=d(tt,2),Nt=d(r(Bt),2),ot=r(Nt),Tt=d(r(ot),2),vt=r(Tt),De=r(vt,!0);a(vt),a(Tt),a(ot);var ct=d(ot,2),Et=d(r(ct),2),xt=r(Et),Me=r(xt,!0);a(xt),a(Et),a(ct);var $t=d(ct,2);{var Ae=i=>{var l=ua(),o=d(r(l),2);Gt(o,5,()=>(t(e),s(()=>t(e).addresses)),Wt,(c,x)=>{var p=xa(),y=r(p),A=r(y,!0);a(y);var E=d(y,2);{let L=Ft(()=>(t(x),s(()=>t(x).type||"Unknown")));Yt(E,{variant:"info",get text(){return t(L)}})}a(p),h(()=>u(A,(t(x),s(()=>t(x).address)))),v(c,p)}),a(o),a(l),v(i,l)},Ce=i=>{var l=ma();v(i,l)};_($t,i=>{t(e),s(()=>t(e).addresses&&t(e).addresses.length>0)?i(Ae):i(Ce,!1)})}var zt=d($t,2);{var Be=i=>{var l=ga(),o=d(r(l),2),c=r(o,!0);a(o),a(l),h(()=>u(c,(t(e),s(()=>t(e).os_type)))),v(i,l)};_(zt,i=>{t(e),s(()=>t(e).os_type)&&i(Be)})}var Ot=d(zt,2);{var Ne=i=>{var l=fa(),o=d(r(l),2),c=r(o,!0);a(o),a(l),h(()=>u(c,(t(e),s(()=>t(e).os_name)))),v(i,l)};_(Ot,i=>{t(e),s(()=>t(e).os_name)&&i(Ne)})}var Ut=d(Ot,2);{var Te=i=>{var l=_a(),o=d(r(l),2),c=r(o,!0);a(o),a(l),h(()=>u(c,(t(e),s(()=>t(e).os_version)))),v(i,l)};_(Ut,i=>{t(e),s(()=>t(e).os_version)&&i(Te)})}var Ee=d(Ut,2);{var $e=i=>{var l=pa(),o=d(r(l),2),c=r(o,!0);a(o),a(l),h(()=>u(c,(t(e),s(()=>t(e).os_arch)))),v(i,l)};_(Ee,i=>{t(e),s(()=>t(e).os_arch)&&i($e)})}a(Nt),a(Bt),a(Z);var ze=d(Z,2);{var Oe=i=>{var l=ya(),o=d(r(l),2);Gt(o,5,()=>(t(e),s(()=>t(e).status_messages)),Wt,(c,x)=>{var p=ha(),y=r(p),A=r(y),E=r(A,!0);a(A);var L=d(A,2),Vt=r(L);{var Ve=w=>{const I=Ft(()=>(b(Xt),t(x),s(()=>Xt(t(x).event_level))));Yt(w,{get variant(){return b(t(I)),s(()=>t(I).variant)},get text(){return b(t(I)),s(()=>t(I).text)}})};_(Vt,w=>{t(x),s(()=>t(x).event_level)&&w(Ve)})}var Ht=d(Vt,2),He=r(Ht);{var Le=w=>{var I=Rt();h(Re=>u(I,Re),[()=>(b(B),t(x),s(()=>B(t(x).created_at)))]),v(w,I)},Pe=w=>{var I=Rt("Unknown date");v(w,I)};_(He,w=>{t(x),s(()=>t(x).created_at)?w(Le):w(Pe,!1)})}a(Ht),a(L),a(y),a(p),h(()=>u(E,(t(x),s(()=>t(x).message)))),v(c,p)}),a(o),ta(o,c=>f(O,c),()=>t(O)),a(l),v(i,l)},Ue=i=>{var l=ba();v(i,l)};_(ze,i=>{t(e),s(()=>t(e).status_messages&&t(e).status_messages.length>0)?i(Oe):i(Ue,!1)})}h((i,l,o,c,x)=>{T.disabled=t(C),ut(T,1,`px-4 py-2 ${t(C)?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800 cursor-pointer"} text-white rounded-lg font-medium text-sm flex items-center space-x-2`),R(T,"title",(t(C),t(e),s(()=>t(C)?t(e)?.capabilities?.has_shell?t(e)?.status==="stopped"?"Shell unavailable - Instance is stopped":"Shell unavailable - Agent heartbeat is stale":"Shell unavailable - Agent does not support shell":"Open Shell"))),u(fe,(t(e),s(()=>t(e).id))),u(_e,(t(e),s(()=>t(e).name))),u(pe,(t(e),s(()=>t(e).provider_id))),u(he,(t(e),s(()=>t(e).provider_name||"Unknown"))),u(we,(t(e),s(()=>t(e).agent_id||"Not assigned"))),u(Ie,i),ut(vt,1,`inline-flex px-2 py-1 text-xs font-semibold rounded-full ring-1 ring-inset ${l??""}`),u(De,o),ut(xt,1,`inline-flex px-2 py-1 text-xs font-semibold rounded-full ring-1 ring-inset ${c??""}`),u(Me,x)},[()=>(b(B),t(e),s(()=>B(t(e).created_at))),()=>(b(q),t(e),s(()=>q(t(e).status||"unknown"))),()=>(b(F),t(e),s(()=>F(t(e).status||"unknown"))),()=>(b(q),t(e),s(()=>q(t(e).runner_status||"unknown"))),()=>(b(F),t(e),s(()=>F(t(e).runner_status||"unknown")))]),Pt("click",T,()=>f(J,!0)),Pt("click",ge,()=>f($,!0)),v(D,H)},V=D=>{var H=wa();v(D,H)};_(k,D=>{t(e)?D(j):D(V,!1)},!0)}v(n,g)};_(oe,n=>{t(W)?n(ve):n(ce,!1)})}a(Q);var bt=d(Q,2);{var xe=n=>{var g=Ia(),k=r(g),j=r(k);ra(j,{get runnerName(){return t(e),s(()=>t(e).name)},onClose:()=>f(J,!1)}),a(k),a(g),v(n,g)};_(bt,n=>{t(J)&&t(e)&&!t(C)&&n(xe)})}var ue=d(bt,2);{var me=n=>{aa(n,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return t(e),s(()=>t(e).name)},$$events:{close:()=>f($,!1),confirm:se}})};_(ue,n=>{t($)&&t(e)&&n(me)})}h(n=>{R(ie,"href",n),u(le,(t(e),s(()=>t(e)?t(e).name:"Instance Details")))},[()=>(b(M),s(()=>M("/instances")))]),v(Zt,gt),Qe(),ae()}export{Pa as component};
