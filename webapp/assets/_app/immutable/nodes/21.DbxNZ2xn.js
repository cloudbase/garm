import"../chunks/DsnmJJEf.js";import{i as we}from"../chunks/TJn6xDN9.js";import{p as be,o as Te,l as b,h as $e,f as se,j as ke,a as D,b as h,c as Le,g as e,m as l,$ as Pe,k as a,A as O,u as n,s as T,q as d,v as E,d as $,r as k,z as Ae,D as ee,t as te,e as ae}from"../chunks/DniTuB_0.js";import{i as L,s as Me,a as De}from"../chunks/DbNhg6mG.js";import{g as I}from"../chunks/BAMHjnwW.js";import{d as B,g as Ee}from"../chunks/CKHGi7RD.js";import{P as Ie}from"../chunks/DCRHjgMG.js";import{A as Be}from"../chunks/DqVlvb4K.js";import{D as Se,G as S,A as Fe}from"../chunks/DSa_5ZRu.js";import{t as q}from"../chunks/CBJzOE8U.js";import{e as Ge}from"../chunks/BZiHL9L3.js";import{B as re}from"../chunks/7xg7bIQm.js";import{D as Re}from"../chunks/l9TDaXD3.js";import{E as ze}from"../chunks/C3rmHwOU.js";import{i as Ue}from"../chunks/C98nByjP.js";import{e as Ne,a as oe}from"../chunks/Dlk7qPpN.js";var Oe=se('<div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4 mb-6"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-red-800 dark:text-red-200">Error loading templates</h3> <div class="mt-2 text-sm text-red-700 dark:text-red-300"> </div> <div class="mt-4"><!></div></div></div></div>'),qe=se("<!> <!> <!> <!>",1);function lt(le,ne){be(ne,!1);const[ie,de]=Me(),g=()=>De(Ne,"$eagerCache",ie),F=l(),G=l(),f=l(),H=l();let y=l([]),P=l(""),m=l(""),i=l(1),v=l(25),x=l(1),A=l(!1),c=l(null);async function ce(){try{await oe.retryResource("templates")}catch(t){console.error("Retry failed:",t)}}async function me(){if(e(c)?.id)try{await Ee.deleteTemplate(e(c).id),q.add({type:"success",title:"Template deleted",message:`Template "${e(c).name}" has been deleted successfully.`}),a(A,!1),a(c,null)}catch(t){const r=Ge(t);q.add({type:"error",title:"Failed to delete template",message:r})}}function pe(){I(B("/templates/create"))}async function j(t){if(!t.id){q.add({type:"error",title:"Error",message:"Template ID is missing"});return}I(B(`/templates/create?clone=${t.id}`))}function W(t){a(c,t),a(A,!0)}function J(t){switch(t){case"github":return{color:"blue",text:"GitHub"};case"gitea":return{color:"green",text:"Gitea"};default:return{color:"gray",text:t||"Unknown"}}}function K(t){switch(t){case"linux":return{color:"blue",text:"Linux"};case"windows":return{color:"info",text:"Windows"};default:return{color:"gray",text:t||"Unknown"}}}const ue=[{key:"name",title:"Name",cellComponent:ze,cellProps:{entityType:"template"}},{key:"description",title:"Description",cellComponent:S,cellProps:{field:"description",type:"description"}},{key:"forge_type",title:"Forge Type",cellComponent:S,cellProps:{field:"forge_type"}},{key:"os_type",title:"OS Type",cellComponent:S,cellProps:{field:"os_type"}},{key:"owner_id",title:"Owner",cellComponent:S,cellProps:{field:"owner_id"}},{key:"actions",title:"Actions",align:"right",cellComponent:Fe,cellProps:t=>{const r=Ue(),s=t.owner_id==="system",o=[];return o.push({type:"copy",title:"Clone",ariaLabel:"Clone template",action:"clone"}),(r||!s)&&o.push({type:"edit",title:"Edit",ariaLabel:"Edit template",action:"edit"}),(r||!s)&&o.push({type:"delete",title:"Delete",ariaLabel:"Delete template",action:"delete"}),{actions:o}}}],ge={entityType:"template",primaryText:{field:"name",isClickable:!0,href:"/templates/{id}"},secondaryText:{field:"description"},badges:[{type:"custom",value:t=>{const r=J(t.forge_type);return{variant:r.color,text:r.text}}},{type:"custom",value:t=>{const r=K(t.os_type);return{variant:r.color,text:r.text}}}],actions:[{type:"clone",handler:t=>j(t)},{type:"edit",handler:t=>I(B(`/templates/${t.id}?edit=true`))},{type:"delete",handler:t=>W(t)}]};Te(async()=>{try{const t=await oe.getTemplates();t&&Array.isArray(t)&&a(y,t)}catch(t){console.error("Failed to load templates:",t),a(P,t instanceof Error?t.message:"Failed to load templates")}}),b(()=>(e(y),g()),()=>{(!e(y).length||g().loaded.templates)&&a(y,g().templates)}),b(()=>g(),()=>{a(F,g().loading.templates)}),b(()=>g(),()=>{a(G,g().errorMessages.templates)}),b(()=>(e(m),e(y)),()=>{a(f,e(m)?e(y).filter(t=>t.name?.toLowerCase().includes(e(m).toLowerCase())||t.description?.toLowerCase().includes(e(m).toLowerCase())||t.forge_type?.toLowerCase().includes(e(m).toLowerCase())||t.os_type?.toLowerCase().includes(e(m).toLowerCase())):e(y))}),b(()=>(e(x),e(f),e(v),e(i)),()=>{a(x,Math.ceil(e(f).length/e(v))),e(i)>e(x)&&e(x)>0&&a(i,e(x))}),b(()=>(e(f),e(i),e(v)),()=>{a(H,e(f).slice((e(i)-1)*e(v),e(i)*e(v)))}),$e(),we();var Q=qe();ke(t=>{Pe.title="Runner Install Templates - GARM"});var V=D(Q);Ie(V,{title:"Runner Install Templates",description:"Manage templates for configuring runner software installation. These templates can be set on pools or scale sets.",actionLabel:"Create Template",showAction:!0,$$events:{action:pe}});var X=T(V,2);{var fe=t=>{var r=Oe(),s=$(r),o=T($(s),2),C=T($(o),2),R=$(C,!0);k(C);var M=T(C,2),z=$(M);Be(z,{variant:"secondary",size:"sm",$$events:{click:ce},children:(p,u)=>{Ae();var U=ee("Try Again");h(p,U)},$$slots:{default:!0}}),k(M),k(o),k(s),k(r),te(()=>ae(R,e(P)||e(G))),h(t,r)};L(X,t=>{(e(P)||e(G))&&!e(F)&&t(fe)})}var Y=T(X,2);Se(Y,{get columns(){return ue},get data(){return e(H)},get loading(){return e(F)},get error(){return e(P)},get searchTerm(){return e(m)},searchPlaceholder:"Search templates by name, description, type...",get currentPage(){return e(i)},get perPage(){return e(v)},get totalPages(){return e(x)},get totalItems(){return e(f),n(()=>e(f).length)},get mobileCardConfig(){return ge},emptyMessage:"No templates found",$$events:{search:t=>{a(m,t.detail.term),a(i,1)},pageChange:t=>a(i,t.detail.page),perPageChange:t=>{a(v,t.detail.perPage),a(i,1)},clone:t=>j(t.detail.item),edit:t=>I(B(`/templates/${t.detail.item.id}?edit=true`)),delete:t=>W(t.detail.item)},$$slots:{cell:(t,r)=>{const s=E(()=>r.item),o=E(()=>r.column);var C=O(),R=D(C);{var M=p=>{const u=E(()=>(d(e(s)),n(()=>J(e(s).forge_type))));re(p,{get variant(){return d(e(u)),n(()=>e(u).color)},get text(){return d(e(u)),n(()=>e(u).text)}})},z=p=>{var u=O(),U=D(u);{var _e=w=>{const _=E(()=>(d(e(s)),n(()=>K(e(s).os_type))));re(w,{get variant(){return d(e(_)),n(()=>e(_).color)},get text(){return d(e(_)),n(()=>e(_).text)}})},he=w=>{var _=O(),xe=D(_);{var Ce=N=>{var Z=ee();te(()=>ae(Z,(d(e(s)),n(()=>e(s).owner_id==="system"?"System":e(s).owner_id||"Unknown")))),h(N,Z)};L(xe,N=>{d(e(o)),n(()=>e(o).key==="owner_id")&&N(Ce)},!0)}h(w,_)};L(U,w=>{d(e(o)),n(()=>e(o).key==="os_type")?w(_e):w(he,!1)},!0)}h(p,u)};L(R,p=>{d(e(o)),n(()=>e(o).key==="forge_type")?p(M):p(z,!1)})}h(t,C)}}});var ye=T(Y,2);{var ve=t=>{Re(t,{title:"Delete Template",message:"Are you sure you want to delete this template? This action cannot be undone.",get itemName(){return e(c),n(()=>e(c).name)},$$events:{close:()=>{a(A,!1),a(c,null)},confirm:me}})};L(ye,t=>{e(A)&&e(c)&&t(ve)})}h(le,Q),Le(),de()}export{lt as component};
