import{c as Xe,a as S,s as ve,b as F,e as Ue,l as Ze,f as B,h as ct}from"../chunks/CxOx-TIJ.js";import{i as et}from"../chunks/3NxSoY2_.js";import{p as tt,B as gt,o as at,l as z,j as a,m as l,g as e,i as me,k as R,b as rt,d as p,s,c as o,r as n,t as te,v as Je,u as _,w as Ie,a as ot,n as J,F as C,f as ut,$ as mt,e as pe,y as pt,h as A}from"../chunks/DzFKsO_V.js";import{a as nt,i as ae,s as it,v as st}from"../chunks/B_jyf0qs.js";import{r as fe,b as Ve,h as ft,d as vt,c as Ye,g as ze}from"../chunks/BguOOs3x.js";import{l as Re}from"../chunks/BAcG6-Ep.js";import{e as bt,i as ht}from"../chunks/CdXRaxkX.js";import{w as yt}from"../chunks/DoJxysSt.js";import{b as Ke,a as We}from"../chunks/BVM1034P.js";import{p as _t}from"../chunks/CdEA5IGF.js";import{M as xt}from"../chunks/Pgjt70l7.js";import{F as kt}from"../chunks/DvQW-lMP.js";import{e as je}from"../chunks/BZiHL9L3.js";import{e as $e,a as Ge}from"../chunks/Penjr-j0.js";import{U as wt}from"../chunks/B8GNZv7s.js";import{D as zt}from"../chunks/DL1RlOO9.js";import{P as $t}from"../chunks/DTko0dwG.js";import{t as ee}from"../chunks/li_-Mkq2.js";import{k as Le,g as Ne,l as Ct}from"../chunks/JkzpcrZD.js";import{B as Tt}from"../chunks/1CdJgrM6.js";import{D as Mt,E as Ot,a as Pt,G as Et,S as At,A as Dt}from"../chunks/C2FKJqnN.js";import{A as Qe}from"../chunks/Ct5kWObc.js";f[C]="src/lib/components/CreateOrganizationModal.svelte";var Ft=S(B('<div class="mb-4 rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),f[C],[[124,3,[[125,4]]]]),St=S(B('<div class="text-center py-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading...</p></div>'),f[C],[[130,3,[[131,4],[132,4]]]]),Bt=S(B("<option> </option>"),f[C],[[171,7]]),Ut=S(B('<input type="password" class="block w-full px-3 py-2 mt-3 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter webhook secret"/>'),f[C],[[261,7]]),It=S(B('<p class="text-sm text-gray-500 dark:text-gray-400">Webhook secret will be automatically generated</p>'),f[C],[[268,7]]),Rt=S(B('<form class="space-y-4"><!> <div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Organization Name</label> <input id="name" type="text" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter organization name"/></div> <div><label for="credentials" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Credentials</label> <select id="credentials" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Select credentials...</option><!></select></div> <div><div class="flex items-center mb-1"><label for="pool_balancer_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Pool Balancer Type</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50"><div class="mb-2"><strong>Round Robin:</strong> Cycles through pools in turn. Job 1 → Pool 1, Job 2 → Pool 2, etc.</div> <div><strong>Pack:</strong> Uses first available pool until full, then moves to next pool.</div> <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="pool_balancer_type" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Round Robin</option><option>Pack</option></select></div> <div><div class="flex items-center mb-3"><input id="agent-mode" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="agent-mode" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Agent Mode</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">When enabled, runners will be installed with the GARM agent via userdata install templates. This allows for enhanced runner management and control. <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div></div> <div><div class="flex items-center mb-3"><input id="install-webhook" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="install-webhook" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Install Webhook</label></div> <div class="space-y-3"><div class="flex items-center"><input id="generate-webhook-secret" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="generate-webhook-secret" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Auto-generate webhook secret</label></div> <!></div></div> <div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 cursor-pointer">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"> </button></div></form>'),f[C],[[135,3,[[143,4,[[144,5],[147,5]]],[158,4,[[159,5],[162,5,[[169,6]]]]],[179,4,[[180,5,[[181,6],[184,6,[[185,7,[[186,8]]],[188,7,[[189,8,[[190,9]]],[192,8,[[193,9]]],[195,8]]]]]]],[199,5,[[204,6],[205,6]]]]],[210,4,[[211,5,[[212,6],[218,6],[221,6,[[222,7,[[223,8]]],[225,7,[[227,8]]]]]]]]],[234,4,[[235,5,[[236,6],[242,6]]],[247,5,[[248,6,[[249,7],[255,7]]]]]]],[276,4,[[277,5],[284,5]]]]]]),Wt=S(B('<div class="max-w-2xl w-full p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Create Organization</h3> <!> <!></div>'),f[C],[[120,1,[[121,2]]]]);function f(Ce,Te){Xe(new.target),tt(Te,!1,f);const[Me,Oe]=it(),h=()=>(st($e,"eagerCache"),nt($e,"$eagerCache",Me)),U=l(),T=l(),M=l(),re=l(),O=gt();let P=l(!1),y=l(""),x=l("github"),r=l({name:"",credentials_name:"",webhook_secret:"",pool_balancer_type:"roundrobin",agent_mode:!1}),$=l(!0),v=l(!0);async function W(){if(!h().loaded.credentials&&!h().loading.credentials)try{(await J(Ge.getCredentials()))()}catch(d){a(y,je(d))}}function V(d){a(x,d.detail),R(r,e(r).credentials_name="")}function c(){if(e(r).credentials_name){const d=e(U).find(Y=>me(Y.name,e(r).credentials_name));d&&d.forge_type&&a(x,d.forge_type)}}function Pe(){const d=new Uint8Array(32);return crypto.getRandomValues(d),Array.from(d,Y=>Y.toString(16).padStart(2,"0")).join("")}async function Ee(){if(!e(r).name?.trim()){a(y,"Organization name is required");return}if(!e(r).credentials_name){a(y,"Please select credentials");return}try{a(P,!0),a(y,"");const d={...e(r),install_webhook:e($),auto_generate_secret:e(v)};O("submit",d)}catch(d){a(y,d instanceof Error?d.message:"Failed to create organization"),a(P,!1)}}at(()=>{W()}),z(()=>h(),()=>{a(U,h().credentials)}),z(()=>h(),()=>{a(T,h().loading.credentials)}),z(()=>(e(U),e(x)),()=>{a(M,e(U).filter(d=>e(x)?me(d.forge_type,e(x)):!0))}),z(()=>e(v),()=>{e(v)?R(r,e(r).webhook_secret=Pe()):e(v)||R(r,e(r).webhook_secret="")}),z(()=>(e(r),e(v)),()=>{a(re,me(e(r).name?.trim(),"",!1)&&me(e(r).credentials_name,"",!1)&&(e(v)||e(r).webhook_secret&&me(e(r).webhook_secret.trim(),"",!1)))}),rt(),et(),p(()=>xt(Ce,{$$events:{close:()=>O("close")},children:yt(f,(d,Y)=>{var L=Wt(),K=s(o(L),2);{var De=k=>{var w=Ft(),N=o(w),j=o(N,!0);n(N),n(w),te(()=>ve(j,e(y))),F(k,w)};p(()=>ae(K,k=>{e(y)&&k(De)}),"if",f,123,2)}var Fe=s(K,2);{var Se=k=>{var w=St();F(k,w)},Be=k=>{var w=Rt(),N=o(w);p(()=>kt(N,{get selectedForgeType(){return e(x)},set selectedForgeType(i){a(x,i)},$$events:{select:V},$$legacy:!0}),"component",f,137,4,{componentTag:"ForgeTypeSelector"});var j=s(N,2),oe=s(o(j),2);fe(oe),n(j);var G=s(j,2),q=s(o(G),2);te(()=>{e(r),Je(()=>{e(M)})});var ne=o(q);ne.value=ne.__value="";var be=s(ne);p(()=>bt(be,1,()=>e(M),ht,(i,m)=>{var D=Bt(),we=o(D);n(D);var ue={};te(()=>{ve(we,`${e(m),_(()=>e(m).name)??""} (${e(m),_(()=>e(m).endpoint?.name||"Unknown endpoint")??""})`),ue!==(ue=(e(m),_(()=>e(m).name)))&&(D.value=(D.__value=(e(m),_(()=>e(m).name)))??"")}),F(i,D)}),"each",f,170,6),n(q),n(G);var ie=s(G,2),Q=s(o(ie),2);te(()=>{e(r),Je(()=>{})});var se=o(Q);se.value=se.__value="roundrobin";var he=s(se);he.value=he.__value="pack",n(Q),n(ie);var le=s(ie,2),ye=o(le),t=o(ye);fe(t),Ie(4),n(ye),n(le);var g=s(le,2),H=o(g),E=o(H);fe(E),Ie(2),n(H);var u=s(H,2),_e=o(u),I=o(_e);fe(I),Ie(2),n(_e);var de=s(_e,2);{var ce=i=>{var m=Ut();fe(m),Ke(m,()=>e(r).webhook_secret,D=>R(r,e(r).webhook_secret=D)),F(i,m)},ge=i=>{var m=It();F(i,m)};p(()=>ae(de,i=>{e(v)?i(ge,!1):i(ce)}),"if",f,260,6)}n(u),n(g);var X=s(g,2),xe=o(X),Z=s(xe,2),ke=o(Z,!0);n(Z),n(X),n(w),te(()=>{Z.disabled=e(P)||e(T)||!e(re),ve(ke,e(P)?"Creating...":"Create Organization")}),Ke(oe,()=>e(r).name,i=>R(r,e(r).name=i)),Ve(q,()=>e(r).credentials_name,i=>R(r,e(r).credentials_name=i)),Ue("change",q,c),Ve(Q,()=>e(r).pool_balancer_type,i=>R(r,e(r).pool_balancer_type=i)),We(t,()=>e(r).agent_mode,i=>R(r,e(r).agent_mode=i)),We(E,()=>e($),i=>a($,i)),We(I,()=>e(v),i=>a(v,i)),Ue("click",xe,()=>O("close")),Ue("submit",w,_t(Ee)),F(k,w)};p(()=>ae(Fe,k=>{e(P)?k(Se):k(Be,!1)}),"if",f,129,2)}n(L),F(d,L)}),$$slots:{default:!0}}),"component",f,119,0,{componentTag:"Modal"});var Ae=ot({...Ze()});return Oe(),Ae}b[C]="src/routes/organizations/+page.svelte";var Lt=S(B('<div class="flex items-center justify-between"><div class="flex-1 min-w-0"><a class="block"><p class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 truncate"> </p> <div class="flex items-center mt-1 space-x-2"><div class="flex items-center text-xs text-gray-500 dark:text-gray-400"><!> <span class="ml-1"> </span></div></div></a></div> <div class="flex items-center space-x-3 ml-4"><!> <div class="flex space-x-2"><!> <!></div></div></div>'),b[C],[[308,3,[[309,4,[[310,5,[[311,6],[314,6,[[315,7,[[317,8]]]]]]]]],[322,4,[[324,5]]]]]]),Nt=S(B('<div class="space-y-6"><!> <!></div> <!> <!> <!>',1),b[C],[[274,0]]);function b(Ce,Te){Xe(new.target),tt(Te,!1,b);const[Me,Oe]=it(),h=()=>(st($e,"eagerCache"),nt($e,"$eagerCache",Me)),U=l(),T=l(),M=l(),re=l();let O=l([]),P=l(!0),y=l(""),x=l(""),r=l(1),$=l(25),v=l(!1),W=l(!1),V=l(!1),c=l(null);function Pe(){a(v,!1),a(V,!1),a(W,!1)}async function Ee(t){try{a(y,"");const g=t.detail,H={name:g.name,credentials_name:g.credentials_name,webhook_secret:g.webhook_secret,pool_balancer_type:g.pool_balancer_type},E=(await J(ze.createOrganization(H)))();if(g.install_webhook&&E.id)try{(await J(ze.installOrganizationWebhook(E.id)))(),ee.success("Webhook Installed",`Webhook for organization ${E.name} has been installed successfully.`)}catch(u){console.warn(...Re("warn","Organization created but webhook installation failed:",u)),ee.error("Webhook Installation Failed",u instanceof Error?u.message:"Failed to install webhook. You can try installing it manually from the organization details page.")}ee.success("Organization Created",`Organization ${E.name} has been created successfully.`),a(v,!1)}catch(g){throw a(y,je(g)),g}}async function Ae(t){if(e(c))try{(await J(ze.updateOrganization(e(c).id,t)))(),ee.success("Organization Updated",`Organization ${e(c).name} has been updated successfully.`),a(W,!1),a(c,null)}catch(g){throw g}}async function d(){if(e(c))try{a(y,""),(await J(ze.deleteOrganization(e(c).id)))(),ee.success("Organization Deleted",`Organization ${e(c).name} has been deleted successfully.`),a(c,null)}catch(t){const g=je(t);ee.error("Delete Failed",g)}finally{Pe()}}function Y(){a(v,!0)}function L(t){a(c,t),a(W,!0)}function K(t){a(c,t),a(V,!0)}at(async()=>{try{a(P,!0);const t=(await J(Ge.getOrganizations()))();t&&Array.isArray(t)&&a(O,t)}catch(t){console.error(...Re("error","Failed to load organizations:",t)),a(y,t instanceof Error?t.message:"Failed to load organizations")}finally{a(P,!1)}});async function De(){try{(await J(Ge.retryResource("organizations")))()}catch(t){console.error(...Re("error","Retry failed:",t))}}const Fe=[{key:"name",title:"Name",cellComponent:Ot,cellProps:{entityType:"organization"}},{key:"endpoint",title:"Endpoint",cellComponent:Pt},{key:"credentials",title:"Credentials",cellComponent:Et,cellProps:{field:"credentials_name"}},{key:"status",title:"Status",cellComponent:At,cellProps:{statusType:"entity"}},{key:"actions",title:"Actions",align:"right",cellComponent:Dt}],Se={entityType:"organization",primaryText:{field:"name",isClickable:!0,href:"/organizations/{id}"},customInfo:[{icon:t=>Ne(t?.endpoint?.endpoint_type||"unknown"),text:t=>t?.endpoint?.name||"Unknown"}],badges:[{type:"custom",value:t=>Le(t)}],actions:[{type:"edit",handler:t=>L(t)},{type:"delete",handler:t=>K(t)}]};function Be(t){a(x,t.detail.term),a(r,1)}function k(t){a(r,t.detail.page)}function w(t){a($,t.detail.perPage),a(r,1)}function N(t){L(t.detail.item)}function j(t){K(t.detail.item)}z(()=>(e(O),h()),()=>{(!e(O).length||h().loaded.organizations)&&a(O,h().organizations)}),z(()=>h(),()=>{a(P,h().loading.organizations)}),z(()=>h(),()=>{a(U,h().errorMessages.organizations)}),z(()=>(e(O),e(x)),()=>{a(T,Ct(e(O),e(x)))}),z(()=>(e(T),e($)),()=>{a(M,Math.ceil(e(T).length/e($)))}),z(()=>(e(r),e(M)),()=>{e(r)>e(M)&&e(M)>0&&a(r,e(M))}),z(()=>(e(T),e(r),e($)),()=>{a(re,e(T).slice((e(r)-1)*e($),e(r)*e($)))}),rt(),et();var oe=Nt();ct(t=>{mt.title="Organizations - GARM"});var G=ut(oe),q=o(G);p(()=>$t(q,{title:"Organizations",description:"Manage GitHub and Gitea organizations",actionLabel:"Add Organization",$$events:{action:Y}}),"component",b,276,1,{componentTag:"PageHeader"});var ne=s(q,2);{let t=pe(()=>e(U)||e(y)),g=pe(()=>!!e(U));p(()=>Mt(ne,{get columns(){return Fe},get data(){return e(re)},get loading(){return e(P)},get error(){return e(t)},get searchTerm(){return e(x)},searchPlaceholder:"Search organizations...",get currentPage(){return e(r)},get perPage(){return e($)},get totalPages(){return e(M)},get totalItems(){return e(T),_(()=>e(T).length)},itemName:"organizations",emptyIconType:"building",get showRetry(){return e(g)},get mobileCardConfig(){return Se},$$events:{search:Be,pageChange:k,perPageChange:w,retry:De,edit:N,delete:j},$$slots:{"mobile-card":(H,E)=>{const u=pe(()=>E.item),_e=pe(()=>E.index),I=pt(pe(()=>(A(Le),A(e(u)),_(()=>Le(e(u))))),"status");e(I);var de=Lt(),ce=o(de),ge=o(ce),X=o(ge),xe=o(X,!0);n(X);var Z=s(X,2),ke=o(Z),i=o(ke);ft(i,()=>(A(Ne),A(e(u)),_(()=>Ne(e(u).endpoint?.endpoint_type||"unknown"))));var m=s(i,2),D=o(m,!0);n(m),n(ke),n(Z),n(ge),n(ce);var we=s(ce,2),ue=o(we);p(()=>Tt(ue,{get variant(){return A(e(I)),_(()=>e(I).variant)},get text(){return A(e(I)),_(()=>e(I).text)}}),"component",b,323,5,{componentTag:"Badge"});var qe=s(ue,2),He=o(qe);p(()=>Qe(He,{action:"edit",size:"sm",title:"Edit organization",ariaLabel:"Edit organization",$$events:{click:()=>L(e(u))}}),"component",b,325,6,{componentTag:"ActionButton"});var lt=s(He,2);p(()=>Qe(lt,{action:"delete",size:"sm",title:"Delete organization",ariaLabel:"Delete organization",$$events:{click:()=>K(e(u))}}),"component",b,332,6,{componentTag:"ActionButton"}),n(qe),n(we),n(de),te(dt=>{vt(ge,"href",dt),ve(xe,(A(e(u)),_(()=>e(u).name))),ve(D,(A(e(u)),_(()=>e(u).endpoint?.name||"Unknown")))},[()=>(A(Ye),A(e(u)),_(()=>Ye(`/organizations/${e(u).id}`)))]),F(H,de)}}}),"component",b,283,1,{componentTag:"DataTable"})}n(G);var be=s(G,2);{var ie=t=>{p(()=>f(t,{$$events:{close:()=>a(v,!1),submit:Ee}}),"component",b,349,1,{componentTag:"CreateOrganizationModal"})};p(()=>ae(be,t=>{e(v)&&t(ie)}),"if",b,348,0)}var Q=s(be,2);{var se=t=>{p(()=>wt(t,{get entity(){return e(c)},entityType:"organization",$$events:{close:()=>{a(W,!1),a(c,null)},submit:g=>Ae(g.detail)}}),"component",b,356,1,{componentTag:"UpdateEntityModal"})};p(()=>ae(Q,t=>{e(W)&&e(c)&&t(se)}),"if",b,355,0)}var he=s(Q,2);{var le=t=>{p(()=>zt(t,{title:"Delete Organization",message:"Are you sure you want to delete this organization? This action cannot be undone.",get itemName(){return e(c),_(()=>e(c).name)},$$events:{close:()=>{a(V,!1),a(c,null)},confirm:d}}),"component",b,365,1,{componentTag:"DeleteModal"})};p(()=>ae(he,t=>{e(V)&&e(c)&&t(le)}),"if",b,364,0)}F(Ce,oe);var ye=ot({...Ze()});return Oe(),ye}export{b as component};
