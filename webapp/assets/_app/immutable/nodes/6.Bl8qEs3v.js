import"../chunks/DsnmJJEf.js";import{i as Ne}from"../chunks/B3Pzt0F_.js";import{p as qe,o as ze,A as Ge,l as je,a as Re,f as F,h as Ve,b as B,t as G,c as E,d as We,g as e,m as i,s,u as l,$ as Je,j as u,r as f,k as d,v as ie,y as Ke,B as le,q as v,n as Oe}from"../chunks/D8EpLgQ1.js";import{i as g,s as Qe,a as Xe}from"../chunks/5WA7h8uK.js";import{c as Ye,g as y}from"../chunks/CiE1LlKV.js";import{p as Ze}from"../chunks/-1rkm990.js";import{g as de}from"../chunks/DsX4H4sg.js";import{b as j}from"../chunks/D3_ugSUS.js";import{U as et}from"../chunks/CIBm3n2u.js";import{D as ce}from"../chunks/KQ2xQpA3.js";import{E as tt,P as at,a as rt}from"../chunks/DxQgLoe9.js";import{D as st,I as nt}from"../chunks/G-ddPbA8.js";import{g as pe}from"../chunks/D5ucq3Gx.js";import{w as R}from"../chunks/u94nIB4-.js";import{t as D}from"../chunks/BEkVdVE1.js";import{C as ot}from"../chunks/CRD55Dyg.js";import{e as ue}from"../chunks/BZiHL9L3.js";var it=F('<div class="p-6 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading enterprise...</p></div>'),lt=F('<div class="rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),dt=F("<!> <!> <!> <!> <!>",1),ct=F('<div class="space-y-6"><nav class="flex" aria-label="Breadcrumb"><ol class="inline-flex items-center space-x-1 md:space-x-3"><li class="inline-flex items-center"><a class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white"><svg class="w-3 h-3 mr-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg> Enterprises</a></li> <li><div class="flex items-center"><svg class="w-3 h-3 text-gray-400 mx-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg> <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400"> </span></div></li></ol></nav> <!></div> <!> <!> <!> <!>',1);function Tt(fe,me){qe(me,!1);const[ve,ge]=Qe(),V=()=>Xe(Ze,"$page",ve),$=i();let a=i(null),c=i([]),m=i([]),S=i(!0),P=i(""),T=i(!1),M=i(!1),x=i(!1),C=i(!1),p=i(null),k=null,h=i();async function W(){if(e($))try{s(S,!0),s(P,"");const[t,r,n]=await Promise.all([y.getEnterprise(e($)),y.listEnterprisePools(e($)).catch(()=>[]),y.listEnterpriseInstances(e($)).catch(()=>[])]);s(a,t),s(c,r),s(m,n)}catch(t){s(P,t instanceof Error?t.message:"Failed to load enterprise")}finally{s(S,!1)}}function ye(t,r){const{events:n}=t;return{...r,events:n}}async function he(t){if(e(a))try{await y.updateEnterprise(e(a).id,t),await W(),D.success("Enterprise Updated",`Enterprise ${e(a).name} has been updated successfully.`),s(T,!1)}catch(r){throw r}}async function be(){if(e(a)){try{await y.deleteEnterprise(e(a).id),de(`${j}/enterprises`)}catch(t){const r=ue(t);D.error("Delete Failed",r)}s(M,!1)}}async function _e(){if(e(p))try{await y.deleteInstance(e(p).name),D.success("Instance Deleted",`Instance ${e(p).name} has been deleted successfully.`),s(x,!1),s(p,null)}catch(t){const r=ue(t);D.error("Delete Failed",r),s(x,!1),s(p,null)}}function Ee(t){s(p,t),s(x,!0)}function $e(){s(C,!0)}async function xe(t){try{if(!e(a))return;await y.createEnterprisePool(e(a).id,t.detail),D.success("Pool Created",`Pool has been created successfully for enterprise ${e(a).name}.`),s(C,!1)}catch(r){throw r}}function J(){e(h)&&Ke(h,e(h).scrollTop=e(h).scrollHeight)}function Ie(t){if(t.operation==="update"){const r=t.payload;if(e(a)&&r.id===e(a).id){const n=e(a).events?.length||0,o=r.events?.length||0;s(a,ye(e(a),r)),o>n&&setTimeout(()=>{J()},100)}}else if(t.operation==="delete"){const r=t.payload.id||t.payload;e(a)&&e(a).id===r&&de(`${j}/enterprises`)}}function we(t){if(!e(a))return;const r=t.payload;if(r.enterprise_id===e(a).id){if(t.operation==="create")s(c,[...e(c),r]);else if(t.operation==="update")s(c,e(c).map(n=>n.id===r.id?r:n));else if(t.operation==="delete"){const n=r.id||r;s(c,e(c).filter(o=>o.id!==n))}}}function De(t){if(!e(a)||!e(c))return;const r=t.payload;if(e(c).some(o=>o.id===r.pool_id)){if(t.operation==="create")s(m,[...e(m),r]);else if(t.operation==="update")s(m,e(m).map(o=>o.id===r.id?r:o));else if(t.operation==="delete"){const o=r.id||r;s(m,e(m).filter(N=>N.id!==o))}}}ze(()=>{W().then(()=>{e(a)?.events?.length&&setTimeout(()=>{J()},100)});const t=R.subscribeToEntity("enterprise",["update","delete"],Ie),r=R.subscribeToEntity("pool",["create","update","delete"],we),n=R.subscribeToEntity("instance",["create","update","delete"],De);k=()=>{t(),r(),n()}}),Ge(()=>{k&&(k(),k=null)}),je(()=>V(),()=>{s($,V().params.id)}),Re(),Ne();var K=ct();Ve(t=>{G(()=>Je.title=`${e(a),l(()=>e(a)?`${e(a).name} - Enterprise Details`:"Enterprise Details")??""} - GARM`)});var U=B(K),L=u(U),O=u(L),H=u(O),Pe=u(H);f(H);var Q=d(H,2),X=u(Q),Y=d(u(X),2),Te=u(Y,!0);f(Y),f(X),f(Q),f(O),f(L);var Me=d(L,2);{var Ce=t=>{var r=it();E(t,r)},ke=t=>{var r=le(),n=B(r);{var o=b=>{var _=lt(),A=u(_),q=u(A,!0);f(A),f(_),G(()=>ie(q,e(P))),E(b,_)},N=b=>{var _=le(),A=B(_);{var q=z=>{var ae=dt(),re=B(ae);{let I=v(()=>(e(a),l(()=>e(a).name||"Enterprise"))),w=v(()=>(e(a),l(()=>e(a).endpoint?.name))),He=v(()=>(Oe(pe),l(()=>pe("github"))));st(re,{get title(){return e(I)},get subtitle(){return`Endpoint: ${e(w)??""} â€¢ GitHub Enterprise`},get forgeIcon(){return e(He)},onEdit:()=>s(T,!0),onDelete:()=>s(M,!0)})}var se=d(re,2);tt(se,{get entity(){return e(a)},entityType:"enterprise"});var ne=d(se,2);{let I=v(()=>(e(a),l(()=>e(a).id||""))),w=v(()=>(e(a),l(()=>e(a).name||"")));at(ne,{get pools(){return e(c)},entityType:"enterprise",get entityId(){return e(I)},get entityName(){return e(w)},$$events:{addPool:$e}})}var oe=d(ne,2);nt(oe,{get instances(){return e(m)},entityType:"enterprise",onDeleteInstance:Ee});var Le=d(oe,2);{let I=v(()=>(e(a),l(()=>e(a)?.events)));rt(Le,{get events(){return e(I)},get eventsContainer(){return e(h)},set eventsContainer(w){s(h,w)},$$legacy:!0})}E(z,ae)};g(A,z=>{e(a)&&z(q)},!0)}E(b,_)};g(n,b=>{e(P)?b(o):b(N,!1)},!0)}E(t,r)};g(Me,t=>{e(S)?t(Ce):t(ke,!1)})}f(U);var Z=d(U,2);{var Ae=t=>{et(t,{get entity(){return e(a)},entityType:"enterprise",$$events:{close:()=>s(T,!1),submit:r=>he(r.detail)}})};g(Z,t=>{e(T)&&e(a)&&t(Ae)})}var ee=d(Z,2);{var Be=t=>{ce(t,{title:"Delete Enterprise",message:"Are you sure you want to delete this enterprise? This action cannot be undone and will remove all associated pools and instances.",get itemName(){return e(a),l(()=>e(a).name)},$$events:{close:()=>s(M,!1),confirm:be}})};g(ee,t=>{e(M)&&e(a)&&t(Be)})}var te=d(ee,2);{var Fe=t=>{ce(t,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return e(p),l(()=>e(p).name)},$$events:{close:()=>{s(x,!1),s(p,null)},confirm:_e}})};g(te,t=>{e(x)&&e(p)&&t(Fe)})}var Se=d(te,2);{var Ue=t=>{{let r=v(()=>(e(a),l(()=>e(a).id||"")));ot(t,{initialEntityType:"enterprise",get initialEntityId(){return e(r)},$$events:{close:()=>s(C,!1),submit:xe}})}};g(Se,t=>{e(C)&&e(a)&&t(Ue)})}G(()=>{Ye(Pe,"href",`${j}/enterprises`),ie(Te,(e(a),l(()=>e(a)?e(a).name:"Loading...")))}),E(fe,K),We(),ge()}export{Tt as component};
