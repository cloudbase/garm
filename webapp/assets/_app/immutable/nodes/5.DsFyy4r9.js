import"../chunks/DsnmJJEf.js";import{i as Se}from"../chunks/De-I_rkH.js";import{p as Re,E as We,o as Be,l as w,k as r,m as l,g as e,h as He,f as M,s as o,d as n,r as i,b as C,t as N,e as X,y as Ce,u as b,z as Pe,w as Q,i as Me,c as Ue,A as Ve,a as ze,j as Ye,$ as Ke,q as A,v as re}from"../chunks/BIqNNOMq.js";import{a as Le,i as B,s as Ne}from"../chunks/CfI2BFUj.js";import{r as be,b as De,d as Te,c as Oe,g as ye}from"../chunks/CQh-7xkh.js";import{P as Qe}from"../chunks/Cq4AwQWc.js";import{e as Xe,i as Ze}from"../chunks/D8ZtP9JD.js";import{b as Ae,a as et}from"../chunks/Gs5uNKRr.js";import{p as tt}from"../chunks/CdEA5IGF.js";import{M as rt}from"../chunks/BFX8vI-4.js";import{e as se}from"../chunks/BZiHL9L3.js";import{e as je,a as xe}from"../chunks/B1uxuBYn.js";import{U as at}from"../chunks/CpPzJ1l1.js";import{D as st}from"../chunks/Db7N5hjl.js";import{t as ae}from"../chunks/DgRPqjXE.js";import{k as he,l as ot}from"../chunks/B7If18kh.js";import{B as nt}from"../chunks/CwE4al8R.js";import{D as it,G as lt,A as dt}from"../chunks/BjNB1vhO.js";import{A as Ge}from"../chunks/Dbr2TLcG.js";import{E as ct}from"../chunks/C6HeU_02.js";import{E as ut}from"../chunks/DFF0ZVx4.js";import{S as pt}from"../chunks/DCu5KXBe.js";var mt=M('<div class="mb-4 rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),gt=M('<div class="text-center py-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading...</p></div>'),vt=M("<option> </option>"),ft=M('<p class="mt-1 text-xs text-gray-600 dark:text-gray-400">Loading credentials...</p>'),bt=M('<p class="mt-1 text-xs text-red-600 dark:text-red-400">No GitHub credentials found. Please create GitHub credentials first.</p>'),yt=M(`<form class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Enterprise Name</label> <input id="name" type="text" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter enterprise name"/></div> <div><label for="credentials" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">GitHub Credentials</label> <select id="credentials" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Select GitHub credentials...</option><!></select> <!></div> <div><div class="flex items-center mb-1"><label for="pool_balancer_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Pool Balancer Type</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50"><div class="mb-2"><strong>Round Robin:</strong> Cycles through pools in turn. Job 1 → Pool 1, Job 2 → Pool 2, etc.</div> <div><strong>Pack:</strong> Uses first available pool until full, then moves to next pool.</div> <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="pool_balancer_type" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Round Robin</option><option>Pack</option></select></div> <div><div class="flex items-center mb-3"><input id="agent-mode" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="agent-mode" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Agent Mode</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">When enabled, runners will be installed with the GARM agent via userdata install templates. This allows for enhanced runner management and control. <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div></div> <div><label for="webhook_secret" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Webhook Secret</label> <input id="webhook_secret" type="password" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter webhook secret"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">You'll need to manually configure this secret in GitHub's enterprise webhook settings.</p></div> <div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 cursor-pointer">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"> </button></div></form>`),ht=M('<div class="max-w-2xl w-full p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Create Enterprise</h3> <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Enterprises are only available for GitHub endpoints.</p> <!> <!></div>');function xt(oe,ne){Re(ne,!1);const[ie,le]=Ne(),p=()=>Le(je,"$eagerCache",ie),G=l(),h=l(),m=l(),H=l(),E=We();let _=l(!1),y=l(""),a=l({name:"",credentials_name:"",webhook_secret:"",pool_balancer_type:"roundrobin",agent_mode:!1});async function x(){if(!p().loaded.credentials&&!p().loading.credentials)try{await xe.getCredentials()}catch(g){r(y,se(g))}}async function P(){if(!e(a).name||!e(a).name.trim()){r(y,"Enterprise name is required");return}if(!e(a).credentials_name){r(y,"Please select credentials");return}try{r(_,!0),r(y,"");const g={...e(a)};E("submit",g)}catch(g){r(y,se(g)),r(_,!1)}}Be(()=>{x()}),w(()=>p(),()=>{r(G,p().credentials)}),w(()=>p(),()=>{r(h,p().loading.credentials)}),w(()=>e(G),()=>{r(m,e(G).filter(g=>g.forge_type==="github"))}),w(()=>e(a),()=>{r(H,e(a).name&&e(a).name.trim()!==""&&e(a).credentials_name!==""&&e(a).webhook_secret&&e(a).webhook_secret.trim()!=="")}),He(),Se(),rt(oe,{$$events:{close:()=>E("close")},children:(g,j)=>{var D=ht(),d=o(n(D),4);{var de=v=>{var f=mt(),T=n(f),U=n(T,!0);i(T),i(f),N(()=>X(U,e(y))),C(v,f)};B(d,v=>{e(y)&&v(de)})}var ce=o(d,2);{var ue=v=>{var f=gt();C(v,f)},pe=v=>{var f=yt(),T=n(f),U=o(n(T),2);be(U),i(T);var q=o(T,2),z=o(n(q),2);N(()=>{e(a),Ce(()=>{e(m)})});var F=n(z);F.value=F.__value="";var me=o(F);Xe(me,1,()=>e(m),Ze,(s,c)=>{var k=vt(),R=n(k);i(k);var $={};N(()=>{X(R,`${e(c),b(()=>e(c).name)??""} (${e(c),b(()=>e(c).endpoint?.name||"Unknown endpoint")??""})`),$!==($=(e(c),b(()=>e(c).name)))&&(k.value=(k.__value=(e(c),b(()=>e(c).name)))??"")}),C(s,k)}),i(z);var ge=o(z,2);{var ve=s=>{var c=ft();C(s,c)},Z=s=>{var c=Ve(),k=ze(c);{var R=$=>{var O=bt();C($,O)};B(k,$=>{e(m),b(()=>e(m).length===0)&&$(R)},!0)}C(s,c)};B(ge,s=>{e(h)?s(ve):s(Z,!1)})}i(q);var S=o(q,2),L=o(n(S),2);N(()=>{e(a),Ce(()=>{})});var I=n(L);I.value=I.__value="roundrobin";var J=o(I);J.value=J.__value="pack",i(L),i(S);var W=o(S,2),V=n(W),ee=n(V);be(ee),Pe(4),i(V),i(W);var Y=o(W,2),te=o(n(Y),2);be(te),Pe(2),i(Y);var t=o(Y,2),u=n(t),K=o(u,2),fe=n(K,!0);i(K),i(t),i(f),N(()=>{K.disabled=(e(_),e(h),e(H),e(m),b(()=>e(_)||e(h)||!e(H)||e(m).length===0)),X(fe,e(_)?"Creating...":"Create Enterprise")}),Ae(U,()=>e(a).name,s=>Q(a,e(a).name=s)),De(z,()=>e(a).credentials_name,s=>Q(a,e(a).credentials_name=s)),De(L,()=>e(a).pool_balancer_type,s=>Q(a,e(a).pool_balancer_type=s)),et(ee,()=>e(a).agent_mode,s=>Q(a,e(a).agent_mode=s)),Ae(te,()=>e(a).webhook_secret,s=>Q(a,e(a).webhook_secret=s)),Me("click",u,()=>E("close")),Me("submit",f,tt(P)),C(v,f)};B(ce,v=>{e(_)?v(ue):v(pe,!1)})}i(D),C(g,D)},$$slots:{default:!0}}),Ue(),le()}var _t=M('<div class="flex items-center justify-between"><div class="flex-1 min-w-0"><a class="block"><p class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 truncate"> </p> <p class="text-sm text-gray-500 dark:text-gray-400 truncate mt-1"> </p></a></div> <div class="flex items-center space-x-3 ml-4"><!> <div class="flex space-x-2"><!> <!></div></div></div>'),kt=M('<div class="space-y-6"><!> <!></div> <!> <!> <!>',1);function Jt(oe,ne){Re(ne,!1);const[ie,le]=Ne(),p=()=>Le(je,"$eagerCache",ie),G=l(),h=l(),m=l(),H=l();let E=l([]),_=l(!0),y=l(""),a=l(""),x=l(1),P=l(25),g=l(!1),j=l(!1),D=l(!1),d=l(null);async function de(t){try{r(y,""),await ye.createEnterprise(t),ae.success("Enterprise Created",`Enterprise ${t.name} has been created successfully.`),r(g,!1)}catch(u){throw r(y,se(u)),u}}async function ce(t){if(e(d))try{await ye.updateEnterprise(e(d).id,t),ae.success("Enterprise Updated",`Enterprise ${e(d).name} has been updated successfully.`),r(j,!1),r(d,null)}catch(u){throw u}}async function ue(){if(e(d))try{r(y,""),await ye.deleteEnterprise(e(d).id),ae.success("Enterprise Deleted",`Enterprise ${e(d).name} has been deleted successfully.`),r(D,!1),r(d,null)}catch(t){const u=se(t);ae.error("Delete Failed",u)}}function pe(){r(g,!0)}function v(t){r(d,t),r(j,!0)}function f(t){r(d,t),r(D,!0)}Be(async()=>{try{r(_,!0);const t=await xe.getEnterprises();t&&Array.isArray(t)&&r(E,t)}catch(t){console.error("Failed to load enterprises:",t),r(y,t instanceof Error?t.message:"Failed to load enterprises")}finally{r(_,!1)}});async function T(){try{await xe.retryResource("enterprises")}catch(t){console.error("Retry failed:",t)}}const U=[{key:"name",title:"Name",cellComponent:ct,cellProps:{entityType:"enterprise"}},{key:"endpoint",title:"Endpoint",cellComponent:ut},{key:"credentials",title:"Credentials",cellComponent:lt,cellProps:{field:"credentials_name"}},{key:"status",title:"Status",cellComponent:pt,cellProps:{statusType:"entity"}},{key:"actions",title:"Actions",align:"right",cellComponent:dt}],q={entityType:"enterprise",primaryText:{field:"name",isClickable:!0,href:"/enterprises/{id}"},secondaryText:{field:"credentials_name"},badges:[{type:"custom",value:t=>he(t)}],actions:[{type:"edit",handler:t=>v(t)},{type:"delete",handler:t=>f(t)}]};function z(t){r(a,t.detail.term),r(x,1)}function F(t){r(x,t.detail.page)}function me(t){r(P,t.detail.perPage),r(x,1)}function ge(t){v(t.detail.item)}function ve(t){f(t.detail.item)}w(()=>(e(E),p()),()=>{(!e(E).length||p().loaded.enterprises)&&r(E,p().enterprises)}),w(()=>p(),()=>{r(_,p().loading.enterprises)}),w(()=>p(),()=>{r(G,p().errorMessages.enterprises)}),w(()=>(e(E),e(a)),()=>{r(h,ot(e(E),e(a)))}),w(()=>(e(h),e(P)),()=>{r(m,Math.ceil(e(h).length/e(P)))}),w(()=>(e(x),e(m)),()=>{e(x)>e(m)&&e(m)>0&&r(x,e(m))}),w(()=>(e(h),e(x),e(P)),()=>{r(H,e(h).slice((e(x)-1)*e(P),e(x)*e(P)))}),He(),Se();var Z=kt();Ye(t=>{Ke.title="Enterprises - GARM"});var S=ze(Z),L=n(S);Qe(L,{title:"Enterprises",description:"Manage GitHub enterprises",actionLabel:"Add Enterprise",$$events:{action:pe}});var I=o(L,2);{let t=re(()=>e(G)||e(y)),u=re(()=>!!e(G));it(I,{get columns(){return U},get data(){return e(H)},get loading(){return e(_)},get error(){return e(t)},get searchTerm(){return e(a)},searchPlaceholder:"Search enterprises...",get currentPage(){return e(x)},get perPage(){return e(P)},get totalPages(){return e(m)},get totalItems(){return e(h),b(()=>e(h).length)},itemName:"enterprises",emptyIconType:"building",get showRetry(){return e(u)},get mobileCardConfig(){return q},$$events:{search:z,pageChange:F,perPageChange:me,retry:T,edit:ge,delete:ve},$$slots:{"mobile-card":(K,fe)=>{const s=re(()=>fe.item),c=re(()=>(A(he),A(e(s)),b(()=>he(e(s)))));var k=_t(),R=n(k),$=n(R),O=n($),qe=n(O,!0);i(O);var _e=o(O,2),Fe=n(_e,!0);i(_e),i($),i(R);var ke=o(R,2),we=n(ke);nt(we,{get variant(){return A(e(c)),b(()=>e(c).variant)},get text(){return A(e(c)),b(()=>e(c).text)}});var Ee=o(we,2),$e=n(Ee);Ge($e,{action:"edit",size:"sm",title:"Edit enterprise",ariaLabel:"Edit enterprise",$$events:{click:()=>v(e(s))}});var Ie=o($e,2);Ge(Ie,{action:"delete",size:"sm",title:"Delete enterprise",ariaLabel:"Delete enterprise",$$events:{click:()=>f(e(s))}}),i(Ee),i(ke),i(k),N(Je=>{Oe($,"href",Je),X(qe,(A(e(s)),b(()=>e(s).name))),X(Fe,(A(e(s)),b(()=>e(s).credentials_name)))},[()=>(A(Te),A(e(s)),b(()=>Te(`/enterprises/${e(s).id}`)))]),C(K,k)}}})}i(S);var J=o(S,2);{var W=t=>{xt(t,{$$events:{close:()=>r(g,!1),submit:u=>de(u.detail)}})};B(J,t=>{e(g)&&t(W)})}var V=o(J,2);{var ee=t=>{at(t,{get entity(){return e(d)},entityType:"enterprise",$$events:{close:()=>{r(j,!1),r(d,null)},submit:u=>ce(u.detail)}})};B(V,t=>{e(j)&&e(d)&&t(ee)})}var Y=o(V,2);{var te=t=>{st(t,{title:"Delete Enterprise",message:"Are you sure you want to delete this enterprise? This action cannot be undone.",get itemName(){return e(d),b(()=>e(d).name)},$$events:{close:()=>{r(D,!1),r(d,null)},confirm:ue}})};B(Y,t=>{e(D)&&e(d)&&t(te)})}C(oe,Z),Ue(),le()}export{Jt as component};
