import{c as Qe,a as W,h as Xe,b as T,l as Ye,s as ve,f as H,d as ye}from"../chunks/CxOx-TIJ.js";import{i as Ze}from"../chunks/3NxSoY2_.js";import{p as et,o as tt,x as ot,l as at,b as rt,f as L,d as i,t as Q,a as nt,s as p,g as e,m as u,u as l,h as ge,F as P,c as v,j as r,$ as st,r as y,e as g,n as E,k as it,i as c}from"../chunks/DzFKsO_V.js";import{s as lt,a as ct,i as $,v as dt}from"../chunks/B_jyf0qs.js";import{c as N,d as pt,g as b}from"../chunks/BguOOs3x.js";import{p as he}from"../chunks/DgabA6iF.js";import{g as _e}from"../chunks/BzzAh3Be.js";import{U as ut}from"../chunks/B8GNZv7s.js";import{D as $e}from"../chunks/DL1RlOO9.js";import{E as mt,P as ft,a as vt}from"../chunks/Cfss7k9J.js";import{D as yt}from"../chunks/BLYRAgBX.js";import{g as be}from"../chunks/JkzpcrZD.js";import{e as B}from"../chunks/BZiHL9L3.js";import{I as gt}from"../chunks/CzarUgpd.js";import{W as ht}from"../chunks/DMKMpIvH.js";import{C as _t}from"../chunks/BBvIKVJT.js";import{w as X}from"../chunks/DSHGoHxX.js";import{t as D}from"../chunks/li_-Mkq2.js";n[P]="src/routes/repositories/[id]/+page.svelte";var $t=W(H('<div class="p-6 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading repository...</p></div>'),n[P],[[320,2,[[321,3],[322,3]]]]),bt=W(H('<div class="rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),n[P],[[325,2,[[326,3]]]]),xt=W(H("<!> <!> <!> <!> <!> <!>",1),n[P],[]),wt=W(H('<div class="space-y-6"><nav class="flex" aria-label="Breadcrumb"><ol class="inline-flex items-center space-x-1 md:space-x-3"><li class="inline-flex items-center"><a class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white"><svg class="w-3 h-3 mr-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg> Repositories</a></li> <li><div class="flex items-center"><svg class="w-3 h-3 text-gray-400 mx-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg> <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400"> </span></div></li></ol></nav> <!></div> <!> <!> <!> <!>',1),n[P],[[294,0,[[296,1,[[297,2,[[298,3,[[299,4,[[300,5,[[301,6]]]]]]],[306,3,[[307,4,[[308,5,[[309,6]]],[311,5]]]]]]]]]]]]);function n(xe,we){Qe(new.target),et(we,!1,n);const[Ie,Te]=lt(),Y=()=>(dt(he,"page"),ct(he,"$page",Ie)),R=u();let t=u(null),m=u([]),h=u([]),q=u(!0),k=u(""),C=u(!1),S=u(!1),M=u(!1),A=u(!1),f=u(null),F=null,x=u();async function Z(){if(e(R))try{r(q,!0),r(k,"");const[o,a,s]=(await E(Promise.all([b.getRepository(e(R)),b.listRepositoryPools(e(R)).catch(()=>[]),b.listRepositoryInstances(e(R)).catch(()=>[])])))();r(t,o),r(m,a),r(h,s)}catch(o){r(k,B(o))}finally{r(q,!1)}}function Ee(o,a){const{events:s}=o;return{...a,events:s}}async function De(o){if(e(t))try{(await E(b.updateRepository(e(t).id,o)))(),(await E(Z()))(),D.success("Repository Updated",`Repository ${e(t).owner}/${e(t).name} has been updated successfully.`),r(C,!1)}catch(a){throw a}}async function Re(){if(e(t)){try{(await E(b.deleteRepository(e(t).id)))(),_e(N("/repositories"))}catch(o){const a=B(o);D.error("Delete Failed",a)}r(S,!1)}}async function Me(){if(e(f))try{(await E(b.deleteInstance(e(f).name)))(),D.success("Instance Deleted",`Instance ${e(f).name} has been deleted successfully.`),r(M,!1),r(f,null)}catch(o){const a=B(o);D.error("Delete Failed",a),r(M,!1),r(f,null)}}function Pe(o){r(f,o),r(M,!0)}function ke(){r(A,!0)}async function Ce(o){try{if(!e(t))return;(await E(b.createRepositoryPool(e(t).id,o.detail)))(),D.success("Pool Created",`Pool has been created successfully for repository ${e(t).owner}/${e(t).name}.`),r(A,!1)}catch(a){const s=B(a);D.error("Pool Creation Failed",s)}}function ee(){e(x)&&it(x,e(x).scrollTop=e(x).scrollHeight)}function Se(o){if(c(o.operation,"update")){const a=o.payload;if(e(t)&&c(a.id,e(t).id)){const s=e(t).events?.length||0,d=a.events?.length||0;r(t,Ee(e(t),a)),d>s&&setTimeout(()=>{ee()},100)}}else if(c(o.operation,"delete")){const a=o.payload.id||o.payload;e(t)&&c(e(t).id,a)&&_e(N("/repositories"))}}function Ae(o){if(!e(t))return;const a=o.payload;if(!c(a.repo_id,e(t).id,!1)){if(c(o.operation,"create"))r(m,[...e(m),a]);else if(c(o.operation,"update"))r(m,e(m).map(s=>c(s.id,a.id)?a:s));else if(c(o.operation,"delete")){const s=a.id||a;r(m,e(m).filter(d=>c(d.id,s,!1)))}}}function Fe(o){if(!e(t)||!e(m))return;const a=o.payload;if(e(m).some(d=>c(d.id,a.pool_id))){if(c(o.operation,"create"))r(h,[...e(h),a]);else if(c(o.operation,"update"))r(h,e(h).map(d=>c(d.id,a.id)?a:d));else if(c(o.operation,"delete")){const d=a.id||a;r(h,e(h).filter(O=>c(O.id,d,!1)))}}}tt(()=>{Z().then(()=>{e(t)?.events?.length&&setTimeout(()=>{ee()},100)});const o=X.subscribeToEntity("repository",["update","delete"],Se),a=X.subscribeToEntity("pool",["create","update","delete"],Ae),s=X.subscribeToEntity("instance",["create","update","delete"],Fe);F=()=>{o(),a(),s()}}),ot(()=>{F&&(F(),F=null)}),at(()=>Y(),()=>{r(R,Y().params.id)}),rt(),Ze();var te=wt();Xe(o=>{Q(()=>st.title=`${e(t),l(()=>e(t)?`${e(t).name} - Repository Details`:"Repository Details")??""} - GARM`)});var z=L(te),j=v(z),oe=v(j),G=v(oe),Ue=v(G);y(G);var ae=p(G,2),re=v(ae),ne=p(v(re),2),Le=v(ne,!0);y(ne),y(re),y(ae),y(oe),y(j);var Ne=p(j,2);{var Be=o=>{var a=$t();T(o,a)},We=o=>{var a=ye(),s=L(a);{var d=w=>{var I=bt(),U=v(I),V=v(U,!0);y(U),y(I),Q(()=>ve(V,e(k))),T(w,I)},O=w=>{var I=ye(),U=L(I);{var V=J=>{var ce=xt(),de=L(ce);{let _=g(()=>(e(t),l(()=>e(t).name||"Repository"))),K=g(()=>(e(t),l(()=>e(t).owner))),Je=g(()=>(e(t),l(()=>e(t).endpoint?.name))),Ke=g(()=>(ge(be),e(t),l(()=>be(e(t).endpoint?.endpoint_type||"unknown"))));i(()=>yt(de,{get title(){return e(_)},get subtitle(){return`Owner: ${e(K)??""} â€¢ Endpoint: ${e(Je)??""}`},get forgeIcon(){return e(Ke)},onEdit:()=>r(C,!0),onDelete:()=>r(S,!0)}),"component",n,330,2,{componentTag:"DetailHeader"})}var pe=p(de,2);i(()=>mt(pe,{get entity(){return e(t)},entityType:"repository"}),"component",n,339,2,{componentTag:"EntityInformation"});var ue=p(pe,2);{let _=g(()=>(e(t),l(()=>e(t).id||"")));i(()=>ht(ue,{entityType:"repository",get entityId(){return e(_)},get entityName(){return`${e(t),l(()=>e(t).owner)??""}/${e(t),l(()=>e(t).name)??""}`}}),"component",n,342,2,{componentTag:"WebhookSection"})}var me=p(ue,2);{let _=g(()=>(e(t),l(()=>e(t).id||"")));i(()=>ft(me,{get pools(){return e(m)},entityType:"repository",get entityId(){return e(_)},get entityName(){return`${e(t),l(()=>e(t).owner)??""}/${e(t),l(()=>e(t).name)??""}`},$$events:{addPool:ke}}),"component",n,349,2,{componentTag:"PoolsSection"})}var fe=p(me,2);i(()=>gt(fe,{get instances(){return e(h)},entityType:"repository",onDeleteInstance:Pe}),"component",n,358,2,{componentTag:"InstancesSection"});var Ve=p(fe,2);{let _=g(()=>(e(t),l(()=>e(t)?.events)));i(()=>vt(Ve,{get events(){return e(_)},get eventsContainer(){return e(x)},set eventsContainer(K){r(x,K)},$$legacy:!0}),"component",n,361,2,{componentTag:"EventsSection"})}T(J,ce)};i(()=>$(U,J=>{e(t)&&J(V)},!0),"if",n,328,1)}T(w,I)};i(()=>$(s,w=>{e(k)?w(d):w(O,!1)},!0),"if",n,324,1)}T(o,a)};i(()=>$(Ne,o=>{e(q)?o(Be):o(We,!1)}),"if",n,319,1)}y(z);var se=p(z,2);{var He=o=>{i(()=>ut(o,{get entity(){return e(t)},entityType:"repository",$$events:{close:()=>r(C,!1),submit:a=>De(a.detail)}}),"component",n,367,1,{componentTag:"UpdateEntityModal"})};i(()=>$(se,o=>{e(C)&&e(t)&&o(He)}),"if",n,366,0)}var ie=p(se,2);{var qe=o=>{{let a=g(()=>(e(t),l(()=>`${e(t).owner}/${e(t).name}`)));i(()=>$e(o,{title:"Delete Repository",message:"Are you sure you want to delete this repository? This action cannot be undone and will remove all associated pools and instances.",get itemName(){return e(a)},$$events:{close:()=>r(S,!1),confirm:Re}}),"component",n,376,1,{componentTag:"DeleteModal"})}};i(()=>$(ie,o=>{e(S)&&e(t)&&o(qe)}),"if",n,375,0)}var le=p(ie,2);{var ze=o=>{i(()=>$e(o,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return e(f),l(()=>e(f).name)},$$events:{close:()=>{r(M,!1),r(f,null)},confirm:Me}}),"component",n,386,1,{componentTag:"DeleteModal"})};i(()=>$(le,o=>{e(M)&&e(f)&&o(ze)}),"if",n,385,0)}var je=p(le,2);{var Ge=o=>{{let a=g(()=>(e(t),l(()=>e(t).id||"")));i(()=>_t(o,{initialEntityType:"repository",get initialEntityId(){return e(a)},$$events:{close:()=>r(A,!1),submit:Ce}}),"component",n,396,1,{componentTag:"CreatePoolModal"})}};i(()=>$(je,o=>{e(A)&&e(t)&&o(Ge)}),"if",n,395,0)}Q(o=>{pt(Ue,"href",o),ve(Le,(e(t),l(()=>e(t)?e(t).name:"Loading...")))},[()=>(ge(N),l(()=>N("/repositories")))]),T(xe,te);var Oe=nt({...Ye()});return Te(),Oe}export{n as component};
