import{f as S,a as D,s as ye,e as ve,h as Oe}from"../chunks/o8CdT7B0.js";import{i as Se}from"../chunks/ChJfoPF0.js";import{p as Ae,v as He,o as Fe,l as w,d as r,m as a,g as e,j as $,b as Ie,s as i,c as d,r as c,t as X,k as Te,u as j,n as he,a as We,f as Je,$ as Ve,i as Ee}from"../chunks/DUMcBckj.js";import{a as Ue,i as Y,s as qe}from"../chunks/i7pKks78.js";import{r as J,b as De,g as oe}from"../chunks/By1mMPic.js";import{e as Ye,i as Ke}from"../chunks/DC7Aeygn.js";import{b as _e,a as we}from"../chunks/BtzOUN4g.js";import{p as Qe}from"../chunks/CdEA5IGF.js";import{M as Xe}from"../chunks/bEwPjd5X.js";import{e as ae}from"../chunks/BZiHL9L3.js";import{F as Ze}from"../chunks/ChSxBtxh.js";import{e as je,a as xe}from"../chunks/B-DY0PIj.js";import{U as et}from"../chunks/B9DcaIeA.js";import{D as tt}from"../chunks/BRJHWEKY.js";import{P as rt}from"../chunks/BlNwQDlv.js";import{t as V}from"../chunks/Bbk4dQfI.js";import{k as ot,g as at,c as st,m as nt,p as it}from"../chunks/BPOuWaSt.js";import{D as lt,G as dt,A as ct}from"../chunks/feAEhHKM.js";import{E as ut}from"../chunks/D8XSG0sn.js";import{E as pt}from"../chunks/BfsHCb9g.js";import{S as mt}from"../chunks/QVHDSiOj.js";import"../chunks/BDMj7wjI.js";var gt=S('<div class="mb-4 rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),bt=S('<div class="text-center py-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading...</p></div>'),ft=S("<option> </option>"),yt=S('<input type="password" class="block w-full px-3 py-2 mt-3 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter webhook secret"/>'),vt=S('<p class="text-sm text-gray-500 dark:text-gray-400">Webhook secret will be automatically generated</p>'),ht=S('<form class="space-y-4"><!> <div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Repository Name</label> <input id="name" type="text" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter repository name"/></div> <div><label for="owner" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Repository Owner</label> <input id="owner" type="text" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter repository owner"/></div> <div><label for="credentials" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Credentials</label> <select id="credentials" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Select credentials...</option><!></select></div> <div><div class="flex items-center mb-1"><label for="pool_balancer_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Pool Balancer Type</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50"><div class="mb-2"><strong>Round Robin:</strong> Cycles through pools in turn. Job 1 → Pool 1, Job 2 → Pool 2, etc.</div> <div><strong>Pack:</strong> Uses first available pool until full, then moves to next pool.</div> <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="pool_balancer_type" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Round Robin</option><option>Pack</option></select></div> <div><div class="flex items-center mb-3"><input id="agent-mode" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="agent-mode" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Agent Mode</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">When enabled, runners will be installed with the GARM agent via userdata install templates. This allows for enhanced runner management and control. <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div></div> <div><div class="flex items-center mb-3"><input id="install-webhook" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="install-webhook" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Install Webhook</label></div> <div class="space-y-3"><div class="flex items-center"><input id="generate-webhook-secret" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="generate-webhook-secret" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Auto-generate webhook secret</label></div> <!></div></div> <div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 cursor-pointer">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"> </button></div></form>'),_t=S('<div class="max-w-2xl w-full p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Create Repository</h3> <!> <!></div>');function wt(se,ne){Ae(ne,!1);const[ie,le]=qe(),p=()=>Ue(je,"$eagerCache",ie),C=a(),x=a(),G=a(),R=a(),P=He();let y=a(!1),g=a(""),b=a("github"),o=a({name:"",owner:"",credentials_name:"",webhook_secret:"",pool_balancer_type:"roundrobin",agent_mode:!1}),A=a(!0),u=a(!0);async function f(){if(!p().loaded.credentials&&!p().loading.credentials)try{await xe.getCredentials()}catch(l){r(g,ae(l))}}function _(l){r(b,l.detail),$(o,e(o).credentials_name="")}function M(){if(e(o).credentials_name){const l=e(C).find(F=>F.name===e(o).credentials_name);l&&l.forge_type&&r(b,l.forge_type)}}function T(){const l=new Uint8Array(32);return crypto.getRandomValues(l),Array.from(l,F=>F.toString(16).padStart(2,"0")).join("")}Fe(()=>{f()});async function de(){if(!e(o).name?.trim()){r(g,"Repository name is required");return}if(!e(o).owner?.trim()){r(g,"Repository owner is required");return}if(!e(o).credentials_name){r(g,"Please select credentials");return}try{r(y,!0),r(g,"");const l={...e(o),install_webhook:e(A),auto_generate_secret:e(u)};P("submit",l)}catch(l){r(g,ae(l)),r(y,!1)}}w(()=>p(),()=>{r(C,p().credentials)}),w(()=>p(),()=>{r(x,p().loading.credentials)}),w(()=>(e(C),e(b)),()=>{r(G,e(C).filter(l=>e(b)?l.forge_type===e(b):!0))}),w(()=>e(u),()=>{e(u)?$(o,e(o).webhook_secret=T()):e(u)||$(o,e(o).webhook_secret="")}),w(()=>(e(o),e(u)),()=>{r(R,e(o).name?.trim()!==""&&e(o).owner?.trim()!==""&&e(o).credentials_name!==""&&(e(u)||e(o).webhook_secret?.trim()!==""))}),Ie(),Se(),Xe(se,{$$events:{close:()=>P("close")},children:(l,F)=>{var E=_t(),Z=i(d(E),2);{var ce=v=>{var h=gt(),I=d(h),W=d(I,!0);c(I),c(h),X(()=>ye(W,e(g))),D(v,h)};Y(Z,v=>{e(g)&&v(ce)})}var ue=i(Z,2);{var pe=v=>{var h=bt();D(v,h)},me=v=>{var h=ht(),I=d(h);Ze(I,{get selectedForgeType(){return e(b)},set selectedForgeType(s){r(b,s)},$$events:{select:_},$$legacy:!0});var W=i(I,2),ee=i(d(W),2);J(ee),c(W);var z=i(W,2),B=i(d(z),2);J(B),c(z);var L=i(z,2),N=i(d(L),2);X(()=>{e(o),Te(()=>{e(G)})});var O=d(N);O.value=O.__value="";var ge=i(O);Ye(ge,1,()=>e(G),Ke,(s,m)=>{var q=ft(),Ne=d(q);c(q);var Me={};X(()=>{ye(Ne,`${e(m),j(()=>e(m).name)??""} (${e(m),j(()=>e(m).endpoint?.name)??""})`),Me!==(Me=(e(m),j(()=>e(m).name)))&&(q.value=(q.__value=(e(m),j(()=>e(m).name)))??"")}),D(s,q)}),c(N),c(L);var H=i(L,2),K=i(d(H),2);X(()=>{e(o),Te(()=>{})});var Q=d(K);Q.value=Q.__value="roundrobin";var te=i(Q);te.value=te.__value="pack",c(K),c(H);var t=i(H,2),n=d(t),re=d(n);J(re),he(4),c(n),c(t);var k=i(t,2),U=d(k),ke=d(U);J(ke),he(2),c(U);var Re=i(U,2),be=d(Re),$e=d(be);J($e),he(2),c(be);var Ge=i(be,2);{var ze=s=>{var m=yt();J(m),_e(m,()=>e(o).webhook_secret,q=>$(o,e(o).webhook_secret=q)),D(s,m)},Be=s=>{var m=vt();D(s,m)};Y(Ge,s=>{e(u)?s(Be,!1):s(ze)})}c(Re),c(k);var Ce=i(k,2),Pe=d(Ce),fe=i(Pe,2),Le=d(fe,!0);c(fe),c(Ce),c(h),X(()=>{fe.disabled=e(y)||e(x)||!e(R),ye(Le,e(y)?"Creating...":"Create Repository")}),_e(ee,()=>e(o).name,s=>$(o,e(o).name=s)),_e(B,()=>e(o).owner,s=>$(o,e(o).owner=s)),De(N,()=>e(o).credentials_name,s=>$(o,e(o).credentials_name=s)),ve("change",N,M),De(K,()=>e(o).pool_balancer_type,s=>$(o,e(o).pool_balancer_type=s)),we(re,()=>e(o).agent_mode,s=>$(o,e(o).agent_mode=s)),we(ke,()=>e(A),s=>r(A,s)),we($e,()=>e(u),s=>r(u,s)),ve("click",Pe,()=>P("close")),ve("submit",h,Qe(de)),D(v,h)};Y(ue,v=>{e(y)?v(pe):v(me,!1)})}c(E),D(l,E)},$$slots:{default:!0}}),We(),le()}var xt=S('<div class="space-y-6"><!> <!></div> <!> <!> <!>',1);function Ot(se,ne){Ae(ne,!1);const[ie,le]=qe(),p=()=>Ue(je,"$eagerCache",ie),C=a(),x=a(),G=a();let R=a([]),P=a(!0),y=a(""),g=a(""),b=a(!1),o=a(!1),A=a(!1),u=a(null),f=a(null),_=a(1),M=a(25),T=a(1);Fe(async()=>{try{r(P,!0);const t=await xe.getRepositories();t&&Array.isArray(t)&&r(R,t)}catch(t){console.error("Failed to load repositories:",t),r(y,t instanceof Error?t.message:"Failed to load repositories")}finally{r(P,!1)}});async function de(){try{await xe.retryResource("repositories")}catch(t){console.error("Retry failed:",t)}}function l(t){r(u,t),r(o,!0)}function F(t){r(f,t),r(A,!0)}function E(){r(b,!1),r(o,!1),r(A,!1),r(u,null),r(f,null),r(y,"")}async function Z(t){try{r(y,"");const n=t.detail,re={name:n.name,owner:n.owner,credentials_name:n.credentials_name,webhook_secret:n.webhook_secret},k=await oe.createRepository(re);if(n.install_webhook&&k.id)try{await oe.installRepoWebhook(k.id),V.success("Webhook Installed",`Webhook for repository ${k.owner}/${k.name} has been installed successfully.`)}catch(U){console.warn("Repository created but webhook installation failed:",U),V.error("Webhook Installation Failed",U instanceof Error?U.message:"Failed to install webhook. You can try installing it manually from the repository details page.")}r(b,!1),V.success("Repository Created",`Repository ${k.owner}/${k.name} has been created successfully.`)}catch(n){throw r(y,ae(n)),n}}async function ce(t){if(e(u))try{await oe.updateRepository(e(u).id,t),V.success("Repository Updated",`Repository ${e(u).owner}/${e(u).name} has been updated successfully.`),E()}catch(n){throw n}}async function ue(){if(e(f))try{r(y,""),await oe.deleteRepository(e(f).id),V.success("Repository Deleted",`Repository ${e(f).owner}/${e(f).name} has been deleted successfully.`)}catch(t){const n=ae(t);V.error("Delete Failed",n)}finally{E()}}const pe=[{key:"repository",title:"Repository",cellComponent:ut,cellProps:{entityType:"repository",showOwner:!0}},{key:"endpoint",title:"Endpoint",cellComponent:pt},{key:"credentials",title:"Credentials",cellComponent:dt,cellProps:{field:"credentials_name"}},{key:"status",title:"Status",cellComponent:mt,cellProps:{statusType:"entity"}},{key:"actions",title:"Actions",align:"right",cellComponent:ct}],me={entityType:"repository",primaryText:{field:"name",isClickable:!0,href:"/repositories/{id}",showOwner:!0},customInfo:[{icon:t=>at(t?.endpoint?.endpoint_type||"unknown"),text:t=>t?.endpoint?.name||"Unknown"}],badges:[{type:"custom",value:t=>ot(t)}],actions:[{type:"edit",handler:t=>l(t)},{type:"delete",handler:t=>F(t)}]};function v(t){r(g,t.detail.term),r(_,1)}function h(t){r(_,t.detail.page)}function I(t){const n=st(t.detail.perPage);r(M,n.newPerPage),r(_,n.newCurrentPage)}function W(t){l(t.detail.item)}function ee(t){F(t.detail.item)}w(()=>(e(R),p()),()=>{(!e(R).length||p().loaded.repositories)&&r(R,p().repositories)}),w(()=>p(),()=>{r(P,p().loading.repositories)}),w(()=>p(),()=>{r(C,p().errorMessages.repositories)}),w(()=>(e(R),e(g)),()=>{r(x,nt(e(R),e(g)))}),w(()=>(e(T),e(x),e(M),e(_)),()=>{r(T,Math.ceil(e(x).length/e(M))),e(_)>e(T)&&e(T)>0&&r(_,e(T))}),w(()=>(e(x),e(_),e(M)),()=>{r(G,it(e(x),e(_),e(M)))}),Ie(),Se();var z=xt();Oe(t=>{Ve.title="Repositories - GARM"});var B=Je(z),L=d(B);rt(L,{title:"Repositories",description:"Manage your GitHub repositories and their runners",actionLabel:"Add Repository",$$events:{action:()=>{r(b,!0)}}});var N=i(L,2);{let t=Ee(()=>e(C)||e(y)),n=Ee(()=>!!e(C));lt(N,{get columns(){return pe},get data(){return e(G)},get loading(){return e(P)},get error(){return e(t)},get searchTerm(){return e(g)},searchPlaceholder:"Search repositories by name or owner...",get currentPage(){return e(_)},get perPage(){return e(M)},get totalPages(){return e(T)},get totalItems(){return e(x),j(()=>e(x).length)},itemName:"repositories",emptyIconType:"building",get showRetry(){return e(n)},get mobileCardConfig(){return me},$$events:{search:v,pageChange:h,perPageChange:I,retry:de,edit:W,delete:ee}})}c(B);var O=i(B,2);{var ge=t=>{wt(t,{$$events:{close:()=>r(b,!1),submit:Z}})};Y(O,t=>{e(b)&&t(ge)})}var H=i(O,2);{var K=t=>{et(t,{get entity(){return e(u)},entityType:"repository",$$events:{close:E,submit:n=>ce(n.detail)}})};Y(H,t=>{e(o)&&e(u)&&t(K)})}var Q=i(H,2);{var te=t=>{tt(t,{title:"Delete Repository",message:"Are you sure you want to delete this repository? This action cannot be undone and will remove all associated pools and runners.",get itemName(){return`${e(f),j(()=>e(f).owner)??""}/${e(f),j(()=>e(f).name)??""}`},$$events:{close:E,confirm:ue}})};Y(Q,t=>{e(A)&&e(f)&&t(te)})}D(se,z),We(),le()}export{Ot as component};
