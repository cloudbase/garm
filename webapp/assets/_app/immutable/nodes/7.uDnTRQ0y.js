import"../chunks/DsnmJJEf.js";import{i as Ze}from"../chunks/De-I_rkH.js";import{p as er,o as rr,l as q,h as ar,f as v,j as tr,t as de,g as e,i as dr,b as n,c as lr,m as i,$ as sr,d as a,u,q as Re,s as d,k as s,r as t,z as C,C as or,a as ir,D as nr,e as Ae,v as cr}from"../chunks/BIqNNOMq.js";import{i as p,s as vr,a as mr}from"../chunks/CfI2BFUj.js";import{B as Pe,d as _,c as qe,s as j,r as w}from"../chunks/CQh-7xkh.js";import{b as U}from"../chunks/Gs5uNKRr.js";import{p as ur}from"../chunks/CdEA5IGF.js";import{g as le}from"../chunks/BSYpqPvJ.js";import{a as pr,b as gr}from"../chunks/Cx8owuas.js";import{t as br}from"../chunks/DgRPqjXE.js";import{e as fr}from"../chunks/BZiHL9L3.js";var xr=v('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Username is required</p>'),hr=v('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Please enter a valid email address</p>'),yr=v('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Full name is required</p>'),kr=v('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Password must be at least 8 characters long</p>'),_r=v('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Passwords do not match</p>'),wr=or('<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> Advanced Configuration (Optional)',1),Ur=v('<div class="mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-md border border-gray-200 dark:border-gray-600"><div class="space-y-4"><div><label for="metadataUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Metadata URL</label> <div class="mt-1"><input id="metadataUrl" name="metadataUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/api/v1/metadata"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where runners can fetch metadata and setup information.</p></div></div> <div><label for="callbackUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Callback URL</label> <div class="mt-1"><input id="callbackUrl" name="callbackUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/api/v1/callbacks"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where runners send status updates and lifecycle events.</p></div></div> <div><label for="webhookUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Webhook URL</label> <div class="mt-1"><input id="webhookUrl" name="webhookUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/webhooks"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where GitHub/Gitea will send webhook events for job notifications.</p></div></div> <div><label for="agentUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Agent URL</label> <div class="mt-1"><input id="agentUrl" name="agentUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/agent"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where GARM agents will connect. Must allow websocket connections.</p></div></div></div></div>'),$r=v("<li>Enter a username</li>"),zr=v("<li>Enter a valid email address</li>"),Mr=v("<li>Enter your full name</li>"),Rr=v("<li>Enter a password with at least 8 characters</li>"),Ar=v("<li>Confirm your password</li>"),Pr=v('<div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Please complete all required fields</h3> <div class="mt-2 text-sm text-yellow-700 dark:text-yellow-300"><ul class="list-disc list-inside space-y-1"><!> <!> <!> <!> <!></ul></div></div></div></div>'),qr=v('<div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><p class="text-sm text-red-800 dark:text-red-200"> </p></div></div></div>'),Cr=v('<div class="min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col justify-center py-12 sm:px-6 lg:px-8"><div class="sm:mx-auto sm:w-full sm:max-w-md"><div class="flex justify-center"><img alt="GARM" class="h-16 w-auto dark:hidden"/> <img alt="GARM" class="h-16 w-auto hidden dark:block"/></div> <h1 class="mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white">Welcome to GARM</h1> <p class="mt-2 text-center text-sm text-gray-600 dark:text-gray-400">Complete the first-run setup to get started</p></div> <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md"><div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 mb-6"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">First-Run Initialization</h3> <div class="mt-2 text-sm text-blue-700 dark:text-blue-300"><p>GARM needs to be initialized before first use. This will create the admin user and generate a unique controller ID for this installation.</p></div></div></div></div> <div class="bg-white dark:bg-gray-800 py-8 px-4 shadow sm:rounded-lg sm:px-10"><form class="space-y-6"><div><label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Username</label> <div class="mt-1"><input id="username" name="username" type="text" required placeholder="Enter admin username"/> <!></div></div> <div><label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email Address</label> <div class="mt-1"><input id="email" name="email" type="email" required placeholder="admin@example.com"/> <!></div></div> <div><label for="fullName" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Full Name</label> <div class="mt-1"><input id="fullName" name="fullName" type="text" required placeholder="Enter full name"/> <!></div></div> <div><label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label> <div class="mt-1"><input id="password" name="password" type="password" required placeholder="Choose a strong password"/> <!></div></div> <div><label for="confirmPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Confirm Password</label> <div class="mt-1"><input id="confirmPassword" name="confirmPassword" type="password" required placeholder="Confirm your password"/> <!></div></div> <div class="pt-4"><!> <!></div> <!> <!> <div><!></div></form> <div class="mt-6"><div class="text-center"><p class="text-xs text-gray-500 dark:text-gray-400">This will create the admin user, generate a unique controller ID, and configure the required URLs for your GARM installation. <br/> Make sure to remember these credentials as they cannot be recovered.</p></div></div></div></div></div>');function Wr(Ce,Le){er(Le,!1);const[Ge,Ie]=vr(),L=()=>mr(pr,"$authStore",Ge),$=i(),z=i(),M=i(),R=i(),A=i(),F=i();let f=i("admin"),g=i("admin@garm.local"),m=i(""),x=i(""),h=i("Administrator"),G=i(!1),O=i(""),J=i(!1),E=i(""),V=i(""),B=i(""),N=i("");async function Ee(){if(e(F))try{s(G,!0),s(O,""),await gr.initialize(e(f).trim(),e(g).trim(),e(m),e(h).trim(),{callbackUrl:e(E).trim()||void 0,metadataUrl:e(V).trim()||void 0,webhookUrl:e(B).trim()||void 0,agentUrl:e(N).trim()||void 0}),br.success("GARM Initialized","GARM has been successfully initialized. Welcome!")}catch(r){s(O,fr(r))}finally{s(G,!1)}}rr(()=>{if(L().isAuthenticated){le(_("/"));return}!L().needsInitialization&&!L().loading&&le(_("/login"))}),q(()=>(e(E),e(V),e(B),e(N)),()=>{if(typeof window<"u"){const r=window.location.origin;e(E)||s(E,`${r}/api/v1/callbacks`),e(V)||s(V,`${r}/api/v1/metadata`),e(B)||s(B,`${r}/webhooks`),e(N)||s(N,`${r}/agent`)}}),q(()=>e(g),()=>{s($,e(g).trim()!==""&&e(g).includes("@"))}),q(()=>e(m),()=>{s(z,e(m).length>=8)}),q(()=>(e(x),e(m)),()=>{s(M,e(x).length>0&&e(m)===e(x))}),q(()=>e(f),()=>{s(R,e(f).trim()!=="")}),q(()=>e(h),()=>{s(A,e(h).trim()!=="")}),q(()=>(e(R),e($),e(A),e(z),e(M)),()=>{s(F,e(R)&&e($)&&e(A)&&e(z)&&e(M))}),q(()=>(e(G),L(),_),()=>{e(G)||(L().isAuthenticated?le(_("/")):!L().needsInitialization&&!L().loading&&le(_("/login")))}),ar(),Ze();var se=Cr();tr(r=>{sr.title="Initialize GARM - First Run Setup"});var oe=a(se),ge=a(oe),be=a(ge),Ve=d(be,2);t(ge),C(4),t(oe);var fe=d(oe,2),xe=d(a(fe),2),ie=a(xe),ne=a(ie),he=d(a(ne),2),K=a(he);w(K);var Be=d(K,2);{var Ne=r=>{var l=xr();n(r,l)};p(Be,r=>{e(R),e(f),u(()=>!e(R)&&e(f).length>0)&&r(Ne)})}t(he),t(ne);var ce=d(ne,2),ye=d(a(ce),2),Q=a(ye);w(Q);var Se=d(Q,2);{var je=r=>{var l=hr();n(r,l)};p(Se,r=>{e($),e(g),u(()=>!e($)&&e(g).length>0)&&r(je)})}t(ye),t(ce);var ve=d(ce,2),ke=d(a(ve),2),X=a(ke);w(X);var Fe=d(X,2);{var De=r=>{var l=yr();n(r,l)};p(Fe,r=>{e(A),e(h),u(()=>!e(A)&&e(h).length>0)&&r(De)})}t(ke),t(ve);var me=d(ve,2),_e=d(a(me),2),Y=a(_e);w(Y);var We=d(Y,2);{var He=r=>{var l=kr();n(r,l)};p(We,r=>{e(z),e(m),u(()=>!e(z)&&e(m).length>0)&&r(He)})}t(_e),t(me);var ue=d(me,2),we=d(a(ue),2),Z=a(we);w(Z);var Te=d(Z,2);{var Oe=r=>{var l=_r();n(r,l)};p(Te,r=>{e(M),e(x),u(()=>!e(M)&&e(x).length>0)&&r(Oe)})}t(we),t(ue);var pe=d(ue,2),Ue=a(pe);Pe(Ue,{type:"button",variant:"ghost",size:"sm",$$events:{click:()=>s(J,!e(J))},children:(r,l)=>{var b=wr(),c=ir(b);C(),de(()=>j(c,0,`w-4 h-4 mr-2 transition-transform ${e(J)?"rotate-90":""}`)),n(r,b)},$$slots:{default:!0}});var Je=d(Ue,2);{var Ke=r=>{var l=Ur(),b=a(l),c=a(b),P=d(a(c),2),I=a(P);w(I),C(2),t(P),t(c);var S=d(c,2),ee=d(a(S),2),D=a(ee);w(D),C(2),t(ee),t(S);var W=d(S,2),H=d(a(W),2),re=a(H);w(re),C(2),t(H),t(W);var T=d(W,2),ae=d(a(T),2),te=a(ae);w(te),C(2),t(ae),t(T),t(b),t(l),U(I,()=>e(V),y=>s(V,y)),U(D,()=>e(E),y=>s(E,y)),U(re,()=>e(B),y=>s(B,y)),U(te,()=>e(N),y=>s(N,y)),n(r,l)};p(Je,r=>{e(J)&&r(Ke)})}t(pe);var $e=d(pe,2);{var Qe=r=>{var l=Pr(),b=a(l),c=d(a(b),2),P=d(a(c),2),I=a(P),S=a(I);{var ee=o=>{var k=$r();n(o,k)};p(S,o=>{e(R)||o(ee)})}var D=d(S,2);{var W=o=>{var k=zr();n(o,k)};p(D,o=>{e($)||o(W)})}var H=d(D,2);{var re=o=>{var k=Mr();n(o,k)};p(H,o=>{e(A)||o(re)})}var T=d(H,2);{var ae=o=>{var k=Rr();n(o,k)};p(T,o=>{e(z)||o(ae)})}var te=d(T,2);{var y=o=>{var k=Ar();n(o,k)};p(te,o=>{e(M)||o(y)})}t(I),t(P),t(c),t(b),t(l),n(r,l)};p($e,r=>{e(F),e(f),e(g),e(h),e(m),e(x),u(()=>!e(F)&&(e(f).length>0||e(g).length>0||e(h).length>0||e(m).length>0||e(x).length>0))&&r(Qe)})}var ze=d($e,2);{var Xe=r=>{var l=qr(),b=a(l),c=d(a(b),2),P=a(c),I=a(P,!0);t(P),t(c),t(b),t(l),de(()=>Ae(I,e(O))),n(r,l)};p(ze,r=>{e(O)&&r(Xe)})}var Me=d(ze,2),Ye=a(Me);{let r=cr(()=>!e(F)||e(G));Pe(Ye,{type:"submit",variant:"primary",size:"lg",fullWidth:!0,get loading(){return e(G)},get disabled(){return e(r)},children:(l,b)=>{C();var c=nr();de(()=>Ae(c,e(G)?"Initializing...":"Initialize GARM")),n(l,c)},$$slots:{default:!0}})}t(Me),t(ie),C(2),t(xe),t(fe),t(se),de((r,l)=>{qe(be,"src",r),qe(Ve,"src",l),j(K,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(R),e(f),u(()=>!e(R)&&e(f).length>0?"border-red-300 dark:border-red-600":"")??""}`),j(Q,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e($),e(g),u(()=>!e($)&&e(g).length>0?"border-red-300 dark:border-red-600":"")??""}`),j(X,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(A),e(h),u(()=>!e(A)&&e(h).length>0?"border-red-300 dark:border-red-600":"")??""}`),j(Y,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(z),e(m),u(()=>!e(z)&&e(m).length>0?"border-red-300 dark:border-red-600":"")??""}`),j(Z,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(M),e(x),u(()=>!e(M)&&e(x).length>0?"border-red-300 dark:border-red-600":"")??""}`)},[()=>(Re(_),u(()=>_("/assets/garm-light.svg"))),()=>(Re(_),u(()=>_("/assets/garm-dark.svg")))]),U(K,()=>e(f),r=>s(f,r)),U(Q,()=>e(g),r=>s(g,r)),U(X,()=>e(h),r=>s(h,r)),U(Y,()=>e(m),r=>s(m,r)),U(Z,()=>e(x),r=>s(x,r)),dr("submit",ie,ur(Ee)),n(Ce,se),lr(),Ie()}export{Wr as component};
