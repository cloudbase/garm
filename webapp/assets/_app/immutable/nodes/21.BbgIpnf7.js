import{f as pe,h as Re,a as p,c as I,t as q,s as oe}from"../chunks/o8CdT7B0.js";import{i as Ee}from"../chunks/ChJfoPF0.js";import{p as Se,o as Be,l as P,b as Ie,f as L,a as Fe,g as e,m as l,$ as Ge,d as a,u as n,s as b,h as i,n as le,i as F,c as M,r as A,t as ne}from"../chunks/DUMcBckj.js";import{i as C,s as He,a as Ne}from"../chunks/i7pKks78.js";import{g as G}from"../chunks/CYDUEQO4.js";import{d as H,B as Ue,g as ie}from"../chunks/DNkq9lh7.js";import{P as ze}from"../chunks/Bq96ksMe.js";import{A as Oe}from"../chunks/JxqYLjS4.js";import{D as je,G as N,A as qe}from"../chunks/D6Qj-4eW.js";import{t as D}from"../chunks/Bbk4dQfI.js";import{e as ce}from"../chunks/BZiHL9L3.js";import{B as de}from"../chunks/CDC84lnF.js";import{D as me}from"../chunks/C89kpXZs.js";import{E as We}from"../chunks/Bt-55dFt.js";import{i as W}from"../chunks/C98nByjP.js";import{e as Je,a as J}from"../chunks/B7IXBAaI.js";var Ke=pe('<div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4 mb-6"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-red-800 dark:text-red-200">Error loading templates</h3> <div class="mt-2 text-sm text-red-700 dark:text-red-300"> </div> <div class="mt-4"><!></div></div></div></div>'),Qe=pe("<!> <!> <!> <!> <!>",1);function pt(ue,fe){Se(fe,!1);const[ge,ye]=He(),y=()=>Ne(Je,"$eagerCache",ge),U=l(),z=l(),v=l(),K=l();let h=l([]),R=l(""),u=l(""),c=l(1),_=l(25),$=l(1),E=l(!1),S=l(!1),m=l(null);async function ve(){try{await J.retryResource("templates")}catch(t){console.error("Retry failed:",t)}}async function he(){if(e(m)?.id)try{await ie.deleteTemplate(e(m).id),D.add({type:"success",title:"Template deleted",message:`Template "${e(m).name}" has been deleted successfully.`}),a(E,!1),a(m,null)}catch(t){const r=ce(t);D.add({type:"error",title:"Failed to delete template",message:r})}}function _e(){G(H("/templates/create"))}async function Q(t){if(!t.id){D.add({type:"error",title:"Error",message:"Template ID is missing"});return}G(H(`/templates/create?clone=${t.id}`))}function V(t){a(m,t),a(E,!0)}function we(){a(S,!0)}async function xe(){try{await ie.restoreTemplates({restore_all:!0}),D.add({type:"success",title:"Templates restored",message:"System templates have been restored successfully."}),a(S,!1),await J.retryResource("templates")}catch(t){const r=ce(t);D.add({type:"error",title:"Failed to restore templates",message:r})}}function X(t){switch(t){case"github":return{color:"blue",text:"GitHub"};case"gitea":return{color:"green",text:"Gitea"};default:return{color:"gray",text:t||"Unknown"}}}function Y(t){switch(t){case"linux":return{color:"blue",text:"Linux"};case"windows":return{color:"info",text:"Windows"};default:return{color:"gray",text:t||"Unknown"}}}const be=[{key:"name",title:"Name",cellComponent:We,cellProps:{entityType:"template"}},{key:"description",title:"Description",cellComponent:N,cellProps:{field:"description",type:"description"}},{key:"forge_type",title:"Forge Type",cellComponent:N,cellProps:{field:"forge_type"}},{key:"os_type",title:"OS Type",cellComponent:N,cellProps:{field:"os_type"}},{key:"owner_id",title:"Owner",cellComponent:N,cellProps:{field:"owner_id"}},{key:"actions",title:"Actions",align:"right",cellComponent:qe,cellProps:t=>{const r=W(),s=t.owner_id==="system",o=[];return o.push({type:"copy",title:"Clone",ariaLabel:"Clone template",action:"clone"}),(r||!s)&&o.push({type:"edit",title:"Edit",ariaLabel:"Edit template",action:"edit"}),(r||!s)&&o.push({type:"delete",title:"Delete",ariaLabel:"Delete template",action:"delete"}),{actions:o}}}],Ce={entityType:"template",primaryText:{field:"name",isClickable:!0,href:"/templates/{id}"},secondaryText:{field:"description"},badges:[{type:"custom",value:t=>{const r=X(t.forge_type);return{variant:r.color,text:r.text}}},{type:"custom",value:t=>{const r=Y(t.os_type);return{variant:r.color,text:r.text}}}],actions:[{type:"clone",handler:t=>Q(t)},{type:"edit",handler:t=>G(H(`/templates/${t.id}?edit=true`))},{type:"delete",handler:t=>V(t)}]};Be(async()=>{try{const t=await J.getTemplates();t&&Array.isArray(t)&&a(h,t)}catch(t){console.error("Failed to load templates:",t),a(R,t instanceof Error?t.message:"Failed to load templates")}}),P(()=>(e(h),y()),()=>{(!e(h).length||y().loaded.templates)&&a(h,y().templates)}),P(()=>y(),()=>{a(U,y().loading.templates)}),P(()=>y(),()=>{a(z,y().errorMessages.templates)}),P(()=>(e(u),e(h)),()=>{a(v,e(u)?e(h).filter(t=>t.name?.toLowerCase().includes(e(u).toLowerCase())||t.description?.toLowerCase().includes(e(u).toLowerCase())||t.forge_type?.toLowerCase().includes(e(u).toLowerCase())||t.os_type?.toLowerCase().includes(e(u).toLowerCase())):e(h))}),P(()=>(e($),e(v),e(_),e(c)),()=>{a($,Math.ceil(e(v).length/e(_))),e(c)>e($)&&e($)>0&&a(c,e($))}),P(()=>(e(v),e(c),e(_)),()=>{a(K,e(v).slice((e(c)-1)*e(_),e(c)*e(_)))}),Ie(),Ee();var Z=Qe();Re(t=>{Ge.title="Runner Install Templates - GARM"});var ee=L(Z);ze(ee,{title:"Runner Install Templates",description:"Manage templates for configuring runner software installation. These templates can be set on pools or scale sets.",actionLabel:"Create Template",showAction:!0,$$events:{action:_e},$$slots:{"secondary-actions":(t,r)=>{var s=I(),o=L(s);{var f=w=>{Ue(w,{variant:"secondary",icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />',$$events:{click:we},children:(T,B)=>{le();var d=q("Restore System Templates");p(T,d)},$$slots:{default:!0}})};C(o,w=>{i(W),n(W)&&w(f)})}p(t,s)}}});var te=b(ee,2);{var $e=t=>{var r=Ke(),s=M(r),o=b(M(s),2),f=b(M(o),2),w=M(f,!0);A(f);var T=b(f,2),B=M(T);Oe(B,{variant:"secondary",size:"sm",$$events:{click:ve},children:(d,g)=>{le();var O=q("Try Again");p(d,O)},$$slots:{default:!0}}),A(T),A(o),A(s),A(r),ne(()=>oe(w,e(R)||e(z))),p(t,r)};C(te,t=>{(e(R)||e(z))&&!e(U)&&t($e)})}var ae=b(te,2);je(ae,{get columns(){return be},get data(){return e(K)},get loading(){return e(U)},get error(){return e(R)},get searchTerm(){return e(u)},searchPlaceholder:"Search templates by name, description, type...",get currentPage(){return e(c)},get perPage(){return e(_)},get totalPages(){return e($)},get totalItems(){return e(v),n(()=>e(v).length)},get mobileCardConfig(){return Ce},emptyMessage:"No templates found",$$events:{search:t=>{a(u,t.detail.term),a(c,1)},pageChange:t=>a(c,t.detail.page),perPageChange:t=>{a(_,t.detail.perPage),a(c,1)},clone:t=>Q(t.detail.item),edit:t=>G(H(`/templates/${t.detail.item.id}?edit=true`)),delete:t=>V(t.detail.item)},$$slots:{cell:(t,r)=>{const s=F(()=>r.item),o=F(()=>r.column);var f=I(),w=L(f);{var T=d=>{const g=F(()=>(i(e(s)),n(()=>X(e(s).forge_type))));de(d,{get variant(){return i(e(g)),n(()=>e(g).color)},get text(){return i(e(g)),n(()=>e(g).text)}})},B=d=>{var g=I(),O=L(g);{var Le=k=>{const x=F(()=>(i(e(s)),n(()=>Y(e(s).os_type))));de(k,{get variant(){return i(e(x)),n(()=>e(x).color)},get text(){return i(e(x)),n(()=>e(x).text)}})},Me=k=>{var x=I(),Ae=L(x);{var De=j=>{var se=q();ne(()=>oe(se,(i(e(s)),n(()=>e(s).owner_id==="system"?"System":e(s).owner_id||"Unknown")))),p(j,se)};C(Ae,j=>{i(e(o)),n(()=>e(o).key==="owner_id")&&j(De)},!0)}p(k,x)};C(O,k=>{i(e(o)),n(()=>e(o).key==="os_type")?k(Le):k(Me,!1)},!0)}p(d,g)};C(w,d=>{i(e(o)),n(()=>e(o).key==="forge_type")?d(T):d(B,!1)})}p(t,f)}}});var re=b(ae,2);{var Te=t=>{me(t,{title:"Delete Template",message:"Are you sure you want to delete this template? This action cannot be undone.",get itemName(){return e(m),n(()=>e(m).name)},$$events:{close:()=>{a(E,!1),a(m,null)},confirm:he}})};C(re,t=>{e(E)&&e(m)&&t(Te)})}var ke=b(re,2);{var Pe=t=>{me(t,{title:"Restore System Templates",message:"This will restore all system templates from the default configuration. Any missing system templates will be created, and any changes made to existing system templates will be overwritten with the default content.",itemName:"",confirmLabel:"Restore Templates",danger:!1,$$events:{close:()=>a(S,!1),confirm:xe}})};C(ke,t=>{e(S)&&t(Pe)})}p(ue,Z),Fe(),ye()}export{pt as component};
