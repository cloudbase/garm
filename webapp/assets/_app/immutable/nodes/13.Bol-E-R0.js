import{f as E,a as T,s as de,e as Pe,h as Qe}from"../chunks/o8CdT7B0.js";import{i as je}from"../chunks/ChJfoPF0.js";import{p as Ge,v as Xe,o as Le,l as x,d as a,m as l,g as e,j as F,b as Ne,s,c as o,r as n,t as K,k as Ue,u as v,n as Me,a as qe,f as Ze,$ as et,h as P,i as be}from"../chunks/DUMcBckj.js";import{a as He,i as Q,s as Je}from"../chunks/i7pKks78.js";import{r as le,b as Re,h as tt,d as We,c as at,g as ve}from"../chunks/DNkq9lh7.js";import{e as rt,i as ot}from"../chunks/DC7Aeygn.js";import{b as Ie,a as Te}from"../chunks/BtzOUN4g.js";import{p as nt}from"../chunks/CdEA5IGF.js";import{M as it}from"../chunks/B8fqmrRi.js";import{F as st}from"../chunks/CvSGSNtk.js";import{e as Ae}from"../chunks/BZiHL9L3.js";import{e as Ve,a as Se}from"../chunks/B7IXBAaI.js";import{U as lt}from"../chunks/B_wUQWkL.js";import{D as dt}from"../chunks/C89kpXZs.js";import{P as ct}from"../chunks/Bq96ksMe.js";import{t as Y}from"../chunks/Bbk4dQfI.js";import{k as Ee,g as De,l as ut}from"../chunks/CeyYlXXo.js";import{B as gt}from"../chunks/CDC84lnF.js";import{D as mt,G as pt,A as ft}from"../chunks/D6Qj-4eW.js";import{A as Be}from"../chunks/JxqYLjS4.js";import{E as bt}from"../chunks/Bt-55dFt.js";import{E as vt}from"../chunks/D0nOHUaj.js";import{S as ht}from"../chunks/D2YqSmfb.js";var yt=E('<div class="mb-4 rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),_t=E('<div class="text-center py-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading...</p></div>'),xt=E("<option> </option>"),kt=E('<input type="password" class="block w-full px-3 py-2 mt-3 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter webhook secret"/>'),wt=E('<p class="text-sm text-gray-500 dark:text-gray-400">Webhook secret will be automatically generated</p>'),zt=E('<form class="space-y-4"><!> <div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Organization Name</label> <input id="name" type="text" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter organization name"/></div> <div><label for="credentials" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Credentials</label> <select id="credentials" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Select credentials...</option><!></select></div> <div><div class="flex items-center mb-1"><label for="pool_balancer_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Pool Balancer Type</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50"><div class="mb-2"><strong>Round Robin:</strong> Cycles through pools in turn. Job 1 → Pool 1, Job 2 → Pool 2, etc.</div> <div><strong>Pack:</strong> Uses first available pool until full, then moves to next pool.</div> <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="pool_balancer_type" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Round Robin</option><option>Pack</option></select></div> <div><div class="flex items-center mb-3"><input id="agent-mode" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="agent-mode" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Agent Mode</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">When enabled, runners will be installed with the GARM agent via userdata install templates. This allows for enhanced runner management and control. <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div></div> <div><div class="flex items-center mb-3"><input id="install-webhook" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="install-webhook" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Install Webhook</label></div> <div class="space-y-3"><div class="flex items-center"><input id="generate-webhook-secret" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"/> <label for="generate-webhook-secret" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Auto-generate webhook secret</label></div> <!></div></div> <div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 cursor-pointer">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"> </button></div></form>'),$t=E('<div class="max-w-2xl w-full p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Create Organization</h3> <!> <!></div>');function Ct(he,ye){Ge(ye,!1);const[_e,xe]=Je(),f=()=>He(Ve,"$eagerCache",_e),D=l(),w=l(),z=l(),X=l(),$=Xe();let C=l(!1),b=l(""),h=l("github"),r=l({name:"",credentials_name:"",webhook_secret:"",pool_balancer_type:"roundrobin",agent_mode:!1}),k=l(!0),p=l(!0);async function U(){if(!f().loaded.credentials&&!f().loading.credentials)try{await Se.getCredentials()}catch(d){a(b,Ae(d))}}function B(d){a(h,d.detail),F(r,e(r).credentials_name="")}function u(){if(e(r).credentials_name){const d=e(D).find(j=>j.name===e(r).credentials_name);d&&d.forge_type&&a(h,d.forge_type)}}function ke(){const d=new Uint8Array(32);return crypto.getRandomValues(d),Array.from(d,j=>j.toString(16).padStart(2,"0")).join("")}async function we(){if(!e(r).name?.trim()){a(b,"Organization name is required");return}if(!e(r).credentials_name){a(b,"Please select credentials");return}try{a(C,!0),a(b,"");const d={...e(r),install_webhook:e(k),auto_generate_secret:e(p)};$("submit",d)}catch(d){a(b,d instanceof Error?d.message:"Failed to create organization"),a(C,!1)}}Le(()=>{U()}),x(()=>f(),()=>{a(D,f().credentials)}),x(()=>f(),()=>{a(w,f().loading.credentials)}),x(()=>(e(D),e(h)),()=>{a(z,e(D).filter(d=>e(h)?d.forge_type===e(h):!0))}),x(()=>e(p),()=>{e(p)?F(r,e(r).webhook_secret=ke()):e(p)||F(r,e(r).webhook_secret="")}),x(()=>(e(r),e(p)),()=>{a(X,e(r).name?.trim()!==""&&e(r).credentials_name!==""&&(e(p)||e(r).webhook_secret&&e(r).webhook_secret.trim()!==""))}),Ne(),je(),it(he,{$$events:{close:()=>$("close")},children:(d,j)=>{var Z=$t(),G=s(o(Z),2);{var ee=y=>{var _=yt(),R=o(_),W=o(R,!0);n(R),n(_),K(()=>de(W,e(b))),T(y,_)};Q(G,y=>{e(b)&&y(ee)})}var ze=s(G,2);{var $e=y=>{var _=_t();T(y,_)},Ce=y=>{var _=zt(),R=o(_);st(R,{get selectedForgeType(){return e(h)},set selectedForgeType(i){a(h,i)},$$events:{select:B},$$legacy:!0});var W=s(R,2),ce=s(o(W),2);le(ce),n(W);var L=s(W,2),A=s(o(L),2);K(()=>{e(r),Ue(()=>{e(z)})});var N=o(A);N.value=N.__value="";var Oe=s(N);rt(Oe,1,()=>e(z),ot,(i,m)=>{var O=xt(),fe=o(O);n(O);var se={};K(()=>{de(fe,`${e(m),v(()=>e(m).name)??""} (${e(m),v(()=>e(m).endpoint?.name||"Unknown endpoint")??""})`),se!==(se=(e(m),v(()=>e(m).name)))&&(O.value=(O.__value=(e(m),v(()=>e(m).name)))??"")}),T(i,O)}),n(A),n(L);var q=s(L,2),te=s(o(q),2);K(()=>{e(r),Ue(()=>{})});var H=o(te);H.value=H.__value="roundrobin";var ue=s(H);ue.value=ue.__value="pack",n(te),n(q);var ae=s(q,2),ge=o(ae),t=o(ge);le(t),Me(4),n(ge),n(ae);var c=s(ae,2),I=o(c),M=o(I);le(M),Me(2),n(I);var g=s(I,2),S=o(g),J=o(S);le(J),Me(2),n(S);var re=s(S,2);{var oe=i=>{var m=kt();le(m),Ie(m,()=>e(r).webhook_secret,O=>F(r,e(r).webhook_secret=O)),T(i,m)},ne=i=>{var m=wt();T(i,m)};Q(re,i=>{e(p)?i(ne,!1):i(oe)})}n(g),n(c);var me=s(c,2),ie=o(me),V=s(ie,2),pe=o(V,!0);n(V),n(me),n(_),K(()=>{V.disabled=e(C)||e(w)||!e(X),de(pe,e(C)?"Creating...":"Create Organization")}),Ie(ce,()=>e(r).name,i=>F(r,e(r).name=i)),Re(A,()=>e(r).credentials_name,i=>F(r,e(r).credentials_name=i)),Pe("change",A,u),Re(te,()=>e(r).pool_balancer_type,i=>F(r,e(r).pool_balancer_type=i)),Te(t,()=>e(r).agent_mode,i=>F(r,e(r).agent_mode=i)),Te(M,()=>e(k),i=>a(k,i)),Te(J,()=>e(p),i=>a(p,i)),Pe("click",ie,()=>$("close")),Pe("submit",_,nt(we)),T(y,_)};Q(ze,y=>{e(C)?y($e):y(Ce,!1)})}n(Z),T(d,Z)},$$slots:{default:!0}}),qe(),xe()}var Ot=E('<div class="flex items-center justify-between"><div class="flex-1 min-w-0"><a class="block"><p class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 truncate"> </p> <div class="flex items-center mt-1 space-x-2"><div class="flex items-center text-xs text-gray-500 dark:text-gray-400"><!> <span class="ml-1"> </span></div></div></a></div> <div class="flex items-center space-x-3 ml-4"><!> <div class="flex space-x-2"><!> <!></div></div></div>'),Pt=E('<div class="space-y-6"><!> <!></div> <!> <!> <!>',1);function Xt(he,ye){Ge(ye,!1);const[_e,xe]=Je(),f=()=>He(Ve,"$eagerCache",_e),D=l(),w=l(),z=l(),X=l();let $=l([]),C=l(!0),b=l(""),h=l(""),r=l(1),k=l(25),p=l(!1),U=l(!1),B=l(!1),u=l(null);function ke(){a(p,!1),a(B,!1),a(U,!1)}async function we(t){try{a(b,"");const c=t.detail,I={name:c.name,credentials_name:c.credentials_name,webhook_secret:c.webhook_secret,pool_balancer_type:c.pool_balancer_type},M=await ve.createOrganization(I);if(c.install_webhook&&M.id)try{await ve.installOrganizationWebhook(M.id),Y.success("Webhook Installed",`Webhook for organization ${M.name} has been installed successfully.`)}catch(g){console.warn("Organization created but webhook installation failed:",g),Y.error("Webhook Installation Failed",g instanceof Error?g.message:"Failed to install webhook. You can try installing it manually from the organization details page.")}Y.success("Organization Created",`Organization ${M.name} has been created successfully.`),a(p,!1)}catch(c){throw a(b,Ae(c)),c}}async function d(t){if(e(u))try{await ve.updateOrganization(e(u).id,t),Y.success("Organization Updated",`Organization ${e(u).name} has been updated successfully.`),a(U,!1),a(u,null)}catch(c){throw c}}async function j(){if(e(u))try{a(b,""),await ve.deleteOrganization(e(u).id),Y.success("Organization Deleted",`Organization ${e(u).name} has been deleted successfully.`),a(u,null)}catch(t){const c=Ae(t);Y.error("Delete Failed",c)}finally{ke()}}function Z(){a(p,!0)}function G(t){a(u,t),a(U,!0)}function ee(t){a(u,t),a(B,!0)}Le(async()=>{try{a(C,!0);const t=await Se.getOrganizations();t&&Array.isArray(t)&&a($,t)}catch(t){console.error("Failed to load organizations:",t),a(b,t instanceof Error?t.message:"Failed to load organizations")}finally{a(C,!1)}});async function ze(){try{await Se.retryResource("organizations")}catch(t){console.error("Retry failed:",t)}}const $e=[{key:"name",title:"Name",cellComponent:bt,cellProps:{entityType:"organization"}},{key:"endpoint",title:"Endpoint",cellComponent:vt},{key:"credentials",title:"Credentials",cellComponent:pt,cellProps:{field:"credentials_name"}},{key:"status",title:"Status",cellComponent:ht,cellProps:{statusType:"entity"}},{key:"actions",title:"Actions",align:"right",cellComponent:ft}],Ce={entityType:"organization",primaryText:{field:"name",isClickable:!0,href:"/organizations/{id}"},customInfo:[{icon:t=>De(t?.endpoint?.endpoint_type||"unknown"),text:t=>t?.endpoint?.name||"Unknown"}],badges:[{type:"custom",value:t=>Ee(t)}],actions:[{type:"edit",handler:t=>G(t)},{type:"delete",handler:t=>ee(t)}]};function y(t){a(h,t.detail.term),a(r,1)}function _(t){a(r,t.detail.page)}function R(t){a(k,t.detail.perPage),a(r,1)}function W(t){G(t.detail.item)}function ce(t){ee(t.detail.item)}x(()=>(e($),f()),()=>{(!e($).length||f().loaded.organizations)&&a($,f().organizations)}),x(()=>f(),()=>{a(C,f().loading.organizations)}),x(()=>f(),()=>{a(D,f().errorMessages.organizations)}),x(()=>(e($),e(h)),()=>{a(w,ut(e($),e(h)))}),x(()=>(e(w),e(k)),()=>{a(z,Math.ceil(e(w).length/e(k)))}),x(()=>(e(r),e(z)),()=>{e(r)>e(z)&&e(z)>0&&a(r,e(z))}),x(()=>(e(w),e(r),e(k)),()=>{a(X,e(w).slice((e(r)-1)*e(k),e(r)*e(k)))}),Ne(),je();var L=Pt();Qe(t=>{et.title="Organizations - GARM"});var A=Ze(L),N=o(A);ct(N,{title:"Organizations",description:"Manage GitHub and Gitea organizations",actionLabel:"Add Organization",$$events:{action:Z}});var Oe=s(N,2);{let t=be(()=>e(D)||e(b)),c=be(()=>!!e(D));mt(Oe,{get columns(){return $e},get data(){return e(X)},get loading(){return e(C)},get error(){return e(t)},get searchTerm(){return e(h)},searchPlaceholder:"Search organizations...",get currentPage(){return e(r)},get perPage(){return e(k)},get totalPages(){return e(z)},get totalItems(){return e(w),v(()=>e(w).length)},itemName:"organizations",emptyIconType:"building",get showRetry(){return e(c)},get mobileCardConfig(){return Ce},$$events:{search:y,pageChange:_,perPageChange:R,retry:ze,edit:W,delete:ce},$$slots:{"mobile-card":(I,M)=>{const g=be(()=>M.item),S=be(()=>(P(Ee),P(e(g)),v(()=>Ee(e(g)))));var J=Ot(),re=o(J),oe=o(re),ne=o(oe),me=o(ne,!0);n(ne);var ie=s(ne,2),V=o(ie),pe=o(V);tt(pe,()=>(P(De),P(e(g)),v(()=>De(e(g).endpoint?.endpoint_type||"unknown"))));var i=s(pe,2),m=o(i,!0);n(i),n(V),n(ie),n(oe),n(re);var O=s(re,2),fe=o(O);gt(fe,{get variant(){return P(e(S)),v(()=>e(S).variant)},get text(){return P(e(S)),v(()=>e(S).text)}});var se=s(fe,2),Fe=o(se);Be(Fe,{action:"edit",size:"sm",title:"Edit organization",ariaLabel:"Edit organization",$$events:{click:()=>G(e(g))}});var Ye=s(Fe,2);Be(Ye,{action:"delete",size:"sm",title:"Delete organization",ariaLabel:"Delete organization",$$events:{click:()=>ee(e(g))}}),n(se),n(O),n(J),K(Ke=>{at(oe,"href",Ke),de(me,(P(e(g)),v(()=>e(g).name))),de(m,(P(e(g)),v(()=>e(g).endpoint?.name||"Unknown")))},[()=>(P(We),P(e(g)),v(()=>We(`/organizations/${e(g).id}`)))]),T(I,J)}}})}n(A);var q=s(A,2);{var te=t=>{Ct(t,{$$events:{close:()=>a(p,!1),submit:we}})};Q(q,t=>{e(p)&&t(te)})}var H=s(q,2);{var ue=t=>{lt(t,{get entity(){return e(u)},entityType:"organization",$$events:{close:()=>{a(U,!1),a(u,null)},submit:c=>d(c.detail)}})};Q(H,t=>{e(U)&&e(u)&&t(ue)})}var ae=s(H,2);{var ge=t=>{dt(t,{title:"Delete Organization",message:"Are you sure you want to delete this organization? This action cannot be undone.",get itemName(){return e(u),v(()=>e(u).name)},$$events:{close:()=>{a(B,!1),a(u,null)},confirm:j}})};Q(ae,t=>{e(B)&&e(u)&&t(ge)})}T(he,L),qe(),xe()}export{Xt as component};
