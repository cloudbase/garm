import"../chunks/DsnmJJEf.js";import{i as Ae}from"../chunks/B3Pzt0F_.js";import{p as Ge,E as je,o as Se,l as w,s as r,m as n,g as e,a as Be,f as M,k as o,j as i,r as l,c as $,t as L,v as K,x as Ee,u as y,z as Ie,y as Z,e as $e,d as He,B as Je,b as Re,h as Ve,$ as We,n as A,q as ee}from"../chunks/D8EpLgQ1.js";import{a as Ue,i as B,s as Fe}from"../chunks/5WA7h8uK.js";import{r as Ce,b as Pe,c as Ye,g as ge}from"../chunks/CiE1LlKV.js";import{b as Me}from"../chunks/CoIRRsD9.js";import{P as Ke}from"../chunks/CO4LUyTP.js";import{e as Oe,i as Qe}from"../chunks/u94nIB4-.js";import{b as De}from"../chunks/C6k1Q4We.js";import{p as Xe}from"../chunks/D4Caz1gY.js";import{M as Ze}from"../chunks/qB7B8uiS.js";import{e as Le,a as ye}from"../chunks/wyaP0EDu.js";import{U as et}from"../chunks/CclkODgu.js";import{D as tt}from"../chunks/KQ2xQpA3.js";import{t as be}from"../chunks/BEkVdVE1.js";import{B as rt,k as ve,l as at}from"../chunks/BGVHQGl-.js";import{D as st,A as Te,G as ot,a as nt}from"../chunks/C9DJVOi1.js";import{E as it}from"../chunks/B7ITzBt8.js";import{E as lt}from"../chunks/CGpPw4EW.js";import{S as dt}from"../chunks/BE4wujub.js";var ct=M('<div class="mb-4 rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),ut=M('<div class="text-center py-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading...</p></div>'),pt=M("<option> </option>"),mt=M('<p class="mt-1 text-xs text-gray-600 dark:text-gray-400">Loading credentials...</p>'),ft=M('<p class="mt-1 text-xs text-red-600 dark:text-red-400">No GitHub credentials found. Please create GitHub credentials first.</p>'),gt=M(`<form class="space-y-4"><div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Enterprise Name</label> <input id="name" type="text" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter enterprise name"/></div> <div><label for="credentials" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">GitHub Credentials</label> <select id="credentials" required class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Select GitHub credentials...</option><!></select> <!></div> <div><div class="flex items-center mb-1"><label for="pool_balancer_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Pool Balancer Type</label> <div class="ml-2 relative group"><svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50"><div class="mb-2"><strong>Round Robin:</strong> Cycles through pools in turn. Job 1 → Pool 1, Job 2 → Pool 2, etc.</div> <div><strong>Pack:</strong> Uses first available pool until full, then moves to next pool.</div> <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="pool_balancer_type" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"><option>Round Robin</option><option>Pack</option></select></div> <div><label for="webhook_secret" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Webhook Secret</label> <input id="webhook_secret" type="password" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm" placeholder="Enter webhook secret"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">You'll need to manually configure this secret in GitHub's enterprise webhook settings.</p></div> <div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 cursor-pointer">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"> </button></div></form>`),bt=M('<div class="max-w-2xl w-full p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Create Enterprise</h3> <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Enterprises are only available for GitHub endpoints.</p> <!> <!></div>');function vt(te,re){Ge(re,!1);const[ae,se]=Fe(),p=()=>Ue(Le,"$eagerCache",ae),G=n(),h=n(),m=n(),H=n(),E=je();let x=n(!1),f=n(""),a=n({name:"",credentials_name:"",webhook_secret:"",pool_balancer_type:"roundrobin"});async function _(){if(!p().loaded.credentials&&!p().loading.credentials)try{await ye.getCredentials()}catch(c){r(f,c instanceof Error?c.message:"Failed to load credentials")}}async function C(){if(!e(a).name||!e(a).name.trim()){r(f,"Enterprise name is required");return}if(!e(a).credentials_name){r(f,"Please select credentials");return}try{r(x,!0),r(f,"");const c={...e(a)};E("submit",c)}catch(c){r(f,c instanceof Error?c.message:"Failed to create enterprise"),r(x,!1)}}Se(()=>{_()}),w(()=>p(),()=>{r(G,p().credentials)}),w(()=>p(),()=>{r(h,p().loading.credentials)}),w(()=>e(G),()=>{r(m,e(G).filter(c=>c.forge_type==="github"))}),w(()=>e(a),()=>{r(H,e(a).name&&e(a).name.trim()!==""&&e(a).credentials_name!==""&&e(a).webhook_secret&&e(a).webhook_secret.trim()!=="")}),Be(),Ae(),Ze(te,{$$events:{close:()=>E("close")},children:(c,N)=>{var D=bt(),d=o(i(D),4);{var oe=g=>{var b=ct(),T=i(b),R=i(T,!0);l(T),l(b),L(()=>K(R,e(f))),$(g,b)};B(d,g=>{e(f)&&g(oe)})}var ne=o(d,2);{var ie=g=>{var b=ut();$(g,b)},le=g=>{var b=gt(),T=i(b),R=o(i(T),2);Ce(R),l(T);var q=o(T,2),U=o(i(q),2);L(()=>{e(a),Ee(()=>{e(m)})});var z=i(U);z.value=z.__value="";var de=o(z);Oe(de,1,()=>e(m),Qe,(s,u)=>{var P=pt(),v=i(P);l(P);var k={};L(()=>{K(v,`${e(u),y(()=>e(u).name)??""} (${e(u),y(()=>e(u).endpoint?.name||"Unknown endpoint")??""})`),k!==(k=(e(u),y(()=>e(u).name)))&&(P.value=(P.__value=(e(u),y(()=>e(u).name)))??"")}),$(s,P)}),l(U);var ce=o(U,2);{var ue=s=>{var u=mt();$(s,u)},O=s=>{var u=Je(),P=Re(u);{var v=k=>{var Y=ft();$(k,Y)};B(P,k=>{e(m),y(()=>e(m).length===0)&&k(v)},!0)}$(s,u)};B(ce,s=>{e(h)?s(ue):s(O,!1)})}l(q);var S=o(q,2),F=o(i(S),2);L(()=>{e(a),Ee(()=>{})});var j=i(F);j.value=j.__value="roundrobin";var I=o(j);I.value=I.__value="pack",l(F),l(S);var J=o(S,2),V=o(i(J),2);Ce(V),Ie(2),l(J);var Q=o(J,2),X=i(Q),W=o(X,2),t=i(W,!0);l(W),l(Q),l(b),L(()=>{W.disabled=(e(x),e(h),e(H),e(m),y(()=>e(x)||e(h)||!e(H)||e(m).length===0)),K(t,e(x)?"Creating...":"Create Enterprise")}),De(R,()=>e(a).name,s=>Z(a,e(a).name=s)),Pe(U,()=>e(a).credentials_name,s=>Z(a,e(a).credentials_name=s)),Pe(F,()=>e(a).pool_balancer_type,s=>Z(a,e(a).pool_balancer_type=s)),De(V,()=>e(a).webhook_secret,s=>Z(a,e(a).webhook_secret=s)),$e("click",X,()=>E("close")),$e("submit",b,Xe(C)),$(g,b)};B(ne,g=>{e(x)?g(ie):g(le,!1)})}l(D),$(c,D)},$$slots:{default:!0}}),He(),se()}var yt=M('<div class="flex items-center justify-between"><div class="flex-1 min-w-0"><a class="block"><p class="text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 truncate"> </p> <p class="text-sm text-gray-500 dark:text-gray-400 truncate mt-1"> </p></a></div> <div class="flex items-center space-x-3 ml-4"><!> <div class="flex space-x-2"><!> <!></div></div></div>'),ht=M('<div class="space-y-6"><!> <!></div> <!> <!> <!>',1);function Nt(te,re){Ge(re,!1);const[ae,se]=Fe(),p=()=>Ue(Le,"$eagerCache",ae),G=n(),h=n(),m=n(),H=n();let E=n([]),x=n(!0),f=n(""),a=n(""),_=n(1),C=n(25),c=n(!1),N=n(!1),D=n(!1),d=n(null);async function oe(t){try{r(f,""),await ge.createEnterprise(t),be.success("Enterprise Created",`Enterprise ${t.name} has been created successfully.`),r(c,!1)}catch(s){throw r(f,s instanceof Error?s.message:"Failed to create enterprise"),s}}async function ne(t){if(e(d))try{await ge.updateEnterprise(e(d).id,t),be.success("Enterprise Updated",`Enterprise ${e(d).name} has been updated successfully.`),r(N,!1),r(d,null)}catch(s){throw s}}async function ie(){if(e(d))try{r(f,""),await ge.deleteEnterprise(e(d).id),be.success("Enterprise Deleted",`Enterprise ${e(d).name} has been deleted successfully.`),r(D,!1),r(d,null)}catch(t){r(f,t instanceof Error?t.message:"Failed to delete enterprise")}}function le(){r(c,!0)}function g(t){r(d,t),r(N,!0)}function b(t){r(d,t),r(D,!0)}Se(async()=>{try{r(x,!0);const t=await ye.getEnterprises();t&&Array.isArray(t)&&r(E,t)}catch(t){console.error("Failed to load enterprises:",t),r(f,t instanceof Error?t.message:"Failed to load enterprises")}finally{r(x,!1)}});async function T(){try{await ye.retryResource("enterprises")}catch(t){console.error("Retry failed:",t)}}const R=[{key:"name",title:"Name",cellComponent:it,cellProps:{entityType:"enterprise"}},{key:"endpoint",title:"Endpoint",cellComponent:lt},{key:"credentials",title:"Credentials",cellComponent:ot,cellProps:{field:"credentials_name"}},{key:"status",title:"Status",cellComponent:dt,cellProps:{statusType:"entity"}},{key:"actions",title:"Actions",align:"right",cellComponent:nt}],q={entityType:"enterprise",primaryText:{field:"name",isClickable:!0,href:"/enterprises/{id}"},secondaryText:{field:"credentials_name"},badges:[{type:"custom",value:t=>ve(t)}],actions:[{type:"edit",handler:t=>g(t)},{type:"delete",handler:t=>b(t)}]};function U(t){r(a,t.detail.term),r(_,1)}function z(t){r(_,t.detail.page)}function de(t){r(C,t.detail.perPage),r(_,1)}function ce(t){g(t.detail.item)}function ue(t){b(t.detail.item)}w(()=>(e(E),p()),()=>{(!e(E).length||p().loaded.enterprises)&&r(E,p().enterprises)}),w(()=>p(),()=>{r(x,p().loading.enterprises)}),w(()=>p(),()=>{r(G,p().errorMessages.enterprises)}),w(()=>(e(E),e(a)),()=>{r(h,at(e(E),e(a)))}),w(()=>(e(h),e(C)),()=>{r(m,Math.ceil(e(h).length/e(C)))}),w(()=>(e(_),e(m)),()=>{e(_)>e(m)&&e(m)>0&&r(_,e(m))}),w(()=>(e(h),e(_),e(C)),()=>{r(H,e(h).slice((e(_)-1)*e(C),e(_)*e(C)))}),Be(),Ae();var O=ht();Ve(t=>{We.title="Enterprises - GARM"});var S=Re(O),F=i(S);Ke(F,{title:"Enterprises",description:"Manage GitHub enterprises",actionLabel:"Add Enterprise",$$events:{action:le}});var j=o(F,2);{let t=ee(()=>e(G)||e(f)),s=ee(()=>!!e(G));st(j,{get columns(){return R},get data(){return e(H)},get loading(){return e(x)},get error(){return e(t)},get searchTerm(){return e(a)},searchPlaceholder:"Search enterprises...",get currentPage(){return e(_)},get perPage(){return e(C)},get totalPages(){return e(m)},get totalItems(){return e(h),y(()=>e(h).length)},itemName:"enterprises",emptyIconType:"building",get showRetry(){return e(s)},get mobileCardConfig(){return q},$$events:{search:U,pageChange:z,perPageChange:de,retry:T,edit:ce,delete:ue},$$slots:{"mobile-card":(u,P)=>{const v=ee(()=>P.item),k=ee(()=>(A(ve),A(e(v)),y(()=>ve(e(v)))));var Y=yt(),pe=i(Y),me=i(pe),fe=i(me),Ne=i(fe,!0);l(fe);var he=o(fe,2),qe=i(he,!0);l(he),l(me),l(pe);var _e=o(pe,2),xe=i(_e);rt(xe,{get variant(){return A(e(k)),y(()=>e(k).variant)},get text(){return A(e(k)),y(()=>e(k).text)}});var ke=o(xe,2),we=i(ke);Te(we,{action:"edit",size:"sm",title:"Edit enterprise",ariaLabel:"Edit enterprise",$$events:{click:()=>g(e(v))}});var ze=o(we,2);Te(ze,{action:"delete",size:"sm",title:"Delete enterprise",ariaLabel:"Delete enterprise",$$events:{click:()=>b(e(v))}}),l(ke),l(_e),l(Y),L(()=>{Ye(me,"href",(A(Me),A(e(v)),y(()=>`${Me}/enterprises/${e(v).id}`))),K(Ne,(A(e(v)),y(()=>e(v).name))),K(qe,(A(e(v)),y(()=>e(v).credentials_name)))}),$(u,Y)}}})}l(S);var I=o(S,2);{var J=t=>{vt(t,{$$events:{close:()=>r(c,!1),submit:s=>oe(s.detail)}})};B(I,t=>{e(c)&&t(J)})}var V=o(I,2);{var Q=t=>{et(t,{get entity(){return e(d)},entityType:"enterprise",$$events:{close:()=>{r(N,!1),r(d,null)},submit:s=>ne(s.detail)}})};B(V,t=>{e(N)&&e(d)&&t(Q)})}var X=o(V,2);{var W=t=>{tt(t,{title:"Delete Enterprise",message:"Are you sure you want to delete this enterprise? This action cannot be undone.",get itemName(){return e(d),y(()=>e(d).name)},$$events:{close:()=>{r(D,!1),r(d,null)},confirm:ie}})};B(X,t=>{e(D)&&e(d)&&t(W)})}$(te,O),He(),se()}export{Nt as component};
