import{c as mt,a as w,b as _,s as j,l as ut,e as Oe,f as U,g as Qt,h as Kt}from"../chunks/CxOx-TIJ.js";import{i as pt}from"../chunks/3NxSoY2_.js";import{p as bt,B as Xt,l as je,j as g,m as S,g as e,i as W,b as ft,f as Yt,c as r,s as a,r as t,d as p,w as V,h as k,u as m,t as F,a as xt,F as x,n as ht,o as Zt,x as er,$ as tr,k as X}from"../chunks/DzFKsO_V.js";import{p as rr,i as A,s as ar,a as or,v as sr}from"../chunks/B_jyf0qs.js";import{e as ir,i as nr}from"../chunks/CdXRaxkX.js";import{B as lr,r as re,s as le,g as yt,c as D,d as ie}from"../chunks/BguOOs3x.js";import{l as dr}from"../chunks/BAcG6-Ep.js";import{w as $e}from"../chunks/DSHGoHxX.js";import{e as ct,a as Ie}from"../chunks/Penjr-j0.js";import{w as vt}from"../chunks/DoJxysSt.js";import{b as ne,a as cr}from"../chunks/BVM1034P.js";import{p as vr}from"../chunks/CdEA5IGF.js";import{M as gr}from"../chunks/Pgjt70l7.js";import{T as Y}from"../chunks/Cy4PP0DI.js";import{t as gt}from"../chunks/li_-Mkq2.js";import{e as mr}from"../chunks/BZiHL9L3.js";n[x]="src/lib/components/ControllerInfoCard.svelte";var ur=w(Qt('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> Settings',1),n[x],[[150,4,[[151,5],[152,5]]]]),pr=w(U('<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Enabled</span>'),n[x],[[210,9]]),br=w(U('<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Disabled</span>'),n[x],[[214,9]]),fr=w(U('<div><div class="flex items-center"><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Agent Releases URL</div> <div class="ml-2"><!></div></div> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-600 dark:text-gray-300 break-all min-h-[38px] flex items-center"> </div></div>'),n[x],[[223,7,[[224,8,[[225,9],[226,9]]],[233,8]]]]),xr=w(U('<div><div class="flex items-center"><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Metadata</div> <div class="ml-2"><!></div></div> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-600 dark:text-gray-300 break-all min-h-[38px] flex items-center"> </div></div>'),n[x],[[249,7,[[250,8,[[251,9],[252,9]]],[259,8]]]]),hr=w(U('<div><div class="flex items-center"><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Callback</div> <div class="ml-2"><!></div></div> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-600 dark:text-gray-300 break-all min-h-[38px] flex items-center"> </div></div>'),n[x],[[267,7,[[268,8,[[269,9],[270,9]]],[277,8]]]]),yr=w(U('<div><div class="flex items-center"><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Webhook</div> <div class="ml-2"><!></div></div> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-600 dark:text-gray-300 break-all min-h-[38px] flex items-center"> </div></div>'),n[x],[[285,7,[[286,8,[[287,9],[288,9]]],[295,8]]]]),kr=w(U('<div><div class="flex items-center"><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Agent</div> <div class="ml-2"><!></div></div> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-600 dark:text-gray-300 break-all min-h-[38px] flex items-center"> </div></div>'),n[x],[[303,7,[[304,8,[[305,9],[306,9]]],[313,8]]]]),_r=w(U('<div class="text-center py-4"><svg class="mx-auto h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">No URLs configured</p> <button class="mt-1 text-xs text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 font-medium cursor-pointer">Configure now</button></div>'),n[x],[[321,7,[[322,8,[[323,9]]],[325,8],[326,8]]]]),wr=w(U('<div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-600"><div class="flex items-center mb-2"><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Controller Webhook URL</div> <div class="ml-2"><!></div></div> <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md border border-blue-200 dark:border-blue-800"><div class="flex items-start space-x-3"><div class="flex-shrink-0 mt-0.5"><svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg></div> <div class="min-w-0 flex-1"><code class="text-sm font-mono text-blue-800 dark:text-blue-300 break-all"> </code> <p class="mt-1 text-xs text-blue-700 dark:text-blue-400">Use this URL in your GitHub organization/repository webhook settings</p></div></div></div></div>'),n[x],[[341,3,[[342,4,[[343,5],[344,5]]],[351,4,[[352,5,[[353,6,[[354,7,[[355,8]]]]],[358,6,[[359,7],[362,7]]]]]]]]]]),Ur=w(U('<p class="mt-1 text-sm text-red-600">Please enter a valid URL</p>'),n[x],[[394,6]]),Rr=w(U('<p class="mt-1 text-sm text-red-600">Please enter a valid URL</p>'),n[x],[[415,6]]),Mr=w(U('<p class="mt-1 text-sm text-red-600">Please enter a valid URL</p>'),n[x],[[436,6]]),Lr=w(U('<p class="mt-1 text-sm text-red-600">Please enter a valid URL</p>'),n[x],[[457,6]]),Cr=w(U('<p class="mt-1 text-sm text-red-600">Please enter a valid URL</p>'),n[x],[[496,6]]),Ar=w(U('<div class="max-w-2xl w-full p-6"><h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Controller Settings</h3> <form class="space-y-4"><div><label for="metadataUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Metadata URL</label> <input id="metadataUrl" type="url" placeholder="https://garm.example.com/api/v1/metadata"/> <!> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where runners can fetch metadata and setup information</p></div> <div><label for="callbackUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Callback URL</label> <input id="callbackUrl" type="url" placeholder="https://garm.example.com/api/v1/callbacks"/> <!> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where runners send status updates and lifecycle events</p></div> <div><label for="webhookUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Webhook Base URL</label> <input id="webhookUrl" type="url" placeholder="https://garm.example.com/webhooks"/> <!> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where GitHub/Gitea will send webhook events for job notifications</p></div> <div><label for="agentUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Agent URL</label> <input id="agentUrl" type="url" placeholder="https://garm.example.com/agent"/> <!> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where GARM agents connect. Must support websocket connections</p></div> <div><label for="minimumJobAgeBackoff" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Minimum Job Age Backoff (seconds)</label> <input id="minimumJobAgeBackoff" type="number" min="0" placeholder="30" class="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Time to wait before spinning up a runner for a new job (0 = immediate)</p></div> <div><label for="garmAgentReleasesUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Agent Releases URL</label> <input id="garmAgentReleasesUrl" type="url" placeholder="https://api.github.com/repos/cloudbase/garm-agent/releases"/> <!> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where GARM fetches garm-agent binaries (must be compatible with GitHub releases API)</p></div> <div><label class="flex items-center cursor-pointer"><input id="syncGarmAgentTools" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded cursor-pointer"/> <span class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">Enable Agent Tools Sync</span></label> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400 ml-6">Automatically synchronize garm-agent tools from the configured releases URL</p></div> <div class="flex justify-end space-x-3 pt-4"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"> </button></div></form></div>'),n[x],[[376,2,[[377,3],[379,3,[[381,4,[[382,5],[385,5],[396,5]]],[402,4,[[403,5],[406,5],[417,5]]],[423,4,[[424,5],[427,5],[438,5]]],[444,4,[[445,5],[448,5],[459,5]]],[465,4,[[466,5],[469,5],[477,5]]],[483,4,[[484,5],[487,5],[498,5]]],[504,4,[[505,5,[[506,6],[512,6]]],[516,5]]],[522,4,[[523,5],[531,5]]]]]]]]),Tr=w(U('<div class="bg-white dark:bg-gray-800 shadow rounded-lg"><div class="p-6"><div class="flex items-center justify-between mb-6"><div class="flex items-center space-x-3"><div class="flex items-center justify-center w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900"><svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div> <div><h3 class="text-lg font-semibold text-gray-900 dark:text-white">Controller Information</h3> <div class="mt-1"><span class="text-sm text-gray-500 dark:text-gray-400"> </span></div></div></div> <!></div> <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="space-y-4"><div><h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Identity</h4> <div class="space-y-3"><div><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Controller ID</div> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-600 dark:text-gray-300 break-all min-h-[38px] flex items-center"> </div></div> <div><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Hostname</div> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-600 dark:text-gray-300 break-all min-h-[38px] flex items-center"> </div></div> <div><div class="flex items-center"><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Job Age Backoff</div> <div class="ml-2"><!></div></div> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-600 dark:text-gray-300 min-h-[38px] flex items-center"> </div></div> <div><div class="flex items-center"><div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide font-medium">Agent Tools Sync</div> <div class="ml-2"><!></div></div> <div class="mt-1 p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm font-mono text-gray-600 dark:text-gray-300 min-h-[38px] flex items-center"><!></div></div> <!></div></div></div> <div class="space-y-4"><div><h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Integration URLs</h4> <div class="space-y-3"><!> <!> <!> <!> <!></div></div></div></div> <!></div></div> <!>',1),n[x],[[125,0,[[126,1,[[128,2,[[129,3,[[130,4,[[131,5,[[132,6]]]]],[135,4,[[136,5],[137,5,[[138,6]]]]]]]]],[159,2,[[161,3,[[162,4,[[163,5],[164,5,[[166,6,[[167,7],[168,7]]],[174,6,[[175,7],[176,7]]],[182,6,[[183,7,[[184,8],[185,8]]],[192,7]]],[198,6,[[199,7,[[200,8],[201,8]]],[208,7]]]]]]]]],[243,3,[[244,4,[[245,5],[246,5]]]]]]]]]]]]);function n(Ge,ke){mt(new.target),bt(ke,!1,n);const b=S(),_e=S();let s=rr(ke,"controllerInfo",12);const we=Xt();let l=S(!1),G=S(!1),T=S(""),$=S(""),f=S(""),B=S(""),H=S(null),E=S(""),Z=S(!1);function Ue(){g(T,s().metadata_url||""),g($,s().callback_url||""),g(f,s().webhook_url||""),g(B,s().agent_url||""),g(H,s().minimum_job_age_backoff||null),g(E,s().garm_agent_releases_url||""),g(Z,s().enable_agent_tools_sync??!1),g(l,!0)}async function Be(){try{g(G,!0);const o={};e(T).trim()&&(o.metadata_url=e(T).trim()),e($).trim()&&(o.callback_url=e($).trim()),e(f).trim()&&(o.webhook_url=e(f).trim()),e(B).trim()&&(o.agent_url=e(B).trim()),W(e(H),null,!1)&&e(H)>=0&&(o.minimum_job_age_backoff=e(H)),e(E).trim()&&(o.garm_agent_releases_url=e(E).trim()),o.enable_agent_tools_sync=e(Z);const c=(await ht(yt.updateController(o)))();gt.success("Settings Updated","Controller settings have been updated successfully."),g(l,!1),s(c),we("updated",c)}catch(o){gt.error("Update Failed",o instanceof Error?o.message:"Failed to update controller settings")}finally{g(G,!1)}}function ae(){g(l,!1),g(T,""),g($,""),g(f,""),g(B,""),g(H,null),g(E,""),g(Z,!1)}je(()=>{},()=>{g(b,o=>{if(!o.trim())return!0;try{return new URL(o),!0}catch{return!1}})}),je(()=>(e(b),e(T),e($),e(f),e(B),e(E),e(H)),()=>{g(_e,e(b)(e(T))&&e(b)(e($))&&e(b)(e(f))&&e(b)(e(B))&&e(b)(e(E))&&(W(e(H),null)||e(H)>=0))}),ft(),pt();var de=Tr(),ce=Yt(de),oe=r(ce),se=r(oe),ve=r(se),ge=a(r(ve),2),me=a(r(ge),2),ue=r(me),Re=r(ue);t(ue),t(me),t(ge),t(ve);var Me=a(ve,2);p(()=>lr(Me,{variant:"secondary",size:"sm",$$events:{click:Ue},children:vt(n,(o,c)=>{var u=ur();V(),_(o,u)}),$$slots:{default:!0}}),"component",n,145,3,{componentTag:"Button"}),t(se);var pe=a(se,2),be=r(pe),d=r(be),i=a(r(d),2),R=r(i),I=a(r(R),2),M=r(I,!0);t(I),t(R);var L=a(R,2),P=a(r(L),2),ee=r(P,!0);t(P),t(L);var N=a(L,2),J=r(N),Q=a(r(J),2),K=r(Q);p(()=>Y(K,{title:"Job Age Backoff",content:"Time in seconds GARM waits after receiving a new job before spinning up a runner. This delay allows existing idle runners to pick up jobs first, preventing unnecessary runner creation. Set to 0 for immediate response."}),"component",n,186,9,{componentTag:"Tooltip"}),t(Q),t(J);var te=a(J,2),fe=r(te);t(te),t(N);var xe=a(N,2),he=r(xe),Le=a(r(he),2),kt=r(Le);p(()=>Y(kt,{title:"Agent Tools Sync",content:"When enabled, GARM will automatically synchronize garm-agent tools from the configured releases URL. This ensures agents are up-to-date with the latest versions."}),"component",n,202,9,{componentTag:"Tooltip"}),t(Le),t(he);var Ne=a(he,2),_t=r(Ne);{var wt=o=>{var c=pr();_(o,c)},Ut=o=>{var c=br();_(o,c)};p(()=>A(_t,o=>{k(s()),m(()=>s().enable_agent_tools_sync)?o(wt):o(Ut,!1)}),"if",n,209,8)}t(Ne),t(xe);var Rt=a(xe,2);{var Mt=o=>{var c=fr(),u=r(c),h=a(r(u),2),z=r(h);p(()=>Y(z,{title:"Agent Releases URL",content:"URL from where GARM fetches garm-agent binaries. Must be compatible with the GitHub releases API format. Defaults to the official garm-agent releases repository."}),"component",n,227,10,{componentTag:"Tooltip"}),t(h),t(u);var y=a(u,2),C=r(y,!0);t(y),t(c),F(()=>j(C,(k(s()),m(()=>s().garm_agent_releases_url)))),_(o,c)};p(()=>A(Rt,o=>{k(s()),m(()=>s().garm_agent_releases_url)&&o(Mt)}),"if",n,222,6)}t(i),t(d),t(be);var Qe=a(be,2),Ke=r(Qe),Xe=a(r(Ke),2),Ye=r(Xe);{var Lt=o=>{var c=xr(),u=r(c),h=a(r(u),2),z=r(h);p(()=>Y(z,{title:"Metadata URL",content:"URL where runners retrieve setup information and metadata. Runners must be able to connect to this URL during their initialization process. Usually accessible at /api/v1/metadata endpoint."}),"component",n,253,10,{componentTag:"Tooltip"}),t(h),t(u);var y=a(u,2),C=r(y,!0);t(y),t(c),F(()=>j(C,(k(s()),m(()=>s().metadata_url)))),_(o,c)};p(()=>A(Ye,o=>{k(s()),m(()=>s().metadata_url)&&o(Lt)}),"if",n,248,6)}var Ze=a(Ye,2);{var Ct=o=>{var c=hr(),u=r(c),h=a(r(u),2),z=r(h);p(()=>Y(z,{title:"Callback URL",content:"URL where runners send status updates and system information (OS version, runner agent ID, etc.) to the controller. Runners must be able to connect to this URL. Usually accessible at /api/v1/callbacks endpoint."}),"component",n,271,10,{componentTag:"Tooltip"}),t(h),t(u);var y=a(u,2),C=r(y,!0);t(y),t(c),F(()=>j(C,(k(s()),m(()=>s().callback_url)))),_(o,c)};p(()=>A(Ze,o=>{k(s()),m(()=>s().callback_url)&&o(Ct)}),"if",n,266,6)}var et=a(Ze,2);{var At=o=>{var c=yr(),u=r(c),h=a(r(u),2),z=r(h);p(()=>Y(z,{title:"Webhook Base URL",content:"Base URL for webhooks where GitHub sends job notifications. GARM needs to receive these webhooks to know when to create new runners for jobs. GitHub must be able to connect to this URL. Usually accessible at /webhooks endpoint."}),"component",n,289,10,{componentTag:"Tooltip"}),t(h),t(u);var y=a(u,2),C=r(y,!0);t(y),t(c),F(()=>j(C,(k(s()),m(()=>s().webhook_url)))),_(o,c)};p(()=>A(et,o=>{k(s()),m(()=>s().webhook_url)&&o(At)}),"if",n,284,6)}var tt=a(et,2);{var Tt=o=>{var c=kr(),u=r(c),h=a(r(u),2),z=r(h);p(()=>Y(z,{title:"Agent URL",content:"URL where GARM agents connect for communication. This URL must support websocket connections for real-time communication between the controller and agent instances. Usually accessible at /agent endpoint."}),"component",n,307,10,{componentTag:"Tooltip"}),t(h),t(u);var y=a(u,2),C=r(y,!0);t(y),t(c),F(()=>j(C,(k(s()),m(()=>s().agent_url)))),_(o,c)};p(()=>A(tt,o=>{k(s()),m(()=>s().agent_url)&&o(Tt)}),"if",n,302,6)}var zt=a(tt,2);{var St=o=>{var c=_r(),u=a(r(c),4);t(c),Oe("click",u,Ue),_(o,c)};p(()=>A(zt,o=>{k(s()),m(()=>!s().metadata_url&&!s().callback_url&&!s().webhook_url&&!s().agent_url)&&o(St)}),"if",n,320,6)}t(Xe),t(Ke),t(Qe),t(pe);var $t=a(pe,2);{var It=o=>{var c=wr(),u=r(c),h=a(r(u),2),z=r(h);p(()=>Y(z,{title:"Controller Webhook URL",content:"Unique webhook URL for this GARM controller. This is the preferred URL to use in GitHub webhook settings as it's controller-specific and allows multiple GARM controllers to work with the same repository. Automatically combines the webhook base URL with the controller ID."}),"component",n,345,6,{componentTag:"Tooltip"}),t(h),t(u);var y=a(u,2),C=r(y),ye=a(r(C),2),Ce=r(ye),Ee=r(Ce,!0);t(Ce),V(2),t(ye),t(C),t(y),t(c),F(()=>j(Ee,(k(s()),m(()=>s().controller_webhook_url)))),_(o,c)};p(()=>A($t,o=>{k(s()),m(()=>s().controller_webhook_url)&&o(It)}),"if",n,340,2)}t(oe),t(ce);var jt=a(ce,2);{var Gt=o=>{p(()=>gr(o,{$$events:{close:ae},children:vt(n,(c,u)=>{var h=Ar(),z=a(r(h),2),y=r(z),C=a(r(y),2);re(C);let ye;var Ce=a(C,2);{var Ee=v=>{var q=Ur();_(v,q)};p(()=>A(Ce,v=>{e(b),e(T),m(()=>!e(b)(e(T)))&&v(Ee)}),"if",n,393,5)}V(2),t(y);var He=a(y,2),Ae=a(r(He),2);re(Ae);let rt;var Bt=a(Ae,2);{var Et=v=>{var q=Rr();_(v,q)};p(()=>A(Bt,v=>{e(b),e($),m(()=>!e(b)(e($)))&&v(Et)}),"if",n,414,5)}V(2),t(He);var Pe=a(He,2),Te=a(r(Pe),2);re(Te);let at;var Ht=a(Te,2);{var Pt=v=>{var q=Mr();_(v,q)};p(()=>A(Ht,v=>{e(b),e(f),m(()=>!e(b)(e(f)))&&v(Pt)}),"if",n,435,5)}V(2),t(Pe);var qe=a(Pe,2),ze=a(r(qe),2);re(ze);let ot;var qt=a(ze,2);{var Dt=v=>{var q=Lr();_(v,q)};p(()=>A(qt,v=>{e(b),e(B),m(()=>!e(b)(e(B)))&&v(Dt)}),"if",n,456,5)}V(2),t(qe);var De=a(qe,2),st=a(r(De),2);re(st),V(2),t(De);var We=a(De,2),Se=a(r(We),2);re(Se);let it;var Wt=a(Se,2);{var Ft=v=>{var q=Cr();_(v,q)};p(()=>A(Wt,v=>{e(b),e(E),m(()=>!e(b)(e(E)))&&v(Ft)}),"if",n,495,5)}V(2),t(We);var Fe=a(We,2),nt=r(Fe),lt=r(nt);re(lt),V(2),t(nt),V(2),t(Fe);var dt=a(Fe,2),Ve=r(dt),Je=a(Ve,2),Vt=r(Je,!0);t(Je),t(dt),t(z),t(h),F((v,q,Jt,Ot,Nt)=>{ye=le(C,1,"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm",null,ye,v),rt=le(Ae,1,"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm",null,rt,q),at=le(Te,1,"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm",null,at,Jt),ot=le(ze,1,"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm",null,ot,Ot),it=le(Se,1,"block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white sm:text-sm",null,it,Nt),Ve.disabled=e(G),Je.disabled=!e(_e)||e(G),j(Vt,e(G)?"Saving...":"Save Changes")},[()=>({"border-red-300":!e(b)(e(T))}),()=>({"border-red-300":!e(b)(e($))}),()=>({"border-red-300":!e(b)(e(f))}),()=>({"border-red-300":!e(b)(e(B))}),()=>({"border-red-300":!e(b)(e(E))})]),ne(C,()=>e(T),v=>g(T,v)),ne(Ae,()=>e($),v=>g($,v)),ne(Te,()=>e(f),v=>g(f,v)),ne(ze,()=>e(B),v=>g(B,v)),ne(st,()=>e(H),v=>g(H,v)),ne(Se,()=>e(E),v=>g(E,v)),cr(lt,()=>e(Z),v=>g(Z,v)),Oe("click",Ve,ae),Oe("submit",z,vr(Be)),_(c,h)}),$$slots:{default:!0}}),"component",n,375,1,{componentTag:"Modal"})};p(()=>A(jt,o=>{e(l)&&o(Gt)}),"if",n,374,0)}return F(o=>{j(Re,`v${o??""}`),j(M,(k(s()),m(()=>s().controller_id))),j(ee,(k(s()),m(()=>s().hostname||"Unknown"))),j(fe,`${k(s()),m(()=>s().minimum_job_age_backoff||30)??""}s`)},[()=>(k(s()),m(()=>s().version?.replace(/^v/,"")||"Unknown"))]),_(Ge,de),xt({...ut()})}O[x]="src/routes/+page.svelte";var zr=w(U('<div class="rounded-md bg-red-50 dark:bg-red-900 p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-red-800 dark:text-red-200">Error loading dashboard</h3> <p class="mt-2 text-sm text-red-700 dark:text-red-300"> </p></div></div></div>'),O[x],[[210,2,[[211,3,[[212,4,[[213,5,[[214,6]]]]],[217,4,[[218,5],[219,5]]]]]]]]),Sr=w(U('<a class="bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg hover:shadow-md transition-shadow duration-200"><div class="p-5"><div class="flex items-center"><div class="flex-shrink-0"><div><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg></div></div> <div class="ml-5 w-0 flex-1"><dl><dt class="text-sm font-medium text-gray-500 dark:text-gray-400 truncate"> </dt> <dd class="text-lg font-medium text-gray-900 dark:text-white"> </dd></dl></div></div></div></a>'),O[x],[[228,3,[[232,4,[[233,5,[[234,6,[[235,7,[[236,8,[[237,9]]]]]]],[241,6,[[242,7,[[243,8],[246,8]]]]]]]]]]]]),$r=w(U('<div class="space-y-6"><div><h1 class="text-2xl font-bold text-gray-900 dark:text-white">Dashboard</h1> <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Welcome to GARM - GitHub Actions Runner Manager</p></div> <!> <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4"></div> <!> <div class="bg-white dark:bg-gray-800 shadow rounded-lg"><div class="p-6"><h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Quick Actions</h3> <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Common tasks you can perform</p> <div class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"><a class="relative block w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg p-6 hover:border-gray-400 dark:hover:border-gray-500 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><div class="flex items-center"><svg class="flex-shrink-0 w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <div class="ml-4"><h4 class="text-sm font-medium text-gray-900 dark:text-white">Add Repository</h4> <p class="text-sm text-gray-500 dark:text-gray-400">Connect a new GitHub repository</p></div></div></a> <a class="relative block w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg p-6 hover:border-gray-400 dark:hover:border-gray-500 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><div class="flex items-center"><svg class="flex-shrink-0 w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <div class="ml-4"><h4 class="text-sm font-medium text-gray-900 dark:text-white">Create Pool</h4> <p class="text-sm text-gray-500 dark:text-gray-400">Set up a new runner pool</p></div></div></a> <a class="relative block w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg p-6 hover:border-gray-400 dark:hover:border-gray-500 hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><div class="flex items-center"><svg class="flex-shrink-0 w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg> <div class="ml-4"><h4 class="text-sm font-medium text-gray-900 dark:text-white">View Instances</h4> <p class="text-sm text-gray-500 dark:text-gray-400">Monitor running instances</p></div></div></a></div></div></div></div>'),O[x],[[199,0,[[201,1,[[202,2],[203,2]]],[226,1],[266,1,[[267,3,[[268,4],[269,4],[273,4,[[274,5,[[278,6,[[279,7,[[280,8]]],[282,7,[[283,8],[284,8]]]]]]],[289,5,[[293,6,[[294,7,[[295,8]]],[297,7,[[298,8],[299,8]]]]]]],[304,5,[[308,6,[[309,7,[[310,8],[311,8]]],[313,7,[[314,8],[315,8]]]]]]]]]]]]]]]]);function O(Ge,ke){mt(new.target),bt(ke,!1,O);const[b,_e]=ar(),s=()=>(sr(ct,"eagerCache"),or(ct,"$eagerCache",b)),we=S();let l=S({repositories:0,organizations:0,pools:0,instances:0}),G=S(null),T=S(""),$=[];function f(d,i,R=1e3){const I=parseInt(d.textContent||"0"),M=(i-I)/(R/16);let L=I;const P=()=>{if(L+=M,M>0&&L>=i||M<0&&L<=i){d.textContent=i.toString();return}d.textContent=Math.floor(L).toString(),requestAnimationFrame(P)};W(I,i,!1)&&requestAnimationFrame(P)}Zt(async()=>{try{const[M,L,P,ee,N]=(await ht(Promise.all([Ie.getRepositories(),Ie.getOrganizations(),Ie.getPools(),yt.listInstances(),Ie.getControllerInfo()])))();setTimeout(()=>{const J=document.querySelector('[data-stat="repositories"]'),Q=document.querySelector('[data-stat="organizations"]'),K=document.querySelector('[data-stat="pools"]'),te=document.querySelector('[data-stat="instances"]');J&&f(J,M.length),Q&&f(Q,L.length),K&&f(K,P.length),te&&f(te,ee.length)},100),g(l,{repositories:M.length,organizations:L.length,pools:P.length,instances:ee.length}),N&&g(G,N)}catch(M){g(T,mr(M)),console.error(...dr("error","Dashboard error:",M))}const d=$e.subscribeToEntity("repository",["create","delete"],B),i=$e.subscribeToEntity("organization",["create","delete"],H),R=$e.subscribeToEntity("pool",["create","delete"],E),I=$e.subscribeToEntity("instance",["create","delete"],Z);$=[d,i,R,I]}),er(()=>{$.forEach(d=>d())});function B(d){const i=document.querySelector('[data-stat="repositories"]');W(d.operation,"create")?(X(l,e(l).repositories++),i&&f(i,e(l).repositories,500)):W(d.operation,"delete")&&(X(l,e(l).repositories=Math.max(0,e(l).repositories-1)),i&&f(i,e(l).repositories,500))}function H(d){const i=document.querySelector('[data-stat="organizations"]');W(d.operation,"create")?(X(l,e(l).organizations++),i&&f(i,e(l).organizations,500)):W(d.operation,"delete")&&(X(l,e(l).organizations=Math.max(0,e(l).organizations-1)),i&&f(i,e(l).organizations,500))}function E(d){const i=document.querySelector('[data-stat="pools"]');W(d.operation,"create")?(X(l,e(l).pools++),i&&f(i,e(l).pools,500)):W(d.operation,"delete")&&(X(l,e(l).pools=Math.max(0,e(l).pools-1)),i&&f(i,e(l).pools,500))}function Z(d){const i=document.querySelector('[data-stat="instances"]');W(d.operation,"create")?(X(l,e(l).instances++),i&&f(i,e(l).instances,500)):W(d.operation,"delete")&&(X(l,e(l).instances=Math.max(0,e(l).instances-1)),i&&f(i,e(l).instances,500))}function Ue(d){g(G,d.detail)}function Be(d){return{blue:"bg-blue-500 text-white",green:"bg-green-500 text-white",purple:"bg-purple-500 text-white",yellow:"bg-yellow-500 text-white"}[d]||"bg-gray-500 text-white"}je(()=>(e(G),s()),()=>{(!e(G)||s().loaded.controllerInfo)&&g(G,s().controllerInfo)}),je(()=>(e(l),D),()=>{g(we,[{title:"Repositories",value:e(l).repositories,icon:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",color:"blue",href:D("/repositories")},{title:"Organizations",value:e(l).organizations,icon:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z",color:"green",href:D("/organizations")},{title:"Pools",value:e(l).pools,icon:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z",color:"purple",href:D("/pools")},{title:"Instances",value:e(l).instances,icon:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z",color:"yellow",href:D("/instances")}])}),ft(),pt();var ae=$r();Kt(d=>{tr.title="Dashboard - GARM"});var de=a(r(ae),2);{var ce=d=>{var i=zr(),R=r(i),I=a(r(R),2),M=a(r(I),2),L=r(M,!0);t(M),t(I),t(R),t(i),F(()=>j(L,e(T))),_(d,i)};p(()=>A(de,d=>{e(T)&&d(ce)}),"if",O,208,1)}var oe=a(de,2);p(()=>ir(oe,5,()=>e(we),nr,(d,i)=>{var R=Sr(),I=r(R),M=r(I),L=r(M),P=r(L),ee=r(P),N=r(ee);t(ee),t(P),t(L);var J=a(L,2),Q=r(J),K=r(Q),te=r(K,!0);t(K);var fe=a(K,2),xe=r(fe,!0);t(fe),t(Q),t(J),t(M),t(I),t(R),F((he,Le)=>{ie(R,"href",(e(i),m(()=>e(i).href))),le(P,1,`w-8 h-8 rounded-md ${he??""} flex items-center justify-center`),ie(N,"d",(e(i),m(()=>e(i).icon))),j(te,(e(i),m(()=>e(i).title))),ie(fe,"data-stat",Le),j(xe,(e(i),m(()=>e(i).value)))},[()=>(e(i),m(()=>Be(e(i).color))),()=>(e(i),m(()=>e(i).title.toLowerCase()))]),_(d,R)}),"each",O,227,2),t(oe);var se=a(oe,2);{var ve=d=>{p(()=>n(d,{get controllerInfo(){return e(G)},$$events:{updated:Ue}}),"component",O,259,2,{componentTag:"ControllerInfoCard"})};p(()=>A(se,d=>{e(G)&&d(ve)}),"if",O,258,1)}var ge=a(se,2),me=r(ge),ue=a(r(me),4),Re=r(ue),Me=a(Re,2),pe=a(Me,2);t(ue),t(me),t(ge),t(ae),F((d,i,R)=>{ie(Re,"href",d),ie(Me,"href",i),ie(pe,"href",R)},[()=>(k(D),m(()=>D("/repositories"))),()=>(k(D),m(()=>D("/pools"))),()=>(k(D),m(()=>D("/instances")))]),_(Ge,ae);var be=xt({...ut()});return _e(),be}export{O as component};
