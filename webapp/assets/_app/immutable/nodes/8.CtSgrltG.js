import{c as or,a as u,h as ir,e as nr,b as c,l as cr,t as mr,s as Ce,f as g,g as vr}from"../chunks/CxOx-TIJ.js";import{i as ur}from"../chunks/3NxSoY2_.js";import{p as pr,o as gr,l as E,b as fr,d as v,t as ne,g as e,a as br,m as n,$ as xr,c as a,s as d,u as b,f as hr,w as I,j as o,e as yr,h as Ge,F as m,i as X,r as t,n as kr}from"../chunks/DzFKsO_V.js";import{s as _r,a as wr,i as x,v as Ur}from"../chunks/B_jyf0qs.js";import{w as Ee}from"../chunks/DoJxysSt.js";import{c as M,B as Ie,s as D,d as Be,r as R}from"../chunks/BguOOs3x.js";import{b as z}from"../chunks/BVM1034P.js";import{p as $r}from"../chunks/CdEA5IGF.js";import{g as ce}from"../chunks/BzzAh3Be.js";import{a as Fe,b as Mr}from"../chunks/K_YdKkKc.js";import{t as Rr}from"../chunks/li_-Mkq2.js";import{e as zr}from"../chunks/BZiHL9L3.js";l[m]="src/routes/init/+page.svelte";var Ar=u(g('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Username is required</p>'),l[m],[[171,7]]),Pr=u(g('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Please enter a valid email address</p>'),l[m],[[194,7]]),Lr=u(g('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Full name is required</p>'),l[m],[[217,7]]),qr=u(g('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Password must be at least 8 characters long</p>'),l[m],[[240,7]]),Cr=u(g('<p class="mt-2 text-sm text-red-600 dark:text-red-400">Passwords do not match</p>'),l[m],[[263,7]]),Gr=u(vr('<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg> Advanced Configuration (Optional)',1),l[m],[[278,6,[[284,7]]]]),Er=u(g('<div class="mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-md border border-gray-200 dark:border-gray-600"><div class="space-y-4"><div><label for="metadataUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Metadata URL</label> <div class="mt-1"><input id="metadataUrl" name="metadataUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/api/v1/metadata"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where runners can fetch metadata and setup information.</p></div></div> <div><label for="callbackUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Callback URL</label> <div class="mt-1"><input id="callbackUrl" name="callbackUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/api/v1/callbacks"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where runners send status updates and lifecycle events.</p></div></div> <div><label for="webhookUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Webhook URL</label> <div class="mt-1"><input id="webhookUrl" name="webhookUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/webhooks"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where GitHub/Gitea will send webhook events for job notifications.</p></div></div> <div><label for="agentUrl" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Agent URL</label> <div class="mt-1"><input id="agentUrl" name="agentUrl" type="url" class="appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm" placeholder="https://garm.example.com/agent"/> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">URL where GARM agents will connect. Must allow websocket connections.</p></div></div></div></div>'),l[m],[[290,6,[[291,7,[[293,8,[[294,9],[297,9,[[298,10],[306,10]]]]],[313,8,[[314,9],[317,9,[[318,10],[326,10]]]]],[333,8,[[334,9],[337,9,[[338,10],[346,10]]]]],[353,8,[[354,9],[357,9,[[358,10],[366,10]]]]]]]]]]),Ir=u(g("<li>Enter a username</li>"),l[m],[[392,11]]),Br=u(g("<li>Enter a valid email address</li>"),l[m],[[395,11]]),Fr=u(g("<li>Enter your full name</li>"),l[m],[[398,11]]),Nr=u(g("<li>Enter a password with at least 8 characters</li>"),l[m],[[401,11]]),Sr=u(g("<li>Confirm your password</li>"),l[m],[[404,11]]),Vr=u(g('<div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Please complete all required fields</h3> <div class="mt-2 text-sm text-yellow-700 dark:text-yellow-300"><ul class="list-disc list-inside space-y-1"><!> <!> <!> <!> <!></ul></div></div></div></div>'),l[m],[[378,5,[[379,6,[[380,7,[[381,8,[[382,9]]]]],[385,7,[[386,8],[389,8,[[390,9]]]]]]]]]]),jr=u(g('<div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><p class="text-sm text-red-800 dark:text-red-200"> </p></div></div></div>'),l[m],[[415,5,[[416,6,[[417,7,[[418,8,[[419,9]]]]],[422,7,[[423,8]]]]]]]]),Tr=u(g('<div class="min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col justify-center py-12 sm:px-6 lg:px-8"><div class="sm:mx-auto sm:w-full sm:max-w-md"><div class="flex justify-center"><img alt="GARM" class="h-16 w-auto dark:hidden"/> <img alt="GARM" class="h-16 w-auto hidden dark:block"/></div> <h1 class="mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white">Welcome to GARM</h1> <p class="mt-2 text-center text-sm text-gray-600 dark:text-gray-400">Complete the first-run setup to get started</p></div> <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md"><div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 mb-6"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">First-Run Initialization</h3> <div class="mt-2 text-sm text-blue-700 dark:text-blue-300"><p>GARM needs to be initialized before first use. This will create the admin user and generate a unique controller ID for this installation.</p></div></div></div></div> <div class="bg-white dark:bg-gray-800 py-8 px-4 shadow sm:rounded-lg sm:px-10"><form class="space-y-6"><div><label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Username</label> <div class="mt-1"><input id="username" name="username" type="text" required placeholder="Enter admin username"/> <!></div></div> <div><label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email Address</label> <div class="mt-1"><input id="email" name="email" type="email" required placeholder="admin@example.com"/> <!></div></div> <div><label for="fullName" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Full Name</label> <div class="mt-1"><input id="fullName" name="fullName" type="text" required placeholder="Enter full name"/> <!></div></div> <div><label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label> <div class="mt-1"><input id="password" name="password" type="password" required placeholder="Choose a strong password"/> <!></div></div> <div><label for="confirmPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Confirm Password</label> <div class="mt-1"><input id="confirmPassword" name="confirmPassword" type="password" required placeholder="Confirm your password"/> <!></div></div> <div class="pt-4"><!> <!></div> <!> <!> <div><!></div></form> <div class="mt-6"><div class="text-center"><p class="text-xs text-gray-500 dark:text-gray-400">This will create the admin user, generate a unique controller ID, and configure the required URLs for your GARM installation. <br/> Make sure to remember these credentials as they cannot be recovered.</p></div></div></div></div></div>'),l[m],[[110,0,[[111,1,[[112,2,[[113,3],[118,3]]],[124,2],[127,2]]],[132,1,[[134,2,[[135,3,[[136,4,[[137,5,[[138,6]]]]],[141,4,[[142,5],[145,5,[[146,6]]]]]]]]],[153,2,[[154,3,[[156,4,[[157,5],[160,5,[[161,6]]]]],[179,4,[[180,5],[183,5,[[184,6]]]]],[202,4,[[203,5],[206,5,[[207,6]]]]],[225,4,[[226,5],[229,5,[[230,6]]]]],[248,4,[[249,5],[252,5,[[253,6]]]]],[271,4],[430,4]]],[445,3,[[446,4,[[447,5,[[449,6]]]]]]]]]]]]]]);function l(Ne,Se){or(new.target),pr(Se,!1,l);const[Ve,je]=_r(),B=()=>(Ur(Fe,"authStore"),wr(Fe,"$authStore",Ve)),A=n(),P=n(),L=n(),q=n(),C=n(),H=n();let k=n("admin"),h=n("admin@garm.local"),f=n(""),_=n(""),w=n("Administrator"),F=n(!1),Y=n(""),Z=n(!1),S=n(""),V=n(""),j=n(""),T=n("");async function Te(){if(e(H))try{o(F,!0),o(Y,""),(await kr(Mr.initialize(e(k).trim(),e(h).trim(),e(f),e(w).trim(),{callbackUrl:e(S).trim()||void 0,metadataUrl:e(V).trim()||void 0,webhookUrl:e(j).trim()||void 0,agentUrl:e(T).trim()||void 0})))(),Rr.success("GARM Initialized","GARM has been successfully initialized. Welcome!")}catch(r){o(Y,zr(r))}finally{o(F,!1)}}gr(()=>{if(B().isAuthenticated){ce(M("/"));return}!B().needsInitialization&&!B().loading&&ce(M("/login"))}),E(()=>(e(S),e(V),e(j),e(T)),()=>{if(X(typeof window,"undefined",!1)){const r=window.location.origin;e(S)||o(S,`${r}/api/v1/callbacks`),e(V)||o(V,`${r}/api/v1/metadata`),e(j)||o(j,`${r}/webhooks`),e(T)||o(T,`${r}/agent`)}}),E(()=>e(h),()=>{o(A,X(e(h).trim(),"",!1)&&e(h).includes("@"))}),E(()=>e(f),()=>{o(P,e(f).length>=8)}),E(()=>(e(_),e(f)),()=>{o(L,e(_).length>0&&X(e(f),e(_)))}),E(()=>e(k),()=>{o(q,X(e(k).trim(),"",!1))}),E(()=>e(w),()=>{o(C,X(e(w).trim(),"",!1))}),E(()=>(e(q),e(A),e(C),e(P),e(L)),()=>{o(H,e(q)&&e(A)&&e(C)&&e(P)&&e(L))}),E(()=>(e(F),B(),M),()=>{e(F)||(B().isAuthenticated?ce(M("/")):!B().needsInitialization&&!B().loading&&ce(M("/login")))}),fr(),ur();var me=Tr();ir(r=>{xr.title="Initialize GARM - First Run Setup"});var ve=a(me),ye=a(ve),ke=a(ye),We=d(ke,2);t(ye),I(4),t(ve);var _e=d(ve,2),we=d(a(_e),2),ue=a(we),pe=a(ue),Ue=d(a(pe),2),ee=a(Ue);R(ee);var De=d(ee,2);{var He=r=>{var s=Ar();c(r,s)};v(()=>x(De,r=>{e(q),e(k),b(()=>!e(q)&&e(k).length>0)&&r(He)}),"if",l,170,6)}t(Ue),t(pe);var ge=d(pe,2),$e=d(a(ge),2),re=a($e);R(re);var Oe=d(re,2);{var Je=r=>{var s=Pr();c(r,s)};v(()=>x(Oe,r=>{e(A),e(h),b(()=>!e(A)&&e(h).length>0)&&r(Je)}),"if",l,193,6)}t($e),t(ge);var fe=d(ge,2),Me=d(a(fe),2),ae=a(Me);R(ae);var Ke=d(ae,2);{var Qe=r=>{var s=Lr();c(r,s)};v(()=>x(Ke,r=>{e(C),e(w),b(()=>!e(C)&&e(w).length>0)&&r(Qe)}),"if",l,216,6)}t(Me),t(fe);var be=d(fe,2),Re=d(a(be),2),te=a(Re);R(te);var Xe=d(te,2);{var Ye=r=>{var s=qr();c(r,s)};v(()=>x(Xe,r=>{e(P),e(f),b(()=>!e(P)&&e(f).length>0)&&r(Ye)}),"if",l,239,6)}t(Re),t(be);var xe=d(be,2),ze=d(a(xe),2),de=a(ze);R(de);var Ze=d(de,2);{var er=r=>{var s=Cr();c(r,s)};v(()=>x(Ze,r=>{e(L),e(_),b(()=>!e(L)&&e(_).length>0)&&r(er)}),"if",l,262,6)}t(ze),t(xe);var he=d(xe,2),Ae=a(he);v(()=>Ie(Ae,{type:"button",variant:"ghost",size:"sm",$$events:{click:()=>o(Z,!e(Z))},children:Ee(l,(r,s)=>{var y=Gr(),p=hr(y);I(),ne(()=>D(p,0,`w-4 h-4 mr-2 transition-transform ${e(Z)?"rotate-90":""}`)),c(r,y)}),$$slots:{default:!0}}),"component",l,272,5,{componentTag:"Button"});var rr=d(Ae,2);{var ar=r=>{var s=Er(),y=a(s),p=a(y),G=d(a(p),2),N=a(G);R(N),I(2),t(G),t(p);var W=d(p,2),le=d(a(W),2),O=a(le);R(O),I(2),t(le),t(W);var J=d(W,2),K=d(a(J),2),se=a(K);R(se),I(2),t(K),t(J);var Q=d(J,2),oe=d(a(Q),2),ie=a(oe);R(ie),I(2),t(oe),t(Q),t(y),t(s),z(N,()=>e(V),U=>o(V,U)),z(O,()=>e(S),U=>o(S,U)),z(se,()=>e(j),U=>o(j,U)),z(ie,()=>e(T),U=>o(T,U)),c(r,s)};v(()=>x(rr,r=>{e(Z)&&r(ar)}),"if",l,289,5)}t(he);var Pe=d(he,2);{var tr=r=>{var s=Vr(),y=a(s),p=d(a(y),2),G=d(a(p),2),N=a(G),W=a(N);{var le=i=>{var $=Ir();c(i,$)};v(()=>x(W,i=>{e(q)||i(le)}),"if",l,391,10)}var O=d(W,2);{var J=i=>{var $=Br();c(i,$)};v(()=>x(O,i=>{e(A)||i(J)}),"if",l,394,10)}var K=d(O,2);{var se=i=>{var $=Fr();c(i,$)};v(()=>x(K,i=>{e(C)||i(se)}),"if",l,397,10)}var Q=d(K,2);{var oe=i=>{var $=Nr();c(i,$)};v(()=>x(Q,i=>{e(P)||i(oe)}),"if",l,400,10)}var ie=d(Q,2);{var U=i=>{var $=Sr();c(i,$)};v(()=>x(ie,i=>{e(L)||i(U)}),"if",l,403,10)}t(N),t(G),t(p),t(y),t(s),c(r,s)};v(()=>x(Pe,r=>{e(H),e(k),e(h),e(w),e(f),e(_),b(()=>!e(H)&&(e(k).length>0||e(h).length>0||e(w).length>0||e(f).length>0||e(_).length>0))&&r(tr)}),"if",l,377,4)}var Le=d(Pe,2);{var dr=r=>{var s=jr(),y=a(s),p=d(a(y),2),G=a(p),N=a(G,!0);t(G),t(p),t(y),t(s),ne(()=>Ce(N,e(Y))),c(r,s)};v(()=>x(Le,r=>{e(Y)&&r(dr)}),"if",l,414,4)}var qe=d(Le,2),lr=a(qe);{let r=yr(()=>!e(H)||e(F));v(()=>Ie(lr,{type:"submit",variant:"primary",size:"lg",fullWidth:!0,get loading(){return e(F)},get disabled(){return e(r)},children:Ee(l,(s,y)=>{I();var p=mr();ne(()=>Ce(p,e(F)?"Initializing...":"Initialize GARM")),c(s,p)}),$$slots:{default:!0}}),"component",l,431,5,{componentTag:"Button"})}t(qe),t(ue),I(2),t(we),t(_e),t(me),ne((r,s)=>{Be(ke,"src",r),Be(We,"src",s),D(ee,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(q),e(k),b(()=>!e(q)&&e(k).length>0?"border-red-300 dark:border-red-600":"")??""}`),D(re,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(A),e(h),b(()=>!e(A)&&e(h).length>0?"border-red-300 dark:border-red-600":"")??""}`),D(ae,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(C),e(w),b(()=>!e(C)&&e(w).length>0?"border-red-300 dark:border-red-600":"")??""}`),D(te,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(P),e(f),b(()=>!e(P)&&e(f).length>0?"border-red-300 dark:border-red-600":"")??""}`),D(de,1,`appearance-none block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm ${e(L),e(_),b(()=>!e(L)&&e(_).length>0?"border-red-300 dark:border-red-600":"")??""}`)},[()=>(Ge(M),b(()=>M("/assets/garm-light.svg"))),()=>(Ge(M),b(()=>M("/assets/garm-dark.svg")))]),z(ee,()=>e(k),r=>o(k,r)),z(re,()=>e(h),r=>o(h,r)),z(ae,()=>e(w),r=>o(w,r)),z(te,()=>e(f),r=>o(f,r)),z(de,()=>e(_),r=>o(_,r)),nr("submit",ue,$r(Te)),c(Ne,me);var sr=br({...cr()});return je(),sr}export{l as component};
