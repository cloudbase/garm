import"../chunks/DsnmJJEf.js";import{i as qe}from"../chunks/B3Pzt0F_.js";import{p as ze,o as He,A as je,l as Ge,a as Oe,f as A,h as Ve,b as C,t as z,c as w,d as Je,g as e,m as l,s as r,u as s,$ as Ke,j as u,r as f,k as d,v as de,y as Qe,B as ce,q as m,n as Xe}from"../chunks/D8EpLgQ1.js";import{i as g,s as Ye,a as Ze}from"../chunks/5WA7h8uK.js";import{c as et,g as h}from"../chunks/CiE1LlKV.js";import{p as tt}from"../chunks/-1rkm990.js";import{g as pe}from"../chunks/DsX4H4sg.js";import{b as H}from"../chunks/D3_ugSUS.js";import{U as ot}from"../chunks/CIBm3n2u.js";import{D as ue}from"../chunks/KQ2xQpA3.js";import{E as at,P as rt,a as st}from"../chunks/DxQgLoe9.js";import{D as nt,I as it}from"../chunks/G-ddPbA8.js";import{g as fe}from"../chunks/D5ucq3Gx.js";import{e as j}from"../chunks/BZiHL9L3.js";import{W as lt}from"../chunks/BsqC4UA1.js";import{C as dt}from"../chunks/CRD55Dyg.js";import{w as G}from"../chunks/u94nIB4-.js";import{t as R}from"../chunks/BEkVdVE1.js";var ct=A('<div class="p-6 text-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div> <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading repository...</p></div>'),pt=A('<div class="rounded-md bg-red-50 dark:bg-red-900 p-4"><p class="text-sm font-medium text-red-800 dark:text-red-200"> </p></div>'),ut=A("<!> <!> <!> <!> <!> <!>",1),ft=A('<div class="space-y-6"><nav class="flex" aria-label="Breadcrumb"><ol class="inline-flex items-center space-x-1 md:space-x-3"><li class="inline-flex items-center"><a class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white"><svg class="w-3 h-3 mr-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg> Repositories</a></li> <li><div class="flex items-center"><svg class="w-3 h-3 text-gray-400 mx-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg> <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400"> </span></div></li></ol></nav> <!></div> <!> <!> <!> <!>',1);function Ct(me,ye){ze(ye,!1);const[ve,ge]=Ye(),O=()=>Ze(tt,"$page",ve),x=l();let t=l(null),c=l([]),y=l([]),S=l(!0),E=l(""),D=l(!1),T=l(!1),I=l(!1),P=l(!1),p=l(null),M=null,_=l();async function V(){if(e(x))try{r(S,!0),r(E,"");const[o,a,n]=await Promise.all([h.getRepository(e(x)),h.listRepositoryPools(e(x)).catch(()=>[]),h.listRepositoryInstances(e(x)).catch(()=>[])]);r(t,o),r(c,a),r(y,n)}catch(o){r(E,j(o))}finally{r(S,!1)}}function he(o,a){const{events:n}=o;return{...a,events:n}}async function _e(o){if(e(t))try{await h.updateRepository(e(t).id,o),await V(),R.success("Repository Updated",`Repository ${e(t).owner}/${e(t).name} has been updated successfully.`),r(D,!1)}catch(a){throw a}}async function $e(){if(e(t)){try{await h.deleteRepository(e(t).id),pe(`${H}/repositories`)}catch(o){const a=j(o);R.error("Delete Failed",a)}r(T,!1)}}async function be(){if(e(p))try{await h.deleteInstance(e(p).name),R.success("Instance Deleted",`Instance ${e(p).name} has been deleted successfully.`),r(I,!1),r(p,null)}catch(o){const a=j(o);R.error("Delete Failed",a),r(I,!1),r(p,null)}}function we(o){r(p,o),r(I,!0)}function xe(){r(P,!0)}async function Ie(o){try{if(!e(t))return;await h.createRepositoryPool(e(t).id,o.detail),R.success("Pool Created",`Pool has been created successfully for repository ${e(t).owner}/${e(t).name}.`),r(P,!1)}catch(a){throw a}}function J(){e(_)&&Qe(_,e(_).scrollTop=e(_).scrollHeight)}function Re(o){if(o.operation==="update"){const a=o.payload;if(e(t)&&a.id===e(t).id){const n=e(t).events?.length||0,i=a.events?.length||0;r(t,he(e(t),a)),i>n&&setTimeout(()=>{J()},100)}}else if(o.operation==="delete"){const a=o.payload.id||o.payload;e(t)&&e(t).id===a&&pe(`${H}/repositories`)}}function Ee(o){if(!e(t))return;const a=o.payload;if(a.repo_id===e(t).id){if(o.operation==="create")r(c,[...e(c),a]);else if(o.operation==="update")r(c,e(c).map(n=>n.id===a.id?a:n));else if(o.operation==="delete"){const n=a.id||a;r(c,e(c).filter(i=>i.id!==n))}}}function De(o){if(!e(t)||!e(c))return;const a=o.payload;if(e(c).some(i=>i.id===a.pool_id)){if(o.operation==="create")r(y,[...e(y),a]);else if(o.operation==="update")r(y,e(y).map(i=>i.id===a.id?a:i));else if(o.operation==="delete"){const i=a.id||a;r(y,e(y).filter(L=>L.id!==i))}}}He(()=>{V().then(()=>{e(t)?.events?.length&&setTimeout(()=>{J()},100)});const o=G.subscribeToEntity("repository",["update","delete"],Re),a=G.subscribeToEntity("pool",["create","update","delete"],Ee),n=G.subscribeToEntity("instance",["create","update","delete"],De);M=()=>{o(),a(),n()}}),je(()=>{M&&(M(),M=null)}),Ge(()=>O(),()=>{r(x,O().params.id)}),Oe(),qe();var K=ft();Ve(o=>{z(()=>Ke.title=`${e(t),s(()=>e(t)?`${e(t).name} - Repository Details`:"Repository Details")??""} - GARM`)});var B=C(K),U=u(B),Q=u(U),F=u(Q),Te=u(F);f(F);var X=d(F,2),Y=u(X),Z=d(u(Y),2),Pe=u(Z,!0);f(Z),f(Y),f(X),f(Q),f(U);var Me=d(U,2);{var ke=o=>{var a=ct();w(o,a)},Ce=o=>{var a=ce(),n=C(a);{var i=$=>{var b=pt(),k=u(b),N=u(k,!0);f(k),f(b),z(()=>de(N,e(E))),w($,b)},L=$=>{var b=ce(),k=C(b);{var N=W=>{var ae=ut(),re=C(ae);{let v=m(()=>(e(t),s(()=>e(t).name||"Repository"))),q=m(()=>(e(t),s(()=>e(t).owner))),Ne=m(()=>(e(t),s(()=>e(t).endpoint?.name))),We=m(()=>(Xe(fe),e(t),s(()=>fe(e(t).endpoint?.endpoint_type||"unknown"))));nt(re,{get title(){return e(v)},get subtitle(){return`Owner: ${e(q)??""} â€¢ Endpoint: ${e(Ne)??""}`},get forgeIcon(){return e(We)},onEdit:()=>r(D,!0),onDelete:()=>r(T,!0)})}var se=d(re,2);at(se,{get entity(){return e(t)},entityType:"repository"});var ne=d(se,2);{let v=m(()=>(e(t),s(()=>e(t).id||"")));lt(ne,{entityType:"repository",get entityId(){return e(v)},get entityName(){return`${e(t),s(()=>e(t).owner)??""}/${e(t),s(()=>e(t).name)??""}`}})}var ie=d(ne,2);{let v=m(()=>(e(t),s(()=>e(t).id||"")));rt(ie,{get pools(){return e(c)},entityType:"repository",get entityId(){return e(v)},get entityName(){return`${e(t),s(()=>e(t).owner)??""}/${e(t),s(()=>e(t).name)??""}`},$$events:{addPool:xe}})}var le=d(ie,2);it(le,{get instances(){return e(y)},entityType:"repository",onDeleteInstance:we});var Le=d(le,2);{let v=m(()=>(e(t),s(()=>e(t)?.events)));st(Le,{get events(){return e(v)},get eventsContainer(){return e(_)},set eventsContainer(q){r(_,q)},$$legacy:!0})}w(W,ae)};g(k,W=>{e(t)&&W(N)},!0)}w($,b)};g(n,$=>{e(E)?$(i):$(L,!1)},!0)}w(o,a)};g(Me,o=>{e(S)?o(ke):o(Ce,!1)})}f(B);var ee=d(B,2);{var Ae=o=>{ot(o,{get entity(){return e(t)},entityType:"repository",$$events:{close:()=>r(D,!1),submit:a=>_e(a.detail)}})};g(ee,o=>{e(D)&&e(t)&&o(Ae)})}var te=d(ee,2);{var Se=o=>{{let a=m(()=>(e(t),s(()=>`${e(t).owner}/${e(t).name}`)));ue(o,{title:"Delete Repository",message:"Are you sure you want to delete this repository? This action cannot be undone and will remove all associated pools and instances.",get itemName(){return e(a)},$$events:{close:()=>r(T,!1),confirm:$e}})}};g(te,o=>{e(T)&&e(t)&&o(Se)})}var oe=d(te,2);{var Be=o=>{ue(o,{title:"Delete Instance",message:"Are you sure you want to delete this instance? This action cannot be undone.",get itemName(){return e(p),s(()=>e(p).name)},$$events:{close:()=>{r(I,!1),r(p,null)},confirm:be}})};g(oe,o=>{e(I)&&e(p)&&o(Be)})}var Ue=d(oe,2);{var Fe=o=>{{let a=m(()=>(e(t),s(()=>e(t).id||"")));dt(o,{initialEntityType:"repository",get initialEntityId(){return e(a)},$$events:{close:()=>r(P,!1),submit:Ie}})}};g(Ue,o=>{e(P)&&e(t)&&o(Fe)})}z(()=>{et(Te,"href",`${H}/repositories`),de(Pe,(e(t),s(()=>e(t)?e(t).name:"Loading...")))}),w(me,K),Je(),ge()}export{Ct as component};
