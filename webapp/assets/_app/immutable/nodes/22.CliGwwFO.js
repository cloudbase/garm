import{c as Oe,a as Te,h as je,b as f,l as qe,d as N,t as Q,s as de,f as be}from"../chunks/CxOx-TIJ.js";import{i as We}from"../chunks/3NxSoY2_.js";import{p as Je,o as Ke,l as L,b as Qe,f as A,d as l,a as Ve,g as e,m as i,$ as Xe,w as me,h as d,u as c,s as $,e as U,y as pe,t as ge,i as D,j as a,F as Y,n as B,c as R,r as E}from"../chunks/DzFKsO_V.js";import{s as Ye,a as Ze,i as C,v as et}from"../chunks/B_jyf0qs.js";import{w as ue}from"../chunks/DoJxysSt.js";import{l as fe}from"../chunks/BAcG6-Ep.js";import{g as z}from"../chunks/BzzAh3Be.js";import{B as tt,c as O,g as ye}from"../chunks/BguOOs3x.js";import{P as at}from"../chunks/DTko0dwG.js";import{A as rt}from"../chunks/Ct5kWObc.js";import{D as ot,E as st,G as j,A as nt}from"../chunks/C2FKJqnN.js";import{t as I}from"../chunks/li_-Mkq2.js";import{e as ve}from"../chunks/BZiHL9L3.js";import{B as _e}from"../chunks/1CdJgrM6.js";import{D as he}from"../chunks/DL1RlOO9.js";import{i as V}from"../chunks/C98nByjP.js";import{e as we,a as X}from"../chunks/Penjr-j0.js";r[Y]="src/routes/templates/+page.svelte";var lt=Te(be('<div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4 mb-6"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div> <div class="ml-3"><h3 class="text-sm font-medium text-red-800 dark:text-red-200">Error loading templates</h3> <div class="mt-2 text-sm text-red-700 dark:text-red-300"> </div> <div class="mt-4"><!></div></div></div></div>'),r[Y],[[320,1,[[321,2,[[322,3,[[323,4,[[324,5]]]]],[327,3,[[328,4],[331,4],[334,4]]]]]]]]),it=Te(be("<!> <!> <!> <!> <!>",1),r[Y],[]);function r(xe,$e){Oe(new.target),Je($e,!1,r);const[Ce,ke]=Ye(),h=()=>(et(we,"eagerCache"),Ze(we,"$eagerCache",Ce)),q=i(),W=i(),w=i(),Z=i();let T=i([]),S=i(""),y=i(""),m=i(1),b=i(25),k=i(1),F=i(!1),G=i(!1),g=i(null);async function Me(){try{(await B(X.retryResource("templates")))()}catch(t){console.error(...fe("error","Retry failed:",t))}}async function Pe(){if(e(g)?.id)try{(await B(ye.deleteTemplate(e(g).id)))(),I.add({type:"success",title:"Template deleted",message:`Template "${e(g).name}" has been deleted successfully.`}),a(F,!1),a(g,null)}catch(t){const o=ve(t);I.add({type:"error",title:"Failed to delete template",message:o})}}function Le(){z(O("/templates/create"))}async function ee(t){if(!t.id){I.add({type:"error",title:"Error",message:"Template ID is missing"});return}z(O(`/templates/create?clone=${t.id}`))}function te(t){a(g,t),a(F,!0)}function Ae(){a(G,!0)}async function De(){try{(await B(ye.restoreTemplates({restore_all:!0})))(),I.add({type:"success",title:"Templates restored",message:"System templates have been restored successfully."}),a(G,!1),(await B(X.retryResource("templates")))()}catch(t){const o=ve(t);I.add({type:"error",title:"Failed to restore templates",message:o})}}function ae(t){switch(t){case"github":return{color:"blue",text:"GitHub"};case"gitea":return{color:"green",text:"Gitea"};default:return{color:"gray",text:t||"Unknown"}}}function re(t){switch(t){case"linux":return{color:"blue",text:"Linux"};case"windows":return{color:"info",text:"Windows"};default:return{color:"gray",text:t||"Unknown"}}}const Be=[{key:"name",title:"Name",cellComponent:st,cellProps:{entityType:"template"}},{key:"description",title:"Description",cellComponent:j,cellProps:{field:"description",type:"description"}},{key:"forge_type",title:"Forge Type",cellComponent:j,cellProps:{field:"forge_type"}},{key:"os_type",title:"OS Type",cellComponent:j,cellProps:{field:"os_type"}},{key:"owner_id",title:"Owner",cellComponent:j,cellProps:{field:"owner_id"}},{key:"actions",title:"Actions",align:"right",cellComponent:nt,cellProps:t=>{const o=V(),s=D(t.owner_id,"system"),n=[];return n.push({type:"copy",title:"Clone",ariaLabel:"Clone template",action:"clone"}),(o||!s)&&n.push({type:"edit",title:"Edit",ariaLabel:"Edit template",action:"edit"}),(o||!s)&&n.push({type:"delete",title:"Delete",ariaLabel:"Delete template",action:"delete"}),{actions:n}}}],Re={entityType:"template",primaryText:{field:"name",isClickable:!0,href:"/templates/{id}"},secondaryText:{field:"description"},badges:[{type:"custom",value:t=>{const o=ae(t.forge_type);return{variant:o.color,text:o.text}}},{type:"custom",value:t=>{const o=re(t.os_type);return{variant:o.color,text:o.text}}}],actions:[{type:"clone",handler:t=>ee(t)},{type:"edit",handler:t=>z(O(`/templates/${t.id}?edit=true`))},{type:"delete",handler:t=>te(t)}]};Ke(async()=>{try{const t=(await B(X.getTemplates()))();t&&Array.isArray(t)&&a(T,t)}catch(t){console.error(...fe("error","Failed to load templates:",t)),a(S,t instanceof Error?t.message:"Failed to load templates")}}),L(()=>(e(T),h()),()=>{(!e(T).length||h().loaded.templates)&&a(T,h().templates)}),L(()=>h(),()=>{a(q,h().loading.templates)}),L(()=>h(),()=>{a(W,h().errorMessages.templates)}),L(()=>(e(y),e(T)),()=>{a(w,e(y)?e(T).filter(t=>t.name?.toLowerCase().includes(e(y).toLowerCase())||t.description?.toLowerCase().includes(e(y).toLowerCase())||t.forge_type?.toLowerCase().includes(e(y).toLowerCase())||t.os_type?.toLowerCase().includes(e(y).toLowerCase())):e(T))}),L(()=>(e(k),e(w),e(b),e(m)),()=>{a(k,Math.ceil(e(w).length/e(b))),e(m)>e(k)&&e(k)>0&&a(m,e(k))}),L(()=>(e(w),e(m),e(b)),()=>{a(Z,e(w).slice((e(m)-1)*e(b),e(m)*e(b)))}),Qe(),We();var oe=it();je(t=>{Xe.title="Runner Install Templates - GARM"});var se=A(oe);l(()=>at(se,{title:"Runner Install Templates",description:"Manage templates for configuring runner software installation. These templates can be set on pools or scale sets.",actionLabel:"Create Template",showAction:!0,$$events:{action:Le},$$slots:{"secondary-actions":(t,o)=>{var s=N(),n=A(s);{var v=x=>{l(()=>tt(x,{variant:"secondary",icon:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />',$$events:{click:Ae},children:ue(r,(M,H)=>{me();var p=Q("Restore System Templates");f(M,p)}),$$slots:{default:!0}}),"component",r,308,3,{componentTag:"Button"})};l(()=>C(n,x=>{d(V),c(V)&&x(v)}),"if",r,307,2)}f(t,s)}}}),"component",r,299,0,{componentTag:"PageHeader"});var ne=$(se,2);{var Ee=t=>{var o=lt(),s=R(o),n=$(R(s),2),v=$(R(n),2),x=R(v,!0);E(v);var M=$(v,2),H=R(M);l(()=>rt(H,{variant:"secondary",size:"sm",$$events:{click:Me},children:ue(r,(p,u)=>{me();var J=Q("Try Again");f(p,J)}),$$slots:{default:!0}}),"component",r,335,5,{componentTag:"ActionButton"}),E(M),E(n),E(s),E(o),ge(()=>de(x,e(S)||e(W))),f(t,o)};l(()=>C(ne,t=>{(e(S)||e(W))&&!e(q)&&t(Ee)}),"if",r,319,0)}var le=$(ne,2);l(()=>ot(le,{get columns(){return Be},get data(){return e(Z)},get loading(){return e(q)},get error(){return e(S)},get searchTerm(){return e(y)},searchPlaceholder:"Search templates by name, description, type...",get currentPage(){return e(m)},get perPage(){return e(b)},get totalPages(){return e(k)},get totalItems(){return e(w),c(()=>e(w).length)},get mobileCardConfig(){return Re},emptyMessage:"No templates found",$$events:{search:t=>{a(y,t.detail.term),a(m,1)},pageChange:t=>a(m,t.detail.page),perPageChange:t=>{a(b,t.detail.perPage),a(m,1)},clone:t=>ee(t.detail.item),edit:t=>z(O(`/templates/${t.detail.item.id}?edit=true`)),delete:t=>te(t.detail.item)},$$slots:{cell:(t,o)=>{const s=U(()=>o.item),n=U(()=>o.column);var v=N(),x=A(v);{var M=p=>{const u=pe(U(()=>(d(e(s)),c(()=>ae(e(s).forge_type)))),"badgeInfo");e(u),l(()=>_e(p,{get variant(){return d(e(u)),c(()=>e(u).color)},get text(){return d(e(u)),c(()=>e(u).text)}}),"component",r,367,3,{componentTag:"Badge"})},H=p=>{var u=N(),J=A(u);{var He=P=>{const _=pe(U(()=>(d(e(s)),c(()=>re(e(s).os_type)))),"badgeInfo");e(_),l(()=>_e(P,{get variant(){return d(e(_)),c(()=>e(_).color)},get text(){return d(e(_)),c(()=>e(_).text)}}),"component",r,370,3,{componentTag:"Badge"})},Ne=P=>{var _=N(),Ue=A(_);{var ze=K=>{var ce=Q();ge(()=>de(ce,(d(e(s)),c(()=>D(e(s).owner_id,"system")?"System":e(s).owner_id||"Unknown")))),f(K,ce)};l(()=>C(Ue,K=>{d(e(n)),c(()=>D(e(n).key,"owner_id"))&&K(ze)},!0),"if",r,371,2)}f(P,_)};l(()=>C(J,P=>{d(e(n)),c(()=>D(e(n).key,"os_type"))?P(He):P(Ne,!1)},!0),"if",r,368,2)}f(p,u)};l(()=>C(x,p=>{d(e(n)),c(()=>D(e(n).key,"forge_type"))?p(M):p(H,!1)}),"if",r,365,2)}f(t,v)}}}),"component",r,344,0,{componentTag:"DataTable"});var ie=$(le,2);{var Ie=t=>{l(()=>he(t,{title:"Delete Template",message:"Are you sure you want to delete this template? This action cannot be undone.",get itemName(){return e(g),c(()=>e(g).name)},$$events:{close:()=>{a(F,!1),a(g,null)},confirm:Pe}}),"component",r,380,1,{componentTag:"DeleteModal"})};l(()=>C(ie,t=>{e(F)&&e(g)&&t(Ie)}),"if",r,379,0)}var Se=$(ie,2);{var Fe=t=>{l(()=>he(t,{title:"Restore System Templates",message:"This will restore all system templates from the default configuration. Any missing system templates will be created, and any changes made to existing system templates will be overwritten with the default content.",itemName:"",confirmLabel:"Restore Templates",danger:!1,$$events:{close:()=>a(G,!1),confirm:De}}),"component",r,391,1,{componentTag:"DeleteModal"})};l(()=>C(Se,t=>{e(G)&&t(Fe)}),"if",r,390,0)}f(xe,oe);var Ge=Ve({...qe()});return ke(),Ge}export{r as component};
