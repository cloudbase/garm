import{c as ce,a as y,b as l,l as de,d as J,f as x,t as K,s as T}from"./CxOx-TIJ.js";import{i as ve}from"./3NxSoY2_.js";import{p as fe,B as me,l as Q,h as ue,j as i,g as a,m as I,b as pe,c as m,s as j,d as u,r as p,a as he,i as b,n as d,f as L,F as g,w as X,t as M,u as ge}from"./DzFKsO_V.js";import{p as O,i as k}from"./B_jyf0qs.js";import{w as Y}from"./DoJxysSt.js";import{l as _e}from"./BAcG6-Ep.js";import{g as h,B as Z}from"./BguOOs3x.js";import{t as z}from"./li_-Mkq2.js";import{e as be}from"./BZiHL9L3.js";t[g]="src/lib/components/WebhookSection.svelte";var ke=y(x('<div class="flex items-center"><div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div> <span class="text-sm text-gray-500 dark:text-gray-400">Checking...</span></div>'),t[g],[[121,6,[[122,7],[123,7]]]]),ye=y(x('<div class="ml-4 text-xs text-gray-500 dark:text-gray-400"> </div>'),t[g],[[133,7]]),xe=y(x('<div class="flex items-center"><svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> <span class="text-sm text-green-700 dark:text-green-300">Webhook installed</span></div> <!>',1),t[g],[[126,6,[[127,7,[[128,8]]],[130,7]]]]),we=y(x('<div class="flex items-center"><svg class="w-4 h-4 text-gray-400 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12zm0-10a1 1 0 011 1v3a1 1 0 01-2 0V7a1 1 0 011-1z" clip-rule="evenodd"></path></svg> <span class="text-sm text-gray-500 dark:text-gray-400">No webhook installed</span></div>'),t[g],[[138,6,[[139,7,[[140,8]]],[142,7]]]]),We=y(x('<div class="bg-white dark:bg-gray-800 shadow rounded-lg"><div class="px-4 py-5 sm:p-6"><div class="flex items-center justify-between"><div><h3 class="text-lg font-medium text-gray-900 dark:text-white">Webhook Status</h3> <div class="mt-1 flex items-center"><!></div></div> <div class="flex space-x-2"><!></div></div></div></div>'),t[g],[[112,0,[[113,1,[[114,2,[[115,3,[[116,4],[119,4]]],[148,3]]]]]]]]);function t(ee,w){ce(new.target),fe(w,!1,t);const B=I();let _=O(w,"entityType",8),r=O(w,"entityId",8),P=O(w,"entityName",8),o=I(null),n=I(!1),W=I(!0);const q=me();async function S(){if(r())try{i(W,!0),b(_(),"repository")?i(o,(await d(h.getRepositoryWebhookInfo(r())))()):i(o,(await d(h.getOrganizationWebhookInfo(r())))())}catch(e){e&&b(typeof e,"object")&&"response"in e&&b(e.response?.status,404)?i(o,null):(console.warn(..._e("warn","Failed to check webhook status:",e)),i(o,null))}finally{i(W,!1)}}async function te(){if(r())try{i(n,!0),b(_(),"repository")?(await d(h.installRepositoryWebhook(r())))():(await d(h.installOrganizationWebhook(r())))(),z.success("Webhook Installed",`Webhook for ${_()} ${P()} has been installed successfully.`),(await d(S()))(),q("webhookStatusChanged",{installed:!0})}catch(e){z.error("Webhook Installation Failed",e instanceof Error?e.message:"Failed to install webhook.")}finally{i(n,!1)}}async function ae(){if(r())try{i(n,!0),b(_(),"repository")?(await d(h.uninstallRepositoryWebhook(r())))():(await d(h.uninstallOrganizationWebhook(r())))(),z.success("Webhook Uninstalled",`Webhook for ${_()} ${P()} has been uninstalled successfully.`),(await d(S()))(),q("webhookStatusChanged",{installed:!1})}catch(e){z.error("Webhook Uninstall Failed",be(e))}finally{i(n,!1)}}Q(()=>ue(r()),()=>{r()&&S()}),Q(()=>a(o),()=>{i(B,a(o)&&a(o).active)}),pe(),ve();var F=We(),D=m(F),V=m(D),C=m(V),G=j(m(C),2),se=m(G);{var re=e=>{var v=ke();l(e,v)},ie=e=>{var v=J(),E=L(v);{var N=s=>{var c=xe(),$=j(L(c),2);{var f=A=>{var R=ye(),ne=m(R);p(R),M(()=>T(ne,`URL: ${a(o),ge(()=>a(o).url||"N/A")??""}`)),l(A,R)};u(()=>k($,A=>{a(o)&&A(f)}),"if",t,132,6)}l(s,c)},U=s=>{var c=we();l(s,c)};u(()=>k(E,s=>{a(B)?s(N):s(U,!1)},!0),"if",t,125,5)}l(e,v)};u(()=>k(se,e=>{a(W)?e(re):e(ie,!1)}),"if",t,120,5)}p(G),p(C);var H=j(C,2),oe=m(H);{var le=e=>{var v=J(),E=L(v);{var N=s=>{u(()=>Z(s,{variant:"danger",size:"sm",get disabled(){return a(n)},$$events:{click:ae},children:Y(t,(c,$)=>{X();var f=K();M(()=>T(f,a(n)?"Uninstalling...":"Uninstall")),l(c,f)}),$$slots:{default:!0}}),"component",t,151,6,{componentTag:"Button"})},U=s=>{u(()=>Z(s,{variant:"primary",size:"sm",get disabled(){return a(n)},$$events:{click:te},children:Y(t,(c,$)=>{X();var f=K();M(()=>T(f,a(n)?"Installing...":"Install Webhook")),l(c,f)}),$$slots:{default:!0}}),"component",t,160,6,{componentTag:"Button"})};u(()=>k(E,s=>{a(B)?s(N):s(U,!1)}),"if",t,150,5)}l(e,v)};u(()=>k(oe,e=>{a(W)||e(le)}),"if",t,149,4)}return p(H),p(V),p(D),p(F),l(ee,F),he({...de()})}export{t as W};
